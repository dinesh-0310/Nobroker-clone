function showEmailInvalidPopup(a){if(!a){nbGA.logEvent("SignUp","InvalidEmail-show",{});displayAlerts("<div>Your email "+$("#loggedInUserEmail").val()+' is invalid. Please provide a valid email. </div> <button id="updateLater" class="btn pull-left"><i class="icon icon-angle-left"></i>Later</button> <button id="updateEmail" class="btn btn-nbprimary">Update <i class="icon icon-angle-right"></i></button> </button>',"warning"),$("#alertMessageBox").addClass("noHide")}}function showUpdateEmailPopup(){$("#alertMessageBox").addClass("noHide"),displayAlerts('<div class=""><form><input type="email" placeholder="Enter email" size="35" class="form-control" value="" required /><div class="errMsg"></div><button class="btn btn-nbprimary" type="button" id="saveEmailId">Save <i class="icon icon-angle-right"></i></button></button></form></div>',"warning")}function showOrHideMenuDropDown(){$("#menuDropdown").is(":visible")?$("#menuDropdown").hide():($("#menuDropdown").show(),nbGA&&nbGA.logEvent("Menu","menu-open",{}))}function showMyCommercialPlansTab(){$("#myCommercialPlansDropdown").show(),$("#myCommercialPlansArrow").addClass("icon-angle-up"),$("#myCommercialPlansArrow").removeClass("icon-angle-down"),$("#myCommercialPlansTabList").addClass("border-bottom-none"),$("#myListingsDropdown").hide(),$("#myListingsArrow").addClass("icon-angle-down"),$("#myListingsArrow").removeClass("icon-angle-up"),$("#myListingsTabList").removeClass("border-bottom-none"),$("#myDashboardDropdown").hide(),$("#myDashboardArrow").addClass("icon-angle-down"),$("#myDashboardArrow").removeClass("icon-angle-up"),$("#myDashboardTabList").removeClass("border-bottom-none")}function showMyListingsTab(){$("#myListingsDropdown").show(),$("#myListingsArrow").addClass("icon-angle-up"),$("#myListingsArrow").removeClass("icon-angle-down"),$("#myListingsTabList").addClass("border-bottom-none"),$("#myDashboardDropdown").hide(),$("#myDashboardArrow").addClass("icon-angle-down"),$("#myDashboardArrow").removeClass("icon-angle-up"),$("#myDashboardTabList").removeClass("border-bottom-none"),$("#myPlansDropdown").hide(),$("#myPlansArrow").addClass("icon-angle-down"),$("#myPlansArrow").removeClass("icon-angle-up"),$("#myPlansTabList").removeClass("border-bottom-none")}function showMyDashBoardTab(){$("#myDashboardDropdown").show(),$("#myDashboardArrow").addClass("icon-angle-up"),$("#myDashboardArrow").removeClass("icon-angle-down"),$("#myDashboardTabList").addClass("border-bottom-none"),$("#myListingsDropdown").hide(),$("#myListingsArrow").addClass("icon-angle-down"),$("#myListingsArrow").removeClass("icon-angle-up"),$("#myListingsTabList").removeClass("border-bottom-none"),$("#myPlansDropdown").hide(),$("#myPlansArrow").addClass("icon-angle-down"),$("#myPlansArrow").removeClass("icon-angle-up"),$("#myPlansTabList").removeClass("border-bottom-none")}function showMyPlansTab(){$("#myPlansDropdown").show(),$("#myPlansArrow").addClass("icon-angle-up"),$("#myPlansArrow").removeClass("icon-angle-down"),$("#myPlansTabList").addClass("border-bottom-none"),$("#myListingsDropdown").hide(),$("#myListingsArrow").addClass("icon-angle-down"),$("#myListingsArrow").removeClass("icon-angle-up"),$("#myListingsTabList").removeClass("border-bottom-none"),$("#myDashboardDropdown").hide(),$("#myDashboardArrow").addClass("icon-angle-down"),$("#myDashboardArrow").removeClass("icon-angle-up"),$("#myDashboardTabList").removeClass("border-bottom-none")}function showUserProfile(){$("#myProfileDropdown").show(),$(".userProfileArrow").addClass("icon-angle-up"),$(".userProfileArrow").removeClass("icon-angle-down")}function hideMenuDropDown(){$("#menuDropdown").hide()}function capitalize(a){if(a.length>0)return a[0].toUpperCase()+a.slice(1).toLowerCase()}function timeTo12Format(a,b){var c=a.trim().split(":");if(2!=c.length)return a;var d;return c[0]>12?(d=c[0]-12,1==d.length&&(d="0"+d)):(d=c[0],1==d.length&&(d="0"+d)),d=d+":"+c[1]+" ",c[0]>=12?d+=b?"PM":"pm":d+=b?"AM":"am",d}function timeTo24Format(a){var b=a.trim().split(" ");if(2==b.length){var c=b[0].trim().split(":");return 2!=c.length?a:("PM"==b[1]||"pm"==b[1]?12!=c[0]&&(c[0]=1*c[0]+12):"AM"!=b[1]&&"am"!=b[1]||"12"!=c[0]?c[0]=c[0]:c[0]=c[0]-12,c[0]+":"+c[1])}return a}function displayAlerts(a,b,c){$("#alertMessageBox").removeClass("in success danger error warning default"),$("#alertMessageBox .messageText").html(a),$("#alertMessageBox").addClass(b),$("#alertMessageBox").addClass("in"),c&&(c=parseInt(c)+500,window.setTimeout(function(){hideAlert()},c))}function displayGenericError(){displayAlerts("An error occured processing your request.","danger",3e3)}function hideMapCard(){ga("send","event","MapCard","hide","hiding map card"),$("#mapCard").hide()}function hideAlert(){$("#alertMessageBox").hasClass("noHide")||$("#alertMessageBox").removeClass("in success danger error warning default")}function hidePhoneVer(){$("#phoneVerDiv").removeClass("in"),$("#phoneVerDiv").hide()}function displayPhVer(){showLoading(),$.ajax({url:"/twilio/userPhone",type:"GET",success:function(a){$("#verPhone").val(a),$("#verPhone").data("original",a),$("#phVerLink").data("count",0),$("#phoneVerification").modal("show"),$("#phoneVerification #verPhone").intlTelInput({nationalMode:!0,separateDialCode:!0,autoPlaceholder:"off",utilsScript:"https://assets.nobroker.in/static/lib/universal/intlTelInputUtil.js"}),$("#phoneVerification #phone_ver .intl-tel-input").css("width","100%"),hideLoading()},error:function(a){displayGenericError(),hideLoading()}})}function showAudioPlayer(a){$(a).hide(),$(a).siblings("audio").show(),$(a).siblings("audio").play()}function launchNewReqPopup(a){"undefined"!=typeof vent&&vent.trigger("showAlerts")}function launchReportAbuse(a,b,c,d){$("#reportAbuse").hide(),$("#report-abuse-mobile").hide(),$("#reportAbuse input").val(""),$("#report-abuse-mobile input").val(""),$("#reportAbuseComments").val(""),$("#limitUpdateSuccessScreen").addClass("hide"),$("#reportAbuseScreen").removeClass("hide"),$("#abusePropertyId").val(b);var e=0,f=0;c?(e=$(a).offset().left,e=e+$(a).width()+20,f=$(a).offset().top,f=f):(d&&($("#abuseType").val(d),$("#abusetypeDiv").hide()),e=$(a).parent().parent().offset().left,e=e+$(a).parent().width()-$(a).width()+70,f=$(a).offset().top,f-=2*$(a).parent().height()),nbGA.logEvent("AbuseReport","popup-"+$("#nbpt").val().toLowerCase(),{})}function submitAbuseReport(){var a={};a.propertyId=$("#abusePropertyId").val(),a.abuseType=$("#ra #abuseType").val(),a.comments=$("#reportAbuseComments").val(),showLoading(),$.ajax({url:"/api/v1/abuseReport/new",type:"POST",data:a,"ga-log":"event","ga-category":"AbuseReport","ga-action":"submit",success:function(a){a.data&&a.data.limitUpdated?($("#report-abuse-mobile #reportAbuseScreen").addClass("hide"),$("#limitUpdateSuccessScreen").removeClass("hide")):(displayAlerts("Your help is appreciated! We will verify your report and take the required action.","success",5e3),$("#reportAbuse").hide(),$("#report-abuse-mobile").modal("hide")),hideLoading()},error:function(a){displayGenericError(),hideLoading()}}),hideLoading()}function initiateCall(){$("#verificationMessage").html("Initiating a verification call, please keep your mobile handy..."),showLoading(),$.ajax({url:"/twilio/initiateCall",type:"POST",success:function(a){a?($("#verificationMessage").html("You will receive an automated call on above number, please press 1 on your phone to verify the number."),$("#phVerLink").text("Waiting for your response ...."),setTimeout(doPhoneVerPoll,5e3)):$("#verificationMessage").html("<span style='color:red'>Could not connect to the above number, please correct the number & try again.</span> If number is correct, please try again later."),hideLoading()},error:function(a){displayGenericError(),hideLoading()}})}function makePhVerEdit(){$("#verPhone").removeAttr("readonly"),$("#phVerLink").removeAttr("disabled").removeClass("disabled")}function makePhRO(){$("#verPhone").attr("readonly","true"),$("#phVerLink").attr("disabled","disabled").addClass("disabled")}function doPhoneVerPoll(){$.get("/twilio/phoneVerified",function(a){if(a)$("#phVerLink").text("Verification Complete!"),$("#verificationMessageExtra").html("<span style='color:green'>Redirecting back...</span>"),setTimeout(location.reload(),5e3);else{$("#phVerLink").data("count")<11&&setTimeout(doPhoneVerPoll,5e3),$("#phVerLink").data("count")>4&&$("#phVerLink").text("Still Waiting for a response...."),$("#phVerLink").data("count")>9&&($("#verificationMessageExtra").html("<span style='color:red'>It's taking longer than usual to verify, please click <a href='#' onclick='location.reload()'>here</a> once call is complete.</span>"),setTimeout(location.reload(),5e3));var b=$("#phVerLink").data("count");$("#phVerLink").data("count",b+1)}})}function saveUserProfile(){var a=new RegExp("^[0-9]+$"),b=new RegExp("^0d*");if($("#userProfileForm")[0].checkValidity()){if($("#profileContainer #mobile").is("input")){var c=$("#profileContainer #mobile").val().replace(/\s/g,""),d=$("#profileContainer #mobile").intlTelInput("getSelectedCountryData");if(!a.test(c))return void nbUtils.showFormError("mobile","Enter a valid phone number.","focus");if(b.test(c))return void nbUtils.showFormError("mobile","Enter a valid phone number.","focus");if(!validateIndianPhoneNumberOnly(c,d))return void nbUtils.showFormError("mobile","Enter a valid phone number.","focus")}var e="/profile/save",f=$("#userProfileForm :input").filter(function(){return""!=this.value}).not("#mobile").serialize();if($("#profileContainer #mobile").is("input")){if(""!=$("#userProfileForm :input#mobile").val()&&null!=$("#userProfileForm :input#mobile").val()){var d=$("input#mobile").intlTelInput("getSelectedCountryData"),g=$("#userProfileForm :input#mobile").val().replace(/\s+/g,"");f=f+"&phone=%2B"+d.dialCode+g}$("#verPhone").val("+"+d.dialCode+g)}showLoading(),$.post(e,f,function(a){}).done(function(a){hideLoading(),"success"==a.status?(displayAlerts(a.message,"success",5e3),"1"==a.isPhoneChanged&&showOtpVerificationPopUp()):displayAlerts(a.message,"danger",3e3)}).fail(function(a,b,c){displayGenericError(),hideLoading()})}else $("#hiddenSaveProfile").click()}function verifyPhone(){showLoading();var a=$("#phoneVerification #verPhone").intlTelInput("getNumber").replace(/\s/g,"");if(!validateIndianPhoneNumberOnly(a,$("#phoneVerification #verPhone").intlTelInput("getSelectedCountryData")))return displayAlerts("Please enter valid phone number","error",2e3),nbUtils.showFormError("phone_ver .intl-tel-input","Enter a valid phone number.","focus"),void hideLoading();if($("#phone_ver")[0].checkValidity()){if($("#phVerLink").attr("disabled",!0),$("#verPhone").val()!=$("#verPhone").data("original")){$("#verificationMessage").html("Saving your mobile number.....");var b=$("#phone_ver :input").filter(function(){return""!=this.value}).not("#verPhone").serialize();b=b+"&userPhone="+encodeURIComponent(a),console.log(b),$.ajax({url:"/twilio/migrateUserAccount/",data:b,type:"POST",success:function(a){if(a)$("#verificationMessage").html("<span class='nobroker-success'>Phone number saved successfully</span>"),$("#phoneVerification").modal("hide"),location.reload();else{$("#userOTPVer").val()?$("#verificationMessage").html("<span class='nobroker-error'>OTP entered is wrong. You can either use new number or        <a href  onclick='sendOTPForVerification();return false' style='color:green;font-decoration:underline'><strong>click here to generate OTP again</strong></a> and verify that you own this number</span>"):($("#verificationMessage").html("<span class='nobroker-error'>This phone number is already registered with us. Either use another number or        <a href  onclick='sendOTPForVerification();return false' style='color:green;font-decoration:underline'><strong>click here to generate OTP</strong></a> and verify that you own this number</span>"),$("#userOTPVer").hide(),$("#userOTPVer").prop("required",!1)),$("#verificationMessageExtra").html(""),$("#phVerLink").removeAttr("disabled"),hideLoading()}hideLoading()},error:function(a){displayGenericError(),hideLoading()}})}}else $("#hiddenVerSubmit").click();hideLoading()}function logEvents(a,b){"undefined"!=typeof nbGA&&nbGA.logEvent(a,b)}function sendOTPForVerification(a,b,c){var d=$("#verPhone").val();if(b&&(d=$("#userProfileForm #mobile").intlTelInput("getNumber")),c&&"undefined"!=typeof nbGA&&nbGA.logEvent("DisguiseUserDialog","GENERATE_OTP"),void 0!=d&&""!=d||void 0!=a&&""!=a){var e="/api/v2/public/user/sendOTP/";e=d?e+d+"?type=verification":e+a+"?type=verification",showLoading(),$.post(e,function(a){}).done(function(a){hideLoading(),a?(ga("send","event","OTP-VERIFICATION","OTP Requested","OTP requested for social login phone "+d),$("#verificationMessage").html(""),$("#verificationMessageExtra").html('<span class="nobroker-success">OTP Generated successfully, enter below to verify your phone number </span>'),displayAlerts("OTP Sent successfully to your phone","success",3e3),$("#userOTPVer").prop("required",!0),$("#userOTPVer").val(""),$("#userOTPVer").show(),$("#otpVerification").find("#otp-submit").attr("disabled",!1)):($("#userOTPVer").hide(),$("#userOTPVer").prop("required",!1),$("#userOTPVer").val("")),c&&"undefined"!=typeof nbGA&&nbGA.logEvent("DisguiseUserDialog","OTP_RECEIVED")}).fail(function(a,b,d){displayGenericError(),hideLoading(),c&&"undefined"!=typeof nbGA&&nbGA.logEvent("DisguiseUserDialog","OTP_NOTSENT")})}}function getAlertsPropReq(){var a=$("#nbpt").val(),b=preparePropertyQueryString(!1,!0,a),c=$("#getAlertsForm").serialize(),d=$("#getAlertsForm input[type='email']").val();b+="&"+c,postRequirement(b,d,!1,"")}function postRequirementRMDashboard(a,b,c,d){a.includes("AP")&&(a=a.replace(new RegExp("\\bAP\\b"),"APARTMENT")),a.includes("SHARED")&&(a+="&propType=SHARED"),setTimeout(hideRequirementPopup,100),$.ajax({url:"/api/v1/requirement/subscribe",type:"POST",data:a,"ga-log":"event","ga-category":"Requirement","ga-action":"submit",success:function(a){var e=b||$("#loggedInUserEmail").val();c||pingLogin(),d?displayAlerts(d,"warning",8e3):displayAlerts("Your requirement has been successfully captured, properties matching your requirement will be sent to "+e,"success",8e3);var f=window.location.href;if(f.includes("rmCustomer")){var g={function:"saveCommentRequirement"};g=JSON.stringify(g),window.parent.postMessage(g,"*")}if(f.includes("rmCustomer")){var g={function:"reloadPage"};g=JSON.stringify(g),window.parent.postMessage(g,"*")}},error:function(a){!1===c&&$("#alertReqPopup").modal("hide"),a.responseText?displayAlerts(a.responseText,"success",3e3):displayGenericError()}})}function postRequirement(a,b,c,d,e){setTimeout(hideRequirementPopup,100),$.ajax({url:"/ajax/requirement/submit",type:"POST",data:a,"ga-log":"event","ga-category":"Requirement","ga-action":"submit",success:function(a){if(e)return void e(null);var f=b||$("#loggedInUserEmail").val();c||pingLogin(),d?displayAlerts(d,"warning",8e3):displayAlerts("Your requirement has been successfully captured, properties matching your requirement will be sent to "+f,"success",8e3),saveSearch()},error:function(a){if(e)return void e(null);!1===c&&$("#alertReqPopup").modal("hide"),displayGenericError()}})}function hideRequirementPopup(){$(".req1Cancel").click()}function setPropLocation(a){var b=$("#propId").val();if($("#propLatitude").val(currentPosition.lat()).trigger("change"),$("#propLongitude").val(currentPosition.lng()).trigger("change"),!b)return!1;dummy_value=2;var c="/property/location/"+b,d="";void 0!=currentPosition&&(d="lat="+currentPosition.lat()+"&lng="+currentPosition.lng()),showLoading(),$.ajax({url:c,type:"POST",data:d,success:function(a){a?(displayAlerts("Location for this property is successfully set","success",3e3),$("#locCancel").click()):displayAlerts("Could not set location for this property now. Please try again later.","danger",3e3),hideLoading()},error:function(a){displayGenericError(),hideLoading()}})}function generateEmailVerification(){var a=$("#userId").val();if(a){var b="/generateVerificationEmail?userId="+a;$.post(b,null,function(a){}).done(function(a){hideLoading(),"success"==a.status?displayAlerts(a.message,"success",5e3):displayAlerts(a.message,"danger",3e3)}).fail(function(a,b,c){displayGenericError(),hideLoading()})}}function forgotPassword(a){var b="";if(a?b=$("#userNameProfile").val():void 0!=$("#userName").val().trim().match("(^[a-z0-9._%+-]+@[a-z0-9.-]+.[a-z]{2,4}$)")&&(b=$("#userName").val().trim()),b){var c="/forgotPassword/"+b;showLoading(),$.post(c,null,function(a){}).done(function(a){if(hideLoading(),a){var c="Sent email to "+b+" with steps to reset the password.";displayAlerts(c,"success",5e3),$("#signInMessage").text(c),$("#signInMessage").show(),$("#signInError").hide()}else{var c=b+" is not registered with us.";displayAlerts(c,"danger",3e3),$("#signInError").text(c),$("#signInError").show(),$("#signInMessage").hide()}}).fail(function(a,b,c){displayGenericError(),hideLoading()})}else displayAlerts("Please enter email address to reset the password","danger",3e3),$("#signInError").text("Please enter email address to reset the password"),$("#signInError").show()}function performSignIn(a){$("#signInError").text(""),$("#signInMessage ").text(""),showLoading(),$.post("/signin/form",a,function(a){}).done(function(a){hideLoading(),"true"==a.status?($("#dosignin").modal("hide"),gaLogging.logEventWithProductType("SignIn","login success",{}),a.outcome.includes("/property/manage")?checkPostedProperty(a.outcome):window.location.href=a.outcome):(gaLogging.logEventWithProductType("SignIn","login error",{}),displayAlerts(a.outcome,"danger",3e3),$("#signInError").text(a.outcome).show())}).fail(function(a,b,c){displayGenericError(),hideLoading()})}function checkUser(a){showLoading(),$.post("/signup/check/agent",a,function(a){}).done(function(a){var b="";hideLoading(),"success"==a?(b="No policy issues found, continue with usual work!",$("#listingNotLoggedIn").removeClass("disabled"),$("#listingNotLoggedIn").show(),$("#checkUserSuccess").text(b).show()):($("#listingNotLoggedIn").hide(),b="e"==a?"User already exists with this email address":"p"==a?"User already exists with this mobile number.":"ep"==a?"User already exists with this email address & mobile number.":"broker"==a?"User is a broker!":a,$("#checkUserError").text(b).show())}).fail(function(a,b,c){displayGenericError(),hideLoading()})}function checkExistingUser(a){showLoading(),$.post("/signup/check",a,function(a){}).done(function(a){if(hideLoading(),"success"==a)$("#hiddenSubmit").click(),gaLogging.logEventWithProductType("SignUp","success",{});else{var b="";"e"==a?(b="This email is already registered. You may have used used facebook or google to sign in earlier or forgotten your password.",gaLogging.logEventWithProductType("SignUp","newAccountEmailExists",{})):"p"==a?(b="This mobile number is already registered. Please enter a different mobile number.",gaLogging.logEventWithProductType("SignUp","newAccountPhoneExists",{})):"ep"==a?(b="You are already registered with us. Please use Sign in link below to login.",gaLogging.logEventWithProductType("SignUp","newAccountExists",{})):"broker"==a&&(b="An error occurred while your registration. Kindly send us a mail on hello@nobroker.in for more assistance.",gaLogging.logEventWithProductType("SignUp","newAccountBroker",{})),$("#registerError").text(b).show()}}).fail(function(a,b,c){ga("send","event","SignUp","newAccountError","new account creation failed"),displayGenericError(),hideLoading()})}function toggleShortlist(a,b,c,d,e){var f=!1;"true"==$("#listShortlist"+a).attr("data-sponsored")&&(f=!0);var g="",h="";if(d&&(g=c?"list-"+d.toLowerCase():"detail-"+d.toLowerCase(),h="&_nbfr="+g),$("#isULIN").val(),"true"!=$("#isULIN").val())showLoginPopUp(a,b,c,d);else{var i="/property/json/shortlist/"+a+"?"+h;$.ajax({url:i,type:"POST",success:function(g){if(event&&(event.target.disabled=!1),"Unauthorized"==g.outcome)showLoginPopUp(a,b,c);else{if("true"==g.outcome){f&&triggerZopimForShortlistedProperty(c,zopimUrls.shortlist),displayAlerts("Property successfully added to your shortlist.","success",3e3),toggleShortlistButton(b,!0,c),gaLogging.logEventWithProductType("ShortList","add",{});var h={content_ids:[a],content_category:d,content_type:"product",content_name:"FromListPage: "+c};nbEvents.logViewProperty({propId:a,params:h,actionType:"shortListDone"}),void 0!==e?shortlistPropertyAdobeEvent(e,c):"undefined"!=typeof listPropertyArray&&null!=listPropertyArray&&(propertyData=listPropertyArray.find(function(b){return b.propertyID===a}),propertyData&&shortlistPropertyAdobeEvent(propertyData,!1))}else displayAlerts("Property successfully removed from your shortlist.","success",3e3),toggleShortlistButton(b,!1,c),gaLogging.logEventWithProductType("ShortList","remove",{});$('[data-action="shortlistCount"]').html(g.count),setTimeout(function(){location.reload()},3e3)}},error:function(a){displayGenericError(),event&&(event.target.disabled=!1)}})}}function triggerZopimForShortlistedProperty(a,b){a||(a="detail"),b||(b=zopimUrls.rentDetailPage),$.ajax({url:"/api/v1/admin/zopim/setting/getZopimStatus",type:"GET",complete:function(c){if("200"==c.status){var d=JSON.parse(c.responseText);d.data&&d.data.zopimStatus&&"1"===d.data.zopimStatus&&setTimeout(function(){$zopim&&$zopim.livechat&&$zopim.livechat.sendVisitorPath&&($zopim.livechat.sendVisitorPath({url:b,title:"zopim-desktop-"+a}),nbGA&&nbGA.logEvent("triggerZopim","desktop-"+a,{}),"true"===$("#isULIN").val()?($zopim.livechat.setPhone($("#loggedInUserPhone").val()),$zopim.livechat.setEmail($("#loggedInUserEmail").val()),$zopim.livechat.setName($("#loggedInUserName").val())):userInfo&&userInfo.phone&&userInfo.email&&userInfo.name&&($zopim.livechat.setPhone(userInfo.phone),$zopim.livechat.setEmail(userInfo.email),$zopim.livechat.setName(userInfo.name)))},3e3)}}})}function toggleShortlistCallback(a){if("Unauthorized"==a.outcome)showLoginPopUp(propertyId,buttonId,detailPage);else{if("true"==a.outcome){displayAlerts("Property successfully added to your shortlist.","success",3e3),toggleShortlistButton(buttonId,!0,detailPage),gaLogging.logEventWithProductType("ShortList","add",{});var b={content_ids:[propertyId],content_category:propertyType,content_type:"product",content_name:"FromListPage: "+detailPage};nbEvents.logViewProperty({propId:propertyId,params:b,actionType:"shortListDone"})}else displayAlerts("Property successfully removed from your shortlist.","success",3e3),toggleShortlistButton(buttonId,!1,detailPage),gaLogging.logEventWithProductType("ShortList","remove",{});$('[data-action="shortlistCount"]').html(a.count)}}function showLoginPopUp(a,b,c,d){var e={};e.fromPage="shortlist",e.flow="shortlist",e.propId=a,e.buttonId=b,e.detailPage=c,userRegistrationModalHelper.registerFlow("shortlist",e,null,shortlistPostHandler);var f={content_name:"FromListPage: "+c+" PropertyType: "+d};facebookEvent.fbEvent("Lead","",f)}function toggleShortlistButton(a,b,c){$("#"+a).removeClass("btn-shortlist btn-shortlist-selected"),b?c?($("#shortlistTxt").html("Shortlisted"),$(".shortlistDetailPageIcon").removeClass("icon-heart-empty").addClass("icon-heart").css("color","#fd3753")):$("#"+a).removeClass("icon-heart-empty").addClass("icon-heart").css("color","#fd3753"):c?($("#shortlistTxt").html("Add to Shortlist"),$(".shortlistDetailPageIcon").removeClass("icon-heart").addClass("icon-heart-empty").css("color","#000")):$("#"+a).removeClass("icon-heart").addClass("icon-heart-empty").css("color","#707070")}function getSelectedChecboxValues(a){var b=new Array;return $.each($("input[name="+a+"]:checked"),function(){b.push($(this).val())}),b.toString()}function getLatLngForALocation(a){$.getJSON("/static/mumbai.json",function(b){for(i=0;i<b.mumbai.length;i++)if(a==b.mumbai[i].name)return b.mumbai[i].location})}function extractDataValue(a,b){var c=$("#filterPanelForm input[data-name="+a+"]:checked"),d=new Array,e=b||"value";return $.each(c,function(a,b){d.push($(b).data(e))}),d}function prepareResalePropertyQueryString(a){localStorage.removeItem("filters");var b="",c=$("#priceMin").data("value"),d=$("#priceMax").data("value");c||(c="0"),d&&"Any"!=d||(d=1e8),b=b+"&price="+c+","+d;var e=$("#lat_lng").val();e&&(b=b+"&lat_lng="+e,b=b+"&latitude="+e.split(",")[0]+"&longitude="+e.split(",")[1]),b=b+"&exclusiveProperty="+($("#exclusiveProperty").prop("checked")?"true":"false");var f=getCheckboxOrRadioValue("withPics");"1"==f&&(b=b+"&withPics="+f);var g=getCheckboxOrRadioValue("propType");g&&(b=b+"&propType="+g);var h=getCheckboxOrRadioValue("type");h&&(b=b+"&type="+h);var i=getCheckboxOrRadioValue("propertyAge");i&&(b=b+"&propertyAge="+i);var j=getCheckboxOrRadioValue("bathroom");j&&(b=b+"&bathroom="+j);var k=getCheckboxOrRadioValue("gym");k&&(b=b+"&gym="+k);var l=getCheckboxOrRadioValue("swimmingPool");l&&(b=b+"&swimmingPool="+l);var m=getCheckboxOrRadioValue("lift");m&&(b=b+"&lift="+m);var n=getCheckboxOrRadioValue("parking");n&&(a?b+="&parking=BOTH":b=b+"&parking="+n);var o=$('[data-display="'+$("#sort").val()+'"]').data("value");if($("#sort").val()&&(b=b+"&orderBy="+o),a){b+="&showMap=true";var p=map.radius;radiusWidget&&(p=parseFloat(radiusWidget.get("distance").toFixed(2))),b=b+"&radius="+p}else b=b+"&radius="+map.radius,b=checkAndAddNearbyParams(b);var q=$("#travelMinutes").val(),r="";return r=$("input[name=traffic]").length&&$("input[name=traffic]").is(":checked")?"true":"false",b=q?b+"&traffic="+r+"&travelTime="+q:b+"&traffic="+r+"&travelTime="+DEFAULT_TRAVEL_TIME,updateDefaultFilterCount(!0),b+=getPremiumFilterString(),localStorage.setItem("filters",b),b}function preparePropertyQueryString(a,b,c){localStorage.removeItem("filters");var d="";if($("#rentSlider").val()&&$("#rentSlider").val().split(",").length>1){d+="&rent="+(b?$("#rentSlider").val().split(",")[1]:$("#rentSlider").val())}var e=parseInt($("#priceMin").val()),f=parseInt($("#priceMax").val());"Any"==f&&(f=5e5),b&&(e=$(".rent-range-modal #minPriceRange").val()||e,f=$(".rent-range-modal #maxPriceRange").val()||f),(e||f)&&(d=d+"&rent="+(b?f:e+","+f));var g=getCheckboxOrRadioValue("withPics");"1"==g&&(d=d+"&withPics="+g);var h="0";"SHARED"==c.toUpperCase()&&(h="1"),"0"!=h&&"1"!=h||(d=d+"&sharedAccomodation="+h);var i=getCheckboxOrRadioValue("accomodationType"),j=getCheckboxOrRadioValue("tenantType");"1"==h&&(i&&(d=d+"&accomodationType="+i),j&&(d=d+"&tenantType="+j));var k=getCheckboxOrRadioValue("propType");k&&(d=d+"&type="+k);var l=getCheckboxOrRadioValue("bathroom");l&&(d=d+"&bathroom="+l);var m=getCheckboxOrRadioValue("gym");m&&(d=d+"&gym="+m);var n=getCheckboxOrRadioValue("pool");n&&(d=d+"&swimmingPool="+n);var o=getCheckboxOrRadioValue("lift");o&&(d=d+"&lift="+o),$("#propertyAge").val()&&(d=d+"&propertyAge="+$("#propertyAge").val());var p=getCheckboxOrRadioValue("parking");p&&(d=d+"&parking="+p);var q=getCheckboxOrRadioValue("furnishing");q&&(d=d+"&furnishing="+q);var r=getCheckboxOrRadioValue("leaseType");r&&(d=d+"&leaseType="+r);var s=getCheckboxOrRadioValue("buildingType");s&&(d=d+"&buildingType="+s);var t=getCheckboxOrRadioValue("leaseOnly");"1"==t&&(d=d+"&leaseOnly="+t);var u=getCheckboxOrRadioValue("availability");u&&(d=d+"&availability="+u);var v=$("#lat_lng").val();if(b)d=d+"&propertyType="+("1"===h?"SHARED":"APARTMENT"),d=d+"&locality="+homepage_selected_localities[0].placeName,d=d+"&latitude="+v.split(",")[0]+"&longitude="+v.split(",")[1];else{var w=$('[data-display="'+$("#sort").val()+'"]').data("value");if($("#sort").val()&&(d=d+"&orderBy="+w),a){d+="&showMap=true";var x=map.radius;radiusWidget&&(x=parseFloat(radiusWidget.get("distance").toFixed(2))),d=d+"&radius="+x}else d=d+"&radius="+map.radius,d=checkAndAddNearbyParams(d);var y=$("#travelMinutes").val(),z="";z=$("input[name=traffic]").length&&$("input[name=traffic]").is(":checked")?"true":"false",d=y?d+"&traffic="+z+"&travelTime="+y:d+"&traffic="+z+"&travelTime="+DEFAULT_TRAVEL_TIME}return updatePremiumFilterCount(),updateDefaultFilterCount(!1),d+=getPremiumFilterString(),localStorage.setItem("filters",d),d}function prepareCommercialRentPropertyQueryString(a,b){localStorage.removeItem("filters");var c="";propertyType="COMMERCIAL_RENT";var d=parseInt($("#priceMin").val()),e=parseInt($("#priceMax").val());"Any"==e&&(e=5e5),b&&(d=$(".rent-range-modal #minPriceRange").val()||d,e=$(".rent-range-modal #maxPriceRange").val()||e),(d||e)&&(c=c+"&rent="+(b?e:d+","+e));var f=getCheckboxOrRadioValue("withPics");"1"==f&&(c=c+"&withPics="+f),$("#lat_lng").val()&&(c=c+"&lat_lng="+$("#lat_lng").val());var g=getCheckboxOrRadioValue("commercialPropertyType");g&&(c=c+"&commercialPropertyType="+g);var h=(parseInt($("#priceMin").val()),parseInt($("#priceMax").val()),getCheckboxOrRadioValue("lift"));h&&(c=c+"&commercialLift="+h);var i=getCheckboxOrRadioValue("power_backup");i&&(c=c+"&commercialPowerBackUp="+i);var j=getCheckboxOrRadioValue("ageType");j&&(c=c+"&ageOfProperty="+j);var k=getCheckboxOrRadioValue("localityType");k&&(c=c+"&localityType="+k);var l=getCheckboxOrRadioValue("availability");l&&(c=c+"&availability="+l);var m=getCheckboxOrRadioValue("parkingType");m&&(c=c+"&commercialParking="+m);var n=getCheckboxOrRadioValue("furnishing");n&&(c=c+"&furnishing="+n);var o=getCheckboxOrRadioValue("buildingType");o&&(c=c+"&buildingType="+o);var p=$("#lat_lng").val();if(b)c+="&propertyType=COMMERCIAL_RENT",c=c+"&locality="+homepage_selected_localities[0].placeName,c=c+"&latitude="+p.split(",")[0]+"&longitude="+p.split(",")[1];else{var q=$('[data-display="'+$("#sort").val()+'"]').data("value");if($("#sort").val()&&(c=c+"&orderBy="+q),a){c+="&showMap=true";var r=map.radius;radiusWidget&&(r=parseFloat(radiusWidget.get("distance").toFixed(2))),c=c+"&radius="+r}else c=c+"&radius="+map.radius,c=checkAndAddNearbyParams(c);var s=$("#travelMinutes").val(),t="";t=$("input[name=traffic]").length&&$("input[name=traffic]").is(":checked")?"true":"false",c=s?c+"&traffic="+t+"&travelTime="+s:c+"&traffic="+t+"&travelTime="+DEFAULT_TRAVEL_TIME,""!=$("#farea").val()&&(c+="&carpetArea="+$("#farea").val())}return updateDefaultFilterCount(!1),localStorage.setItem("filters",c),c}function prepareCommercialBuyPropertyQueryString(a){localStorage.removeItem("filters");var b="",c=parseInt($("#priceMin").val()),d=parseInt($("#priceMax").val());"Any"==d&&(d=2e7),(c||d)&&(b=b+"&price="+c+","+d);var e=getCheckboxOrRadioValue("withPics");"1"==e&&(b=b+"&withPics="+e),$("#lat_lng").val()&&(b=b+"&lat_lng="+$("#lat_lng").val());var f=getCheckboxOrRadioValue("commercialPropertyType");f&&(b=b+"&commercialPropertyType="+f);var g=getCheckboxOrRadioValue("lift");g&&(b=b+"&commercialLift="+g);var h=getCheckboxOrRadioValue("power_backup");h&&(b=b+"&commercialPowerBackUp="+h);var i=getCheckboxOrRadioValue("ageType");i&&(b=b+"&ageOfProperty="+i);var j=getCheckboxOrRadioValue("localityType");j&&(b=b+"&localityType="+j);var k=getCheckboxOrRadioValue("availability");k&&(b=b+"&availability="+k);var l=getCheckboxOrRadioValue("parkingType");l&&(b=b+"&commercialParking="+l);var m=getCheckboxOrRadioValue("furnishing");m&&(b=b+"&furnishing="+m);var n=getCheckboxOrRadioValue("buildingType");n&&(b=b+"&buildingType="+n);var o=($("#lat_lng").val(),$('[data-display="'+$("#sort").val()+'"]').data("value"));if($("#sort").val()&&(b=b+"&orderBy="+o),a){b+="&showMap=true";var p=map.radius;radiusWidget&&(p=parseFloat(radiusWidget.get("distance").toFixed(2))),b=b+"&radius="+p}else b=b+"&radius="+map.radius,b=checkAndAddNearbyParams(b);var q=$("#travelMinutes").val(),r="";return r=$("input[name=traffic]").length&&$("input[name=traffic]").is(":checked")?"true":"false",b=q?b+"&traffic="+r+"&travelTime="+q:b+"&traffic="+r+"&travelTime="+DEFAULT_TRAVEL_TIME,""!=$("#farea").val()&&(b+="&carpetArea="+$("#farea").val()),updateDefaultFilterCount(!1),localStorage.setItem("filters",b),b}function getPremiumFilterString(){var a="";return""!=$("#farea").val()&&(a+="&farea="+$("#farea").val()),$("#plotArea").val()&&(a+="&plotArea="+$("#plotArea").val()),$("#premiumFilterPanelForm .premiumFilterPanel").each(function(){var b=$(this).find("input").attr("name"),c=getCheckboxOrRadioValue(b);c&&(a+="&"+b+"="+c)}),updatePremiumFilterCount(),a}function preparePgPropertyQueryString(a,b){localStorage.removeItem("filters");var c="";if($("#rentSlider").val()&&$("#rentSlider").val().split(",").length>1){c+="&rent="+(b?$("#rentSlider").val().split(",")[1]:$("#rentSlider").val())}var d=$("#priceMin").val(),e=$("#priceMax").val();d||(d="0"),e&&"Any"!=e||(e=2e6),b&&(d=$(".rent-range-modal #minPriceRange").val()||d,e=$(".rent-range-modal #maxPriceRange").val()||e),c=c+"&rent="+(b?e:d+","+e);var f=getCheckboxOrRadioValue("gender");"0"==f?c+="&gender=MALE":"1"==f&&(c+="&gender=FEMALE"),$("#lat_lng").val()&&(c=c+"&lat_lng="+$("#lat_lng").val());var g=getCheckboxOrRadioValue("occupancy");g&&(c=c+"&occupancy="+g);var h=getCheckboxOrRadioValue("attachBathroom");h&&(c=c+"&attachedBathroom="+h);var i=getCheckboxOrRadioValue("breakfast");i&&(c=c+"&breakfast="+i);var j=getCheckboxOrRadioValue("lunch");j&&(c=c+"&lunch="+j);var k=getCheckboxOrRadioValue("dinner");k&&(c=c+"&dinner="+k);var l=getCheckboxOrRadioValue("preferred");l&&(c=c+"&availableFor="+l);var m=$("#lat_lng").val(),n=$('[data-display="'+$("#sort").val()+'"]').data("value");$("#sort").val()&&(c=c+"&orderBy="+n);var o=getCheckboxOrRadioValue("withPics");if("1"==o&&(c=c+"&withPics="+o),a){c+="&showMap=true";var p=map.radius;radiusWidget&&(p=parseFloat(radiusWidget.get("distance").toFixed(2))),c=c+"&radius="+p}else c=c+"&radius="+map.radius,c=checkAndAddNearbyParams(c);b&&(c=c+"&propertyType="+("1"===sharedAcc?"SHARED":"APARTMENT"),c=c+"&locality="+homepage_selected_localities[0].placeName,c=c+"&latitude="+m.split(",")[0]+"&longitude="+m.split(",")[1]);var q=$("#travelMinutes").val(),r="";return r=$("input[name=traffic]").length&&$("input[name=traffic]").is(":checked")?"true":"false",c=q?c+"&traffic="+r+"&travelTime="+q:c+"&traffic="+r+"&travelTime="+DEFAULT_TRAVEL_TIME,localStorage.setItem("filters",c),c}function appendNearbyPropertyQuery(a){if(-1==a.indexOf("nearby=true")){getCheckboxOrRadioValue("nearby")?(window.showingNearby=!0,window.getNearby=!1,a+="&nearby=true&include_parent=true",$("#nearbyText").removeClass("hide")):$("#nearbyText").addClass("hide")}return a}function checkAndAddNearbyParams(a){if($("#nearByFilter").is(":visible")){getCheckboxOrRadioValue("nearby")?(window.showingNearby=!0,window.getNearby=!1,a+="&nearby=true&include_parent=true",$("#nearbyText").removeClass("hide")):window.getNearby&&(window.showingNearby=!0,a+="&nearby=true&include_parent=false",$("#nearbyText").addClass("hide"))}return a}function clearFilterByName(a){$("input[name="+a+"]").removeClass("selected"),$("input[name="+a+"]").prop("checked",!1)}function clearFilterFor(a){$("div [data-name="+a+"]").removeClass("selected"),$("div [data-name="+a+"]").prop("checked",!1)}function intiateMapView(){var a=$("#lat_lng").val().split(/,\s*/),b=$("#isMobile").val();map.defaultZoom=14,"true"==b&&(map.defaultZoom=13),map.currentPosition=new google.maps.LatLng(parseFloat(a[0]),parseFloat(a[1])),map.init("#map-canvas",map.currentPosition),map.reset()}function intiateMapViewInPopup(a,b){gaLogging.logEventWithProductType("NearbyMap","clickViewLocation",{}),$("#listMap").on("shown.bs.modal",function(){map.currentPosition=new google.maps.LatLng(parseFloat(a),parseFloat(b)),map.init("#map-canvas1",map.currentPosition),map.defaultZoom=16,map.reset(),map.addPinForCurrentPosition()})}function setUnselectRadioByName(a){$('.nbRadioGroup [name="'+a+'"]').off(),$('.nbRadioGroup [name="'+a+'"]:checked').click(function(a){$(a.target).removeAttr("checked"),$(a.target).off(),updateFilterCount(),doSearchAndUpdateResults(),gaLogging&&$(a.target).parents('div [data-ga-log-child="radio"]').length>0&&gaLogging.logRadioEvents.call($(a.target))})}function getCheckboxOrRadioValue(a){var b=new Array;return $("input[name="+a+"]").each(function(){$(this).is(":checked")&&b.push($(this).val())}),b.toString()}function setValueForPrice(a,b){for(var c=$('a[data-type="'+a+'"]'),d=0;d<c.length;d++)if(b==$(c.get(d)).data().value){var e=$(c.get(d)).data(),f=e.type;$("#"+f).data(e),$("#"+f).val(e.display)}}function doSearchAndUpdateResults(){window.showingNearby=!1,window.getNearby=!1,prepareQueryAndGetSearchResults(!1),fetchBuilderCards(!1)}function doSearchForPagination(){prepareQueryAndGetSearchResults(!0)}function prepareQueryAndGetSearchResults(a,b){function c(c){if("undefined"!=typeof window){window.location.href.includes("showMap")&&addAdobePageLoadEvent()}if(201==c.status_code&&k){hideNearbyPropertiesFilter(),$(".travelTimeFilter").removeClass("hide"),$(".lastSearch").hide();var d="/api/v2/property/maps?"+l;propertyResults.processSearchQueryOnMapView(d,c.status_code,B,A)}else if(201==c.status_code?($(".lastSearch").hide(),$(".travelTimeFilter").removeClass("hide")):($(".travelTimeFilter").addClass("hide"),l=removeQueryParameter(l,"traffic"),l=removeQueryParameter(l,"travelTime")),k||203!=c.status_code?(isRegion=!1,hideNearbyPropertiesFilter()):(isRegion=!0,showNearbyPropertiesFilter(),l=appendNearbyPropertyQuery(l)),k){$("#lat_lng").val()&&(l+="&latitude="+$("#lat_lng").val().split(",")[0]+"&longitude="+$("#lat_lng").val().split(",")[1]);var d="/api/v2/property/maps?"+l;propertyResults.processSearchQueryOnMapView(d,c.status_code)}else{var e="/property/"+m+"/"+i+"/"+n+"/"+o+"/?"+l;propertyResults.processSearchQueryOnListView(e,a,b)}}function d(a,b){$.ajax({url:"/api/v4/localities/"+a+"/type",success:function(d){"undefined"!=typeof Storage&&localStorage.setItem("locality-"+a,JSON.stringify(d)),c(d),nbCache.put(b,d,{staleTime:1440})}})}var e=$("#nbpt").val(),f=$("#productType").val();"RESALE"==f&&(f="BUY");var g=$("#nbpt").val();$("#productType").val(g),"BUY"==$("#nbpt").val()&&(g="SALE",$("#productType").val("RESALE"));var h,i="rent",j="rent",k=$("#panel-map").hasClass("active");h=googleAutoComplete.selectedLocation?googleAutoComplete.selectedLocation.place_id:$("#nbPlace").val();var l="searchParam="+window.btoa(JSON.stringify(homepage_selected_localities));"RENT"==g.toUpperCase()||"SHARED"==g.toUpperCase()?l+=preparePropertyQueryString(k,!1,g):"SALE"==g.toUpperCase()||"BUY"==g.toUpperCase()?(l+=prepareResalePropertyQueryString(k),i="sale",j="sale"):"COMMERCIAL_RENT"==g.toUpperCase()?(l+=prepareCommercialRentPropertyQueryString(k,!1),i="commercial/rent",j="commercial_rent"):"COMMERCIAL_BUY"==g.toUpperCase()?(l+=prepareCommercialBuyPropertyQueryString(k),i="commercial/buy",j="commercial_buy"):(l+=preparePgPropertyQueryString(k),i="pg",j="pg"),l+="&propertyType="+j;var m="";k?(m="json",h=homepage_selected_localities.find(function(a){return!0===a.showMap}).placeId):m="ajax";var n=getCity(),o=homepage_selected_localities.length>1?"multiple":homepage_selected_localities[0].placeName;if(window.location.href.includes("sharedAccomodation=1")&&"RENT"===f&&(f="SHARED"),f!=e&&!a){var p="";p="/?searchParam="+window.btoa(JSON.stringify(homepage_selected_localities));var q="/property/"+i+"/"+n+"/"+o+p;$("#lat_lng").val()&&(q+="&lat_lng="+$("#lat_lng").val()),k&&(q+="&showMap=true&radius=2.0"),$("#productType").val(e),"BUY"==e&&$("#productType").val("RESALE"),"SHARED"==e?q+="&sharedAccomodation=1":"RENT"==e&&(q+="&sharedAccomodation=0");var r=window.location.host;return void window.location.replace("http://"+r+q)}if(a){var s,t,u=nbUtils&&nbUtils.extractQueryParams(window.location.href);u&&u.pageNo?(s=parseInt(u.pageNo),t=s+1,$("#showMore").data("page",t)):window.getNearby?(s=$("#showMore").data("nearbyPage"),t=s+1,$("#showMore").data("nearbyPage",t)):(s=$("#showMore").data("page"),t=s+1,$("#showMore").data("page",t)),s>=2&&$("#showMoreDiv").show(),l=l+"&pageNo="+t,2==s&&"true"==$("#isULIN").val()&&askNotificationPermission(),nbAdobeEvents.registerEvent(digitalData.pageInfo,"page_Depth",digitalData.userInfo,{eventName:"page_depth",eventType:"scroll"},null,null,null,null,null,null,null,null,null,"Page "+t)}else $("#showMore").data("page",1),$("#showMoreDiv").hide();var n=getCity(),v=window.location.href;if(googleAutoComplete.currentLocation);else{var w=v.split("?rent")[0].split("/");"SALE"==g&&(w=v.split("?price")[0].split("/"));var x=w[w.length-1];x||(x=w[w.length-2])}var y="/property/"+i+"/"+n+"/"+o+"/?"+l,z=document.title;y=removeQueryParameter(y,"nearby"),y=removeQueryParameter(y,"include_parent"),History.pushState("",z,y),document.title=z,ga("send",{hitType:"pageview",page:y}),a?($(".loading-results").show(),$("#showMoreDiv").hide()):showLoading("",!0);var A=$("#travelMinutes").val();A||(A=parseInt(DEFAULT_TRAVEL_TIME));var B=$("input[name=traffic]").length&&$("input[name=traffic]").is(":checked");B?B="traffic":B="no_traffic",l=manageActivationDate(l);var C;if(C)C=JSON.parse(C),c(C);else if("undefined"!=typeof nbCache){var D=h+"-type",E=multipleLocationSelectorHelper.getLocalityPlaceId(homepage_selected_localities,k);if(E)nbCache.get(D,{loader:d(E,D)});else{$(".travelTimeFilter").addClass("hide"),l=removeQueryParameter(l,"traffic"),l=removeQueryParameter(l,"travelTime");var F="/property/"+m+"/"+i+"/"+n+"/"+o+"/?"+l;propertyResults.processSearchQueryOnListView(F,a,b)}}}function showLoading(a,b){b?(progressJs().start(),progressJs().set(40)):(a=a||"Loading...",$(".busy-holder").show(),$(".busy-holder").removeClass("hide"),$(".loading-text").html(a))}function hideLoading(){$(".busy-holder").hide(),hideProgressBar()}function hideProgressBar(){"undefined"!=typeof progressJs&&progressJs().end()}function registerWindowScrollPagination(){$(window).scroll(function(){var a=$(window),b=($(document),$("#showMore").data("page"));window.getNearby&&(b+=$("#showMore").data("nearbyPage")),a.scrollTop()>=2850*b&&($("#showMore").is(":visible")||$("#showMore").click()),nbPropertyImpressions&&(nbPropertyImpressions.setScrollTop(a.scrollTop()),nbPropertyImpressions.sendDataToWorker())})}function unBindScrollPagination(a){if(a)$(window).unbind("scroll");else if(!isRegion||window.showingNearby||$("#activationDateRM").length)$(window).unbind("scroll"),$("#showMore").hide(),$("#noResLoc").html(googleAutoComplete.currentLocation),$("#noMoreResults").show();else{window.getNearby=!0,$("#showMore").data("nearbyPage",0);var b=homepage_selected_localities.length>1?"multiple":homepage_selected_localities[0].placeName;(0==window.noResultsPage&&0==window.nearByShown||"false"==window.noResultsPage&&"false"==window.nearByShown)&&(b="multiple"===b?"your searched localities":b,$(".showing-near-by").addClass("hide"),$(".header-list-nearby").addClass("hide"),$("#listResults").append('<div id="showingNearbyProperties">Showing properties near <b>'+b+"</b></div>"),prepareQueryAndGetSearchResults(!0,!0))}$("#seoFooter").is(":visible")&&$(window).on("scroll",hideSeoFooter)}function selectImgInCarousel(a,b){var c=b.id.split("thumb")[1];$("#"+a+" .carousel-inner div.active").removeClass("active"),$("#"+a+" .carousel-inner div:nth-child("+c+")").addClass("active")}function hideHelpContent(){$("#helpText #helpContent2").text(""),$("#helpText #helpContent").text(""),$("#helpText #helpHeading").text(""),$("#helpText #helpContent2").hide(),$("#helpText #helpContent").hide(),$("#helpText #helpHeading").hide(),$("#helpText").hide()}function sendEvent(){nbEvents.logPageView({pageType:"PYP"})}function showHelpContent(a){var b=a.offset().top,c=a.data("helpHeading"),d=a.data("helpContent"),e=a.data("helpContent2"),f=a.data("extraSpace");e&&($("#helpText #helpContent2").text(e),$("#helpText #helpContent2").show()),d&&($("#helpText #helpContent").text(d),$("#helpText #helpContent").show()),c&&($("#helpText #helpHeading").text(c),$("#helpText #helpHeading").show()),f?$("#helpText").css("top",b-300):$("#helpText").css("top",b-100),(c||d||e)&&$("#helpText").show()}function showSignUp(a){a?$("#userVerificationModal").data("fromPage",a):$("#userVerificationModal").data("fromPage","headerSignup"),$("#userVerificationModal").modal("show"),$("#userVerificationModal .titleSideBar h4").html("Create NoBroker Account"),$("#userVerificationModal #loginPopUpTitle").html("Your contact number is necessary for us to verify your identity"),nbEvents.logUserRegistration({content_name:"FromPage: HeaderSignup",isLoggedIn:!1})}function showSignIn(){var a={};a.flow="default",userRegistrationModalHelper.registerFlow("default",a,null,postSignUpHandler)}function hideSignUp(){$("#dosignup").modal("hide")}function hideSignIn(){$("#dosignin").modal("hide")}function hideOwnerDetail(){$("#ownerDetailPopup").modal("hide")}function showOwnerDetail(a){$("#userVerificationModal").modal("hide"),$("#ownerDetailPopup #message").html(a),$("#ownerDetailPopup").modal("show")}function prePopulateContactForm(){try{localStorage&&(localStorage.userName&&$("[name=userName]").val(localStorage.userName),localStorage.userEmail&&$("[name=userEmail]").val(localStorage.userEmail),localStorage.userName&&$("[name=userPhone]").val(localStorage.userPhone))}catch(a){}}function sendOwnerContact(a,b,c,d){$(".nobrokerSlider_fullscreen").remove();var e={};e.fromPage=c,e.propertyId=a,$("#selectedPropId").val(a);var f=$("#nbpt").val(),g=!1;void 0!==d&&(propertyDataForAdobe=d),"true"==$("#contactOwnerBtn"+a).attr("data-sponsored")&&(g=!0);var h="true"==$("#isULIN").val();if("true"!=$("#isULIN").val()){var i={};i.fromPage=c,i.flow="contactOwner",i.propId=a,i.propertyRent=b,$("#tenantSchedulerModal").modal("hide");var j="tenantSchedule"===c||"sponsoredPropertyDetail"===c?"scheduleVisit":"contactOwner";userRegistrationModalHelper.registerFlow(j,i,null,contactOwnerPostHandler);var k={content_name:"FromPage: "+c};facebookEvent.fbEvent("Lead","",k)}else gaLogging.logEventWithProductType("ContactOwner","UserLoggedIn",e),"sponsoredPropertyDetail"==c?invokeContactOwnerCall(a,b,scheduleVisitModal.scheduleSponsoredPropertyCallback,c,g):"tenantSchedule"!=c?invokeContactOwnerCall(a,b,"",c,g):invokeContactOwnerCall(a,b,function(){bookTenantAppointment()},c,g),"undefined"!=typeof listPropertyArray&&null!=listPropertyArray&&(propertyDataForAdobe=listPropertyArray.find(function(b){return b.propertyID===a}));nbEvents.logContactOwner({propId:a,propType:f,fromPage:c,loggedIn:h}),prePopulateContactForm()}function initUser(a){"true"==$("#isULIN").val()&&nbsocket.on("notification:counter",function(a){var b=$("#notification_count").text();try{b=parseInt(b,10)}catch(a){}isNaN(b)||(b+=1,$("#notification_count").text(b),$("#notification_count").addClass("show"))})}function initSocket(a){var b=window.location.host,c="chat.nobroker.in";(b.indexOf("beta.nobroker.in")>-1||b.indexOf("localhost")>-1)&&(c="54.169.178.77"),"undefined"!=typeof io&&(window.nbsocket=io.connect("//"+c,{query:"userId="+a}),nbsocket.emit("user:unreadMessages",a))}function openModalWindow(a,b,c,d,e,f,g,h,i,j){if("true"!=$("#isULIN").val()){var k={};return k.propId=a,k.fromPage=h,k.flow="chat",void userRegistrationModalHelper.registerFlow("chat",k,null,chatPostHandler)}var l={};h||(h="chat-window"),l.fromPage=h,i||(i="chat");var m=JSON.parse(localStorage.getItem("propertyData"));void 0!==m&&null!=typeof m&&nbAdobeEvents.registerEvent({pageName:"detailpage",platform:"nb-web",siteSection:"detailPage_chat",flowName:"search_journey",service:nbAdobeService.getServiceName($("#nbpt").val())},"prop_Call",getuserInfoForAdobeEvent(),{eventName:"call or message",eventType:"button click",ctaName:"chat with owner button",ctaURL:""},null,null,m),showLoading(),$.get("/api/v2/user/contacted/"+a,function(j){if(j&&j.data)if("true"==j.data.contacted){var k=j.data.owner_id;"chat"==i?openChat(a,b,c,d,e,f,g,k,h):"tenantSchedule"==i&&openTenantScheduleModal(),hideLoading()}else invokeContactOwnerCall(a,g,function(j){resp=j.message,j.propertyType&&(propertyType=j.propertyType),isNewUser=j.new_user,"true"==isNewUser&&gaLogging.logEventWithProductType("NewUser","ContactOwner",l),$("#ownerDetailPopup .modal-title").html("Owner Detail");var k=!0;if(("BROKER_NOTVERIFIED"==resp&&"tenantSchedule"!=h||"BROKER_NOTVERIFIED_NEW"==resp||"SENT_NEW"==resp||"SENT"==resp&&"tenantSchedule"!=h)&&nbEvents.logContactOwner({propId:$("#propId").val(),propType:j.propertyType,fromPage:h,actionType:"fbAddToCart",resp:resp}),"NOT_AUTHORIZED"==resp){ga("send","event","ContactOwner","UserDetail","Contact owner-asked for user details");var j={};j.propId=a,j.fromPage=h,j.flow="chat",userRegistrationModalHelper.registerFlow("chat",j,null,chatPostHandler),hideLoading()}else if("BROKER_NOTVERIFIED"==resp){if(ga("send","event","ContactOwner","ContactOwner-willProcess","Contact owner information will be processed"),ga("send",{hitType:"pageview",page:"/virtual/contactOwnerProcessed"}),"tenantSchedule"!=h){$("#userVerificationModal").modal("hide"),$("#contactDetailsSentModal").modal("show"),$(btnId).prop("disabled",!0),$(btnId).addClass("btn-default"),$(btnId).text("Requested..");var m=location.href;m.search("detail")>-1?($("#onContactDetailPage").show(),$("#onContactListPage").hide(),$("#contactDetailsSentModal").addClass("onDetailPage")):($("#onContactDetailPage").hide(),$("#onContactListPage").show(),$("#contactDetailsSentModal").removeClass("onDetailPage")),$("#scheduleVisitBtn").addClass("disabled"),$("#scheduleVisitBtn").css("background","rgb(253, 55, 83)"),$(".contactDetailsSuccessMsg h3").html("Owner details will be sent shortly to your <b>"+j.userPhone+"</b> and <b>"+j.userEmail+"</b>."),$(".contactDetailsSuccessAppointment button").hide(!0),$(".secondaryTitle p").html("Owner details will be sent shortly to your "+j.userPhone+" and "+j.userEmail+"."),$("#s1").is(":visible")&&$(".contactDetailsLocalities").hide()}else callback&&callback();$("#propId")&&$("#propId").val()&&getAlreadyContacted($("#propId").val())}else if("BROKER_NOTVERIFIED_NEW"==resp){if("tenantSchedule"!=h){$("#userVerificationModal").modal("hide"),ga("send","event","ContactOwner","ContactOwner-willProcess","Contact owner information will be processed"),$("#contactDetailsSentModal").modal("show"),$(btnId).prop("disabled",!0),$(btnId).addClass("btn-default"),$(btnId).text("Requested..");var m=location.href;m.search("detail")>-1?($("#onContactDetailPage").show(),$("#onContactListPage").hide(),$("#contactDetailsSentModal").addClass("onDetailPage")):($("#onContactDetailPage").hide(),$("#onContactListPage").show(),$("#contactDetailsSentModal").removeClass("onDetailPage")),$("#scheduleVisitBtn").addClass("disabled"),$("#scheduleVisitBtn").css("background","rgb(253, 55, 83)"),$(".contactDetailsSuccessMsg h3").html("Owner details will be sent shortly to your <b>"+j.userPhone+"</b> and <b>"+j.userEmail+"</b>."),$(".contactDetailsSuccessAppointment button").hide(!0),$(".secondaryTitle p").html("Owner details will be sent shortly to your "+j.userPhone+" and "+j.userEmail+"."),$("#s1").is(":visible")&&$(".contactDetailsLocalities").hide()}else callback&&callback();$("#propId")&&$("#propId").val()&&getAlreadyContacted($("#propId").val())}else if("SENT_NEW"==resp)ga("send","event","ContactOwner","ContactOwner-sent","Contact owner details sent");else if("SENT"==resp)ga("send","event","ContactOwner","ContactOwner-sent","Contact owner details sent"),ga("send",{hitType:"pageview",page:"/virtual/contactOwnerProcessed"}),$("#propId")&&getAlreadyContacted($("#propId").val());else if("requested"==resp)ga("send","event","ContactOwner","ContactOwner-sent","Contact owner details sent"),ga("send",{hitType:"pageview",page:"/virtual/contactOwnerProcessed"});else if("ACCOUNT_NOT_IDENTIFIED"==resp)ga("send","event","ContactOwner","ContactOwner-account ambiguous","Contact owner details not sent as account cannot be resolved");else if("NO_PLAN_SELECTED"==resp)k=!1,$(".busy-holder").addClass("show"),"BUY"==propertyType?getUserInfo(BuyerPlanModule.getBuyerPlanDetails):"RENT"==propertyType?getUserInfo(getPlanDetails,g):"COMMERCIAL_RENT"==propertyType?(getUserInfo(commercialPlanModule.getCommercialPlanDetails,"tenant"),triggerZopimForPlan("commercial tenant",zopimUrls.tenantCommercialContactExpired)):"COMMERCIAL_BUY"==propertyType&&(getUserInfo(commercialPlanModule.getCommercialPlanDetails,"buyer"),triggerZopimForPlan("commercial buy",zopimUrls.buyerCommercialContactExpired)),window.location.href=window.location.href+"#paymentPlan",ga("send","event","ContactOwner","ContactOwner-noplan","Contact owner No Plan Selected"),ga("send","event","ContactOwner","ContactOwner-willProcess","Contact owner information will be processed");else if("PHONE_NOTVERIFIED"==resp)nbGA.logEvent("ContactOwner","PhoneVerify-Popup",{}),getUserInfo(showPhoneVerificationPopup,i);else{var n='<h4 style="font-weight:bold">Owner Contact Limit Exceeded!</h4> Oops! Cannot sent the contact details of this property owner to you as you have already crossed contact limit of your plan. <br><p> You can now upgrade to new plan to get more contacts by clicking below button<br/> <div id="feedbackClick" align="center"><a class="btn btn-warning btn-sm btn-nbprimary" style="font-size:14px;text-transform:capitalize" href="#" onclick="openTenantPaymentPlans();">Buy/Upgrade plan! </a> </p> </div><br> <div class="seperator"> Or</div> <p> Please reach out to us on one of the below means and we will try and process your request as soon as possible.</p> <img style="height:15px;width:15px" src="/static/img/whatsapp-24.gif"></img> +91-8107-555-666 <br/> <i class="icon icon-phone"></i> +91-92417-00000 <br> <i class="icon icon-envelope"></i> hello@nobroker.in';"true"==$("#isULIN").val()?("RENT"==propertyType?($(".busy-holder").addClass("show"),getUserInfo(getPlanDetails,g),window.location.href=window.location.href+"#paymentPlan"):"COMMERCIAL_RENT"==propertyType?getUserInfo(commercialPlanModule.getCommercialPlanDetails,"tenant"):"COMMERCIAL_BUY"==propertyType?getUserInfo(commercialPlanModule.getCommercialPlanDetails,"buyer"):($(".busy-holder").addClass("show"),getUserInfo(BuyerPlanModule.getBuyerPlanDetails),window.location.href=window.location.href+"#paymentPlan",gaLogging.logEventWithProductType("ContactOwner","OOC-Resale",l),n='<h4 style="font-weight:bold">Owner Contact Limit Exceeded!</h4> Oops! Cannot sent the contact details of this property owner to you as you have already crossed the free contact limit. For your convenience, this property is added into <u>your shortlists</u>. <br><br><br><div class="seperator"></div> <p> Please reach out to us on one of the below means and we will try and process your request as soon as possible.</p> <img style="height:15px;width:15px" src="/static/img/whatsapp-24.gif"></img> +91-8107-555-666 <br/> <i class="icon icon-phone"></i> +91-92417-00000 <br> <i class="icon icon-envelope"></i> hello@nobroker.in'),markShortlistAndIncreaseCount(a,h)):showOwnerDetail(n),k=!1}if(hideLoading(),k)if("chat"==i){var o=j.ownerId;openChat(a,b,c,d,e,f,g,o,h)}else"tenantSchedule"==i&&openTenantScheduleModal()},h)}).fail(function(b){ga("send","event","ContactOwner","UserDetail","Contact owner-asked for user details");var c={};c.propId=a,c.fromPage=h,c.flow="chat",userRegistrationModalHelper.registerFlow("chat",c,null,chatPostHandler),hideLoading()})}function whatsappOtpPost(a,b){if(1==a||0==a){a?nbGA.logEvent("WhatsAppOpt","OptIn",b):"List"==b?nbGA.logEvent("WhatsAppOpt","NeverShow",b):nbGA.logEvent("WhatsAppOpt","OptOut",b);var c={};c.toggle=a,c.source=b,$.ajax({url:"/api/v1/whatsapp/opt",headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST",dataType:"json",data:c,success:function(a){console.log("succes: "+a)}})}}function whatsappOtpPostAdmin(a,b){if(1==a.toggle||0==a.toggle){if(void 0===b&&(b=!0),void 0!==typeof a.toggle)try{$('.requestPhotoBtn[data-userid="'+a.userId+'"]').data("whatsapp-attr",a.toggle),$('.askOwnerButton[data-userid="'+a.userId+'"]').data("whatsapp-attr",a.toggle),$('#WhatsAppOptAdmin[data-userid="'+a.userId+'"]').prop("checked",a.toggle)}catch(a){}var c="/api/v1/admin/whatsapp/opt";!1===b&&(c="/api/v1/whatsapp/opt"),$.ajax({url:c,headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST",dataType:"json",data:a,success:function(a){console.log("succes: "+a)}})}}function getAlreadyContacted(a){"true"==$("#isULIN").val()&&("undefined"!=typeof nbFirebase&&nbFirebase?nbFirebase.registerOnceListenerToRef("/contacts",{userId:loggedinUserId}).then(function(b){if(b){-1!=Object.keys(b).indexOf(a)&&getOwnerDetails(a)}}):getOwnerDetails(a))}function getOwnerDetails(a){var b="/api/v3/user/contacted/"+a;$.ajax({url:b,type:"GET",success:function(a){var b=a.data;"true"==b.contacted&&($("#pickedTimeScheduler").attr("data-alreadycontacted","true"),$("#frmPickedTimeScheduler").attr("data-alreadycontacted","true"),showContactedDetails(b))},error:function(a){}})}function hideNearbyPropertiesFilter(){$("#nearByFilterContainer").addClass("hide")}function showNearbyPropertiesFilter(){$("#nearByFilterContainer").removeClass("hide")}function setTooltip(){$(".tooltips").tooltip()}function showContactedDetails(a){a.contactedOn=dateFormater(parseInt(a.property_last_updated)),a.showSuccessImage=!1,a.showFailureImage=!1,a.showInProgressImage=!1,null==a.tenantVisitState?a.showInProgressImage=!0:"true"==a.tenantVisitState?a.showSuccessImage=!0:"false"==a.tenantVisitState&&(a.showFailureImage=!0),"true"==a.slotBooked?a.slotBooked=!0:a.slotBooked=!1;var b=$("#contact_summary_card").html(),c=Handlebars.compile(b),d=null;d=c(a),$("#contactedBlock").empty(),$("#contactedBlock").append(d),$("#contactedBlock").show(),setTooltip()}function scrollTo(a,b,c){if(!(c<=0)){var d=b-a.scrollTop,e=d/c*10;setTimeout(function(){a.scrollTop=a.scrollTop+e,a.scrollTop!==b&&scrollTo(a,b,c-10)},10)}}function openChat(a,b,c,d,e,f,g,h,i){var j=f;if(j&&(g<10?f+="Only Deposit":f=f+"Rs."+g),"true"!=$("#isULIN").val())showSignIn();else{if(window.nbsocket){nbsocket.emit("messages:fetch:property",a,b),nbsocket.removeAllListeners("messages:property"),nbsocket.on("messages:property",function(a){a.length>0&&($("#sendChatMessage").find(".modal-body").find(".nb-conversations-wrap").empty(),$("#sendChatMessage").find(".modal-body").find(".chat-options").addClass("hide"),$("#sendChatMessage").find("#chatContent").text(""));var b=_.filter(a,function(a){var b;try{b=JSON.parse(a)}catch(c){b=a}var c=!1;return b&&b.messageType&&"NEGOTIATE"===b.messageType.type&&"DISCARDED"!==b.messageType.status&&(c=!0),c});if(b.length>0){var c;try{c=JSON.parse(b[0])}catch(a){c=b[0]}$("#sendChatMessage").find(".chat-negotiation").addClass("show"),$("#sendChatMessage").find(".chat-negstatus").text(c.messageType.status),$("#sendChatMessage").find(".chat-negamount").text("Rs."+c.messageType.proposedValue),$("#sendChatMessage").find(".chat-negotiation").data("negMessage",c),"PENDING"===c.messageType.status?($("#sendChatMessage").find(".discardbtn").removeClass("hideBtn"),$("#sendChatMessage").find(".chat-negotiate").addClass("hide")):($("#sendChatMessage").find(".discardbtn").addClass("hideBtn"),$("#sendChatMessage").find(".chat-negotiate").removeClass("hide"))}else $("#sendChatMessage").find(".chat-negotiation").removeClass("show"),$("#sendChatMessage").find(".chat-negstatus").text(""),$("#sendChatMessage").find(".chat-negamount").text(""),$("#sendChatMessage").find(".chat-negotiate").removeClass("hide");for(var d=[],e=0;e<a.length;e++){var f;try{f=JSON.parse(a[e])}catch(b){f=a[e]}d.push(f)}a=_.sortBy(d,function(a){return-1*a.serverTimeStamp});for(var e=0;e<a.length;e++){var f;try{f=JSON.parse(a[e])}catch(b){f=a[e]}var g="message-theirs",h="";"TENANT"==f.userType&&(g="message-mine",h="");var i=new Date(Number(f.messageId)),j=i.toDateString().split(" ")[0]+", "+i.toDateString().split(" ")[1]+" "+i.toDateString().split(" ")[2],k='<div class="nb-conversation-wrap '+g+'"><div class="nb-user">'+f.userId+'</div><div class="nb-chat-message"><span class="nb-chat-message-content '+h+'">'+f.message+'<div class="nb-chat-timestamp">'+j+"</div></span></div></div>";$("#sendChatMessage").find(".modal-body").find(".nb-conversations-wrap").prepend(k)}$("#sendChatMessage").find(".modal-body").scrollTop($("#sendChatMessage").find(".modal-body").prop("scrollHeight"))});var k=function(a){var b="message-theirs",c="";"TENANT"==a.userType&&(b="message-mine",c="");var d=new Date(Number(a.messageId)),e=d.toDateString().split(" ")[0]+", "+d.toDateString().split(" ")[1]+" "+d.toDateString().split(" ")[2],f='<div class="nb-conversation-wrap '+b+'"><div class="nb-user">'+a.userId+'</div><div class="nb-chat-message"><span class="nb-chat-message-content '+c+'">'+a.message+'<div class="nb-chat-timestamp">'+e+"</div></span></div></div>";$("#sendChatMessage").find(".modal-body").find(".nb-empty-conversations-illus").length>0&&($("#sendChatMessage").find(".modal-body").find(".nb-empty-conversations-illus").remove(),$("#sendChatMessage").find(".modal-body").find(".nb-empty-conversations-text").remove()),$("#sendChatMessage").find(".modal-body").find(".nb-conversations-wrap").append(f);var g=document.getElementsByClassName("nb-conversation-wrap"),h=g[g.length-1].offsetTop;scrollTo(document.getElementById("allConversations"),h,500),$("#sendChatMessage").find(".chat-options").addClass("hide")};nbsocket.removeAllListeners("chat:message"),nbsocket.on("chat:message",k)}$("#showChatWindow").data("propId",a),$("#showChatWindow").data("userId",b),$("#showChatWindow").data("userName",c),$("#showChatWindow").data("userEmail",d),$("#showChatWindow").data("userPhone",e),$("#showChatWindow").data("chatTitle"," "),$("#chatIFrame").attr("src",window.location.origin+"/chats?userId="+h+"&nbfr="+i),j&&$("#showChatWindow").find("#chatTitle").text(" "),$("#showChatWindow").modal("show")}}function sendChatMessage(){if(nbsocket){var a={messageId:(new Date).getTime(),message:$("#chatContent").val(),userId:$("#sendChatMessage").data("userId"),propId:$("#sendChatMessage").data("propId"),userName:$("#sendChatMessage").data("userName"),email:$("#sendChatMessage").data("userEmail"),phone:$("#sendChatMessage").data("userPhone"),userType:"TENANT",chatTitle:$("#sendChatMessage").data("chatTitle"),deviceType:"DESKTOP"};nbsocket.emit("chat:message",a),$("#chatContent").val("")}}function checkPropertyForMessage(a,b){try{localStorage&&(localStorage.contactProperties&&!b||initProperties(!1,void 0,!0))}catch(a){}}function initProperties(a,b,c){if("false"!=$("#isULINPing").val())try{if(localStorage){var d="/api/v2/user/profile/contacts";a&&(d=a),localStorage.contactProperties&&!c||$.get(d,function(a){window.propertyContacts||(window.propertyContacts=[]),_.each(a.data,function(a){if(localStorage){var b=JSON.stringify(a),c=b+":|:";localStorage.contactProperties?localStorage.contactProperties.indexOf(c)<0&&(localStorage.contactProperties+=c):localStorage.contactProperties=c}window.propertyContacts.push(a)}),a.metadata.hasNext?initProperties(a.metadata.nextPage,b,!0):b&&b()})}}catch(a){}}function initInbox(a){var b=setInterval(function(){window.nbsocket.connected&&(inboxInitialize(a),clearInterval(b))},1e3)}function inboxInitialize(a){!function(){$("#messagesInbox").off("change",".chat-dropdown-header"),$("#messagesInbox").on("change",".chat-dropdown-header",function(){var a=$(this).val();"tenantMessages"===a?($("#messagesInbox").find(".users-list").removeClass("hide"),$("#messagesInbox").find(".users-list-tenant").removeClass("show")):"ownerMessages"===a&&($("#messagesInbox").find(".users-list").addClass("hide"),$("#messagesInbox").find(".users-list-tenant").addClass("show")),$("#messagesInbox").find(".messages-holder").find(".conversations-wrap").empty(),$("#messagesInbox").find(".conversations-header").removeClass("show")})}();var b=function(a,b,c){var d,e="message-theirs",f="";c?"TENANT"==a.userType&&(e="message-mine",a.sent&&(d="delivered"),a.readMsg&&(d="readMsg")):"OWNER"==a.userType&&(e="message-mine",a.sent&&(d="delivered"),a.readMsg&&(d="readMsg"));var g=new Date(Number(a.messageId)),h=$.timeago(Number(g)),i='<div class="nb-conversation-wrap '+e+'"><div class="nb-user">'+a.userId+'</div><div class="nb-chat-message"><span class="nb-chat-message-content '+f+'">'+a.message;d&&(i+='<div class="msgBgIcon '+d+'"></div>'),i+='<div class="nb-chat-timestamp">'+h+"</div></span></div></div>",$("#messagesInbox").find(".messages-holder").find(".conversations-wrap").append(i),b||$("#messagesInbox").find(".messages-holder").find(".conversations-wrap").animate({scrollTop:$("#messagesInbox").find(".messages-holder").find(".conversations-wrap").prop("scrollHeight")},300)};nbsocket.on("messages:user",function(a){var b,c=window.location.href.substring(window.location.href.lastIndexOf("/"));"/messages"!=c&&(b=c.slice(1)),a=_.sortBy(a,"serverTimeStamp"),a.reverse();var d,e=_.groupBy(a,"userId"),f=!1;$("#messagesInbox").find(".selectedUser").length>0&&(d=$("#messagesInbox").find(".selectedUser").data("userid"),f=!0),a.length>0&&$("#messagesInbox").find(".users-list").empty(),_.each(e,function(a,c){if(a=_.sortBy(a,"serverTimeStamp"),b){var e=_.pluck(a,"messageId");_.find(e,function(a){a==b&&(f=!0,d=c)})}var g=_.findWhere(a,{userType:"TENANT"});if(g){var h='<div class="chat-messageobj" data-action="onChatMsgClick" data-userid="'+g.userId+'" data-propid="'+g.propId+'"><div class="nb-inbox-chat-timestamp">'+$.timeago(new Date(Number(a[a.length-1].messageId)))+'</div><div class="chat-user" data-userid="'+g.userId+'">'+g.userName+'</div><div class="chat-message">'+a[a.length-1].message+"</div></div>";$("#messagesInbox").find(".users-list").append(h)}}),_.each(_.keys(e),function(a){$("#messagesInbox").find(".users-list").find('.chat-messageobj[data-userid="'+a+'"]').data("chats",e[a])}),!f&&$("#messagesInbox").find(".users-list").is(":visible")?$($("#messagesInbox").find(".users-list").find('[data-action="onChatMsgClick"]')[0]).trigger("click"):$("#messagesInbox").find(".users-list").is(":visible")&&($("#messagesInbox").find(".users-list").find('[data-userid="'+d+'"]').addClass("selectedUser"),b?$("#messagesInbox").find(".users-list").find('[data-userid="'+d+'"]').trigger("click"):$($("#messagesInbox").find(".users-list").find('[data-action="onChatMsgClick"]')[0]).trigger("click")),0==a.length&&$("#messagesInbox").find(".chat-dropdown-header").val("ownerMessages").trigger("change")}),nbsocket.on("messages:user:tenant",function(a){var b,c=window.location.href.substring(window.location.href.lastIndexOf("/"));"/messages"!=c&&(b=c.slice(1)),a=_.sortBy(a,"serverTimeStamp"),a.reverse();var d,e=_.groupBy(a,"propId"),f=!1;$("#messagesInbox").find(".selectedUser").length>0&&(d=$("#messagesInbox").find(".selectedUser").data("propid"),f=!0),a.length>0&&$("#messagesInbox").find(".users-list-tenant").empty(),_.each(e,function(a,c){if(a=_.sortBy(a,"serverTimeStamp"),b){var e=_.pluck(a,"messageId");_.find(e,function(a){a==b&&(f=!0,d=c)})}var g=_.findWhere(a,{userType:"TENANT"});if(g){var h='<div class="chat-messageobj" data-tenantmsg="true" data-action="onChatMsgClick" data-userid="'+g.userId+'" data-propid="'+g.propId+'"><div class="nb-inbox-chat-timestamp">'+$.timeago(new Date(Number(a[a.length-1].messageId)))+'</div><div class="chat-user" data-userid="'+g.userId+'">'+g.chatTitle+'</div><div class="chat-message">'+a[a.length-1].message+"</div></div>";$("#messagesInbox").find(".users-list-tenant").append(h)}}),_.each(_.keys(e),function(a){$("#messagesInbox").find(".users-list-tenant").find('.chat-messageobj[data-propid="'+a+'"]').data("chats",e[a])}),!f&&$("#messagesInbox").find(".users-list-tenant").is(":visible")?$($("#messagesInbox").find(".users-list-tenant").find('[data-action="onChatMsgClick"]')[0]).trigger("click"):$("#messagesInbox").find(".users-list-tenant").is(":visible")&&($("#messagesInbox").find(".users-list").find('[data-propid="'+d+'"]').addClass("selectedUser"),b?$("#messagesInbox").find(".users-list").find('[data-propid="'+d+'"]').trigger("click"):$($("#messagesInbox").find(".users-list-tenant").find('[data-action="onChatMsgClick"]')[0]).trigger("click"))}),nbsocket.emit("messages:fetch:user",a);var c;$("#messagesInbox").off("click",'[data-action="onChatMsgClick"]'),$("#messagesInbox").on("click",'[data-action="onChatMsgClick"]',function(){var d=$(this).data("chats"),e=$(this).data("tenantchat"),f=($(this).data("userid"),$(this).data("tenantmsg"));$("#messagesInbox").find(".chat-messageobj").removeClass("selectedUser"),$(this).addClass("selectedUser"),$("#messagesInbox").find(".messages-holder").find(".conversations-wrap").empty(),$("#messagesInbox").find(".messages-holder").find(".reply-holder").addClass("show"),$("#messagesInbox").find(".messages-holder").find(".replyBtn").addClass("show");for(var g=[],e=_.findWhere(d,{userType:"TENANT"}),h=d.length-1;h>=0;h--)if("TENANT"==d[h].userType&&""!=d[h].chatTitle){e=d[h];break}var i=_.filter(d,function(a){var b=!1;return a&&a.messageType&&"NEGOTIATE"===a.messageType.type&&(b=!0),b});if(d=_.sortBy(d,"serverTimeStamp"),_.each(d,function(a){b(a,!0,f),f?"OWNER"==a.userType&&g.push(a.messageId):"TENANT"==a.userType&&g.push(a.messageId)}),i.length>0&&($("#messagesInbox").find(".chat-negotiation").addClass("show"),$("#messagesInbox").find(".chat-negamount").text("Rs."+i[0].messageType.proposedValue),$("#messagesInbox").find(".chat-negotiation").data("negMessage",i[0])),$("#messagesInbox").find(".conversations-header").addClass("show"),$("#messagesInbox").find(".conversations-header .chat-propheader").text(e.chatTitle),f){var j,k=d[0].propId;if(window.propertyContacts){j=_.findWhere(window.propertyContacts,{propertyId:k}),j||(j={name:"",email:"",phone:"",propertyTitle:e.chatTitle,propertyLink:"#"}),$("#messagesInbox").find(".conversations-header .chat-usertype").text("Owner:"),$("#messagesInbox").find(".conversations-header .nb-chat-username").text(j.name),$("#messagesInbox").find(".conversations-header .nb-chat-useremail").text(j.email),$("#messagesInbox").find(".conversations-header .nb-chat-userphone").text(j.phone);var l=" href="+j.propertyLink+" target='_blank' style='text-transform: capitalize;margin: 0;' title='"+j.propertyTitle+"'>",m="<i style='margin: 0 10px 0 5px; font-size:0.8em' class='icon icon-external-link'></i>",n="<a "+l+j.propertyTitle+m+"</a>";$("#messagesInbox").find(".conversations-header .chat-propheader").html(n)}else initProperties(!1,function(){j=_.findWhere(window.propertyContacts,{propertyId:k}),j||(j={name:"",email:"",phone:"",propertyTitle:e.chatTitle,propertyLink:"#"}),$("#messagesInbox").find(".conversations-header .chat-usertype").text("Owner:"),$("#messagesInbox").find(".conversations-header .nb-chat-username").text(j.name),$("#messagesInbox").find(".conversations-header .nb-chat-useremail").text(j.email),$("#messagesInbox").find(".conversations-header .nb-chat-userphone").text(j.phone);var a=" href="+j.propertyLink+" target='_blank' style='text-transform: capitalize;margin: 0;' title='"+j.propertyTitle+"'>",b="<i style='margin: 0 10px 0 5px; font-size:0.8em' class='icon icon-external-link'></i>",c="<a "+a+j.propertyTitle+b+"</a>";$("#messagesInbox").find(".conversations-header .chat-propheader").html(c)},!0)}else $("#messagesInbox").find(".conversations-header .chat-usertype").text("Tenant:"),$("#messagesInbox").find(".conversations-header .nb-chat-username").text(e.userName),$("#messagesInbox").find(".conversations-header .nb-chat-useremail").text(e.email),$("#messagesInbox").find(".conversations-header .nb-chat-userphone").text(e.phone);$("#messagesInbox").find(".conversations-wrap").scrollTop($("#messagesInbox").find(".conversations-wrap").prop("scrollHeight")),c={userId:$(this).data("userid"),propId:$(this).data("propid"),chatTitle:d[0].chatTitle};var o=function(a){a.propId==c.propId&&a.userId==c.userId&&b(a)};nbsocket.removeAllListeners("chat:message"),nbsocket.on("chat:message",function(b){nbsocket.emit("messages:fetch:user",a),o(b)}),nbsocket.emit("user:markRead",g,e.propId,e.userId)}),nbsocket.removeAllListeners("chat:message"),nbsocket.on("chat:message",function(b){nbsocket.emit("messages:fetch:user",a)}),$("#messagesInbox").off("click",'[data-action="replyChatMsg"]'),$("#messagesInbox").on("click",'[data-action="replyChatMsg"]',function(){if(c&&nbsocket){var b={messageId:(new Date).getTime(),message:$(this).siblings(".reply-holder").val(),userId:c.userId,propId:c.propId,userName:c.userId==a?c.userName:"Owner",userType:c.userId==a?"TENANT":"OWNER",deviceType:"DESKTOP",chatTitle:c.chatTitle};nbsocket.emit("chat:message",b),$(this).siblings(".reply-holder").val("")}}),$("#messagesInbox").on("click",'[data-action="acceptNeg"]',function(){var a=$("#messagesInbox").find(".chat-negotiation").data("negMessage");nbsocket.emit("actionItem:response",a.propId,a.userId,a.messageId,"ACCEPTED")}),$("#messagesInbox").on("click",'[data-action="declineNeg"]',function(){var a=$("#messagesInbox").find(".chat-negotiation").data("negMessage");nbsocket.emit("actionItem:response",a.propId,a.userId,a.messageId,"REJECTED")})}function onInboxClick(a){var b;$("#messageInboxModal").data("propId","s123"),$("#messageInboxModal").modal("show"),$("#notification_count").text("0"),$("#notification_count").removeClass("show"),$("#messageInboxModal").on("click",'[data-action="onChatMsgClick"]',function(){var a=$(this).data("chats"),c=$(this).data("tenantchat"),d=c?"tenants":"owners";$("#messageInboxModal").find(".conversation-holder."+d).empty(),$("#messageInboxModal").find(".reply-holder").addClass("show"),$("#messageInboxModal").find(".replyBtn").addClass("show");var e=[];_.each(a,function(a){var b='<div class="nb-conversation-wrap"><div class="nb-user">'+a.userId+'</div><div class="nb-chat-message">'+a.message+'</div><div class="nb-chat-timestamp">'+new Date(Number(a.messageId))+"</div></div>";$("#messageInboxModal").find(".conversation-holder."+d).prepend(b),"owners"==d&&"TENANT"==a.userType&&e.push(a.messageId),"tenants"==d&&"OWNER"==a.userType&&e.push(a.messageId)}),b={userId:$(this).data("userid"),propId:$(this).data("propid"),chatTitle:a[0].chatTitle},nbsocket.emit("user:markRead",e,$(this).data("propid"),$(this).data("userid"))}),$("#messageInboxModal").on("click",'[data-action="replyChatMsg"]',function(){if(b&&nbsocket){var c={messageId:(new Date).getTime(),message:$(this).siblings(".reply-holder").val(),userId:b.userId,propId:b.propId,userName:b.userId==a?b.userName:"Owner",userType:b.userId==a?"TENANT":"OWNER",deviceType:"DESKTOP",chatTitle:b.chatTitle};nbsocket.emit("chat:message",c),$(this).siblings(".reply-holder").val("")}}),nbsocket&&(nbsocket.emit("messages:fetch:user",a),nbsocket.on("messages:user",function(a){var b=_.groupBy(a,"userId");$("#messageInboxModal").find(".users-list.owners").empty(),_.each(b,function(a){var b=_.findWhere(a,{userType:"TENANT"});if(void 0!=b){var c='<div class="chat-messageobj" data-action="onChatMsgClick" data-userid="'+b.userId+'" data-propid="'+b.propId+'"><div class="chat-user" data-userid="'+b.userId+'">'+b.userName+'</div><div class="chat-message">'+a[0].message+"</div></div>";$("#messageInboxModal").find(".users-list.owners").append(c)}}),_.each(_.keys(b),function(a){$("#messageInboxModal").find('.chat-messageobj[data-userid="'+a+'"]').data("chats",b[a])})}),nbsocket.on("messages:user:tenant",function(a){var b=_.groupBy(a,"propId");$("#messageInboxModal").find(".users-list.tenants").empty(),_.each(b,function(a){var b='<div class="chat-messageobj-tenants" data-action="onChatMsgClick" data-tenantchat="true" data-userid="'+a[0].userId+'" data-propid="'+a[0].propId+'"><div class="chat-user" data-userid="'+a[0].userId+'">'+a[0].propId+'</div><div class="chat-message">'+a[0].message+"</div></div>";$("#messageInboxModal").find(".users-list.tenants").append(b)}),_.each(_.keys(b),function(a){$("#messageInboxModal").find('.chat-messageobj-tenants[data-propid="'+a+'"]').data("chats",b[a])})}))}function storeContactForm(){var a=$("[name=userName]").val(),b=$("[name=userEmail]").val(),c=$("[name=userPhone]").val();try{localStorage&&(localStorage.userName=a,localStorage.userEmail=b,localStorage.userPhone=c)}catch(a){}}function sendTenantLead(a,b,c,d){var e="";a&&(e=" by "+a);var f={};f.fromPage="shareAndEarnPrompt",f.phone=e,gaLogging.logEventWithProductType("CrowdSourceLead","tenant-lead-click",f),$("#tenantLeadInput").modal("show");var g="LIST-SIDECARD-"+$("#nbpt").val();$.ajax({url:"/createEvent",method:"POST",data:{nbFr:g,type:"ReferNEarn"}}),nbUtils.bannerClickAdobeEvent({ctaName:d,ctaURL:"",bannerType:b,position:c})}function processTenantLead(){$("#tenantLeadError").hide(),$("#tenantLeadForm")[0].checkValidity()?invokeTenantLead():$("#hiddenTenantLeadContact").click()}function closeTenantLeadModal(){nbGA&&nbGA.logEvent("CrowdSourceLead","tenant-lead-close",{})}function processRentReceipt(a){$("#rentReceiptForm")[0].checkValidity()&&validateRentReceiptForm("#rentReceiptForm")&&invokeRentReceipt()}function validateRentReceiptForm(a){var b=$(a),c=!0;return $.each(b.find("input.validate"),function(a,b){var d=$(b),e=d.attr("type"),f=/^\d+$/;if(d.siblings("#invalidInfo").remove(),d.is(":visible")){var g=d.val();"number"!=e&&"tel"!=e||g&&!f.test(g)&&(d.addClass("invalid"),d.after('<div id="invalidInfo" style="color:red"> <div class="intValue">Invalid value</div> </div>'),c=!1)}}),$("input.invalid").focus(function(a){$(a.target).removeClass("invalid"),$("#invalidInfo").remove()}),c}function invokeRentReceipt(a){var b=$("#rentReceiptForm").serialize();url="/api/v1/rent_receipt/new",showLoading(),$.ajax({url:url,type:"POST",data:b,dataType:"json",contentType:"application/x-www-form-urlencoded",success:function(a){var b={};gaLogging.logEventWithProductType("rentReceipt","generate-success",b),hideLoading(),window.location="/rent-receipt/confirmation/"+a.data.receiptId},error:function(a){hideLoading();var b={};gaLogging.logEventWithProductType("rentReceipt","generate-failed",b),"400"==a.status&&a.responseText?displayAlerts(a.responseText,"danger",3e3):displayGenericError()}})}function downloadRentReceipt(){var a={};return gaLogging.logEventWithProductType("rentReceipt","download-rentReceipt",a),!0}function invokeTenantLead(){var a=$("#tenantLeadForm").serialize()+"&type=TENANT";showLoading(),$.ajax({url:"/api/v1/public/crowd/lead/create",type:"POST",data:a,contentType:"application/x-www-form-urlencoded",success:function(a){if(hideLoading(),a.data.currentState){var b={};b.fromPage="tenantLeadInput",b.phone=$("#tenantLeadInput #phone").val(),b.ownerPhone=$("#ownerPhone").val(),gaLogging.logEventWithProductType("CrowdSourceLead","tenant-lead-sent",b),$("#tenantLeadInput").modal("hide"),displayAlerts("Owner Contact Received. Once verified & listed, you will receive an SMS to redeem your Paytm money","success",6e3)}},error:function(a){hideLoading(),displayGenericError()}})}function invokeContactOwnerCall(a,b,c,d,e){event&&(event.target.disabled=!0);var f="",g="",h={};h.fromPage=d,h.propId=a,f="userId="+loggedinUserId,a?(f+="&propertyId="+a,g="#contactOwnerBtn"+a):(h.fromPage="DetailPopup",h.propId=$("#userVerificationModal").data("propId"),f=$("#ownerContactForm").serialize()+"&propertyId="+$("#userVerificationModal").data("propId"),g="#contactOwnerBtn"+$("#userVerificationModal").data("propId"));var i=$("#mapDOwner").attr("data-_nbfr");void 0===d&&(d="map-card3"),i=void 0!==i?"&_nbfr="+i:"sponsoredPropertyDetail"===d?"&_nbfr=INSTANTBOOK":"&_nbfr="+d;var j,k=location.href,l=$("#productType").val();"RENT"==l?j="0":"PG"==l&&(j="1"),"COMMERCIAL_RENT"==l||"COMMERCIAL_BUY"==l?showSimilarPropertiesCommercial(a,d,l):showSimilarProperties(a,j,d,l);var m="/property/email/contact?"+f+i;$.ajax({url:m,type:"POST",success:function(f){event&&(event.target.disabled=!1),hideLoading(),resp=f.message,propertyDataForAdobe&&getOwnerDetailAdobeEvent(propertyDataForAdobe,d.includes("detail")?"detailPage":"listpage",resp),l=f.propertyType,h.propertyType=f.propertyType,isNewUser=f.new_user;if(c&&"sponsoredPropertyDetail"==d){var i={};i.fromPage=d,i.dataField=f,i.eventParam=h,i.zopimTrigger=e,c(i)}else if(c&&"tenantSchedule"!=d)c(f);else{"true"==isNewUser&&gaLogging.logPageViewAndEventWithProductType("/virtual/signUpOnSchedulerBook","NewUser","ContactOwner",h);if(("BROKER_NOTVERIFIED"==resp&&"tenantSchedule"!=d||"BROKER_NOTVERIFIED_NEW"==resp||"SENT_NEW"==resp||"SENT"==resp&&"tenantSchedule"!=d)&&nbEvents.logContactOwner({propId:$("#propId").val(),propType:f.propertyType,fromPage:d,actionType:"fbAddToCart",resp:resp}),"NOT_AUTHORIZED"==resp){"tenantSchedule"==d&&closeTenantScheduleModal();var f={};f.propId=a,f.fromPage=d,f.flow="contactOwner",userRegistrationModalHelper.registerFlow("contactOwner",f,null,contactOwnerPostHandler),hideLoading()}else if("BROKER_NOTVERIFIED"==resp)$("#contact-customer").remove(),$("#contact-customer-btn").remove(),gaLogging.logPageViewAndEventWithProductType("/virtual/contactOwnerProcessed","ContactOwner","UnderProcess",h),"tenantSchedule"!=d?($("#userVerificationModal").modal("hide"),$("#contactDetailsSentModal").modal("show"),$(g).prop("disabled",!0),$(g).addClass("btn-default"),$(g).text("Requested.."),k.search("detail")>-1?($("#onContactDetailPage").show(),$("#onContactListPage").hide(),$("#contactDetailsSentModal").addClass("onDetailPage")):($("#onContactDetailPage").hide(),$("#onContactListPage").show(),$("#contactDetailsSentModal").removeClass("onDetailPage")),$(".contactDetailsSuccessMsg h3").html("Owner details will be sent shortly to your <b>"+f.userPhone+"</b> and <b>"+f.userEmail+"</b>."),$(".contactDetailsSuccessAppointment button").hide(!0),$("#scheduleVisitBtn").addClass("disabled"),$("#scheduleVisitBtn").css("background","rgb(253, 55, 83)"),$(".secondaryTitle p").html("Owner details will be sent shortly to your "+f.userPhone+" and "+f.userEmail+"."),$("#s1").is(":visible")&&$(".contactDetailsLocalities").hide()):c&&c(),$("#propId")&&$("#propId").val()&&getAlreadyContacted($("#propId").val());else if("BROKER_NOTVERIFIED_NEW"==resp)gaLogging.logPageViewAndEventWithProductType("/virtual/contactOwnerProcessed","ContactOwner","NewUser",h),$("#contactDetailsSentModal").modal("show"),$(g).prop("disabled",!0),$(g).addClass("btn-default"),$(g).text("Requested.."),k.search("detail")>-1?($("#onContactDetailPage").show(),$("#onContactListPage").hide()):($("#onContactDetailPage").hide(),$("#onContactListPage").show()),"true"==f.slotAvailable?$(".contactDetailsSuccessAppointment").addClass("contactDetailsPreferredTime"):$(".contactDetailsSuccessAppointment").removeClass("contactDetailsPreferredTime"),$(".contactDetailsSuccessMsg h3").html("Owner details will be sent shortly to your <b>"+f.userPhone+"</b> and <b>"+f.userEmail+"</b>."),$("#scheduleVisitBtn").addClass("disabled"),$("#scheduleVisitBtn").css("background","rgb(253, 55, 83)"),$(".secondaryTitle h4").html("Owner details will be sent shortly to your "+f.userPhone+" and "+f.userEmail+"."),$("#s1").is(":visible")&&$(".contactDetailsLocalities").hide();else if("SENT_NEW"==resp)e&&triggerZopimForGetOwnerDetails(d),gaLogging.logPageViewAndEventWithProductType("/virtual/contactOwnerProcessed","ContactOwner","Sent",h),$("#contactDetailsSentModal").modal("show"),$(g).prop("disabled",!0),$(g).addClass("btn-default"),$(g).text("Requested.."),k.search("detail")>-1?($("#onContactDetailPage").show(),$("#onContactListPage").hide()):($("#onContactDetailPage").hide(),$("#onContactListPage").show()),"true"==f.slotAvailable?$(".contactDetailsSuccessAppointment").addClass("contactDetailsPreferredTime"):$(".contactDetailsSuccessAppointment").removeClass("contactDetailsPreferredTime"),$(".contactDetailsSuccessMsg h3").html("Owner details have been sent to your <b>"+f.userPhone+"</b> and <b>"+f.userEmail+"</b>."),$("#s1").is(":visible")&&$(".contactDetailsLocalities").hide();else if("SENT"==resp){if(e&&triggerZopimForGetOwnerDetails(d),"tenantSchedule"!=d){if($("#userVerificationModal").modal("hide"),$("#contactDetailsSentModal").modal("show"),$(g).prop("disabled",!0),$(g).addClass("btn-default"),$(g).text("Requested.."),$("#onContactDetailPage").show(),$("#onContactListPage").hide(),$("#contactDetailsSentModal").addClass("onDetailPage"),!(k.search("detail")>-1)){var j;"RENT"==l?j="0":"PG"==l&&(j="1"),"COMMERCIAL_RENT"==l||"COMMERCIAL_BUY"==l?showSimilarPropertiesFromLocalStorageCommercial(a):parseInt(j)&&showSimilarPropertiesFromLocalStorage(a)}$("<input />",{type:"hidden",id:"chatOwnerId",value:f.ownerId}).appendTo("body"),$("<input />",{type:"hidden",id:"chatPropertyType",value:f.propertyType}).appendTo("body"),$(".contactDetailsSuccessMsg h3").html("Owner details have been sent to your <b>"+f.userPhone+"</b> and <b>"+f.userEmail+"</b>."),$("#s1").is(":visible")&&$(".contactDetailsLocalities").hide()}else c&&c();gaLogging.logPageViewAndEventWithProductType("/virtual/contactOwnerProcessed","ContactOwner","Sent",h),$("#propId")&&$("#propId").val()&&getAlreadyContacted($("#propId").val())}else"requested"==resp?("tenantSchedule"==d&&closeTenantScheduleModal(),showOwnerDetail('<h4 style="font-weight:bold">Owner Details already sent.</h4> Contact detail of owner of this property owner has already been sent to you via email & SMS.<br><br><strong>When you contact, Don&#39;t forget to quote that you find it on www.nobroker.in</strong>.<br> <br> <strong>Happy Broker Free Hunting, <br>The NoBroker Team<strong>'),gaLogging.logPageViewAndEventWithProductType("/virtual/contactOwnerProcessed","ContactOwner","Sent",h),$(g).prop("disabled",!0),$(g).addClass("btn-default"),$(g).text("Requested..")):"ACCOUNT_NOT_IDENTIFIED"==resp?("tenantSchedule"==d&&closeTenantScheduleModal(),ga("send","event","ContactOwner","ContactOwner-account ambiguous","Contact owner details not sent as account cannot be resolved"),$("#contactOwnerError").html('We could not find an account with below phone & email combination. If you have used nobroker.in in past, please enter the same email & phone combination or <a href="#" class="modal-link"  onclick="closeContactOwner();showSignIn()">login</a> and try again').show(),gaLogging.logEventWithProductType("ContactOwner","AmbiquiousAccount",h)):"NO_PLAN_SELECTED"==resp?("tenantSchedule"==d?closeTenantScheduleModal():closeContactOwner(),"BUY"==l?getUserInfo(BuyerPlanModule.getBuyerPlanDetails):"COMMERCIAL_RENT"==l?($("#userVerificationModal").modal("hide"),getUserInfo(commercialPlanModule.getCommercialPlanDetails,"tenant"),triggerZopimForPlan("commercial tenant",zopimUrls.tenantCommercialContactExpired)):"COMMERCIAL_BUY"==l?($("#userVerificationModal").modal("hide"),getUserInfo(commercialPlanModule.getCommercialPlanDetails,"buyer"),triggerZopimForPlan("commercial buy",zopimUrls.buyerCommercialContactExpired)):getUserInfo(getPlanDetails,b),window.location.href=window.location.href+"#paymentPlan"):"PHONE_NOTVERIFIED"==resp?(nbGA.logEvent("ContactOwner","PhoneVerify-Popup",{}),getUserInfo(showPhoneVerificationPopup,d),e&&triggerZopimForGetOwnerDetails(d)):("tenantSchedule"==d&&closeTenantScheduleModal(),"true"==$("#isULIN").val()?"BUY"==l||"RENT"!=l&&"PG"!=l?"COMMERCIAL_RENT"==l?($("#userVerificationModal").modal("hide"),getUserInfo(commercialPlanModule.getCommercialPlanDetails,"tenant")):"COMMERCIAL_BUY"==l?($("#userVerificationModal").modal("hide"),getUserInfo(commercialPlanModule.getCommercialPlanDetails,"buyer")):(gaLogging.logPageViewAndEventWithProductType("/virtual/contactOwnerProcessed","ContactOwner","OOC-Resale",h),getUserInfo(BuyerPlanModule.getBuyerPlanDetails),window.location.href=window.location.href+"#paymentPlan"):(getUserInfo(getPlanDetails,b),window.location.href=window.location.href+"#paymentPlan"):"BUY"==l||"RENT"!=l&&"PG"!=l?"COMMERCIAL_RENT"==l?($("#userVerificationModal").modal("hide"),$("#contactOwnerLimitExceedModal").modal("show"),$("#buyerPaymentModal").modal("hide"),getUserInfo(commercialPlanModule.getCommercialPlanDetails,"tenant")):"COMMERCIAL_BUY"==l?($("#userVerificationModal").modal("hide"),$("#contactOwnerLimitExceedModal").modal("show"),$("#buyerPaymentModal").modal("hide"),getUserInfo(commercialPlanModule.getCommercialPlanDetails,"buyer")):("COMMERCIAL_BUY"!=l&&"COMMERCIAL_RENT"!=l||($("#userVerificationModal").modal("hide"),$("#contactOwnerLimitExceedModal").modal("show"),$("#buyerPaymentModal").modal("hide")),getUserInfo(BuyerPlanModule.getBuyerPlanDetails),window.location.href=window.location.href+"#paymentPlan",gaLogging.logPageViewAndEventWithProductType("/virtual/contactOwnerProcessed","ContactOwner","OOC-Resale",h)):(getUserInfo(getPlanDetails,b),window.location.href=window.location.href+"#paymentPlan"))}pingLogin(),hideLoading(),"COMMERCIAL_BUY"==l||"COMMERCIAL_RENT"==l?removeSimilarPropertiesFromLocalStorageCommercial(a):removeSimilarPropertiesFromLocalStorage(a)},error:function(b){event&&(event.target.disabled=!1),gaLogging.logEventWithProductType("ContactOwner","Error",h),hideLoading(),displayGenericError(),"COMMERCIAL_BUY"==l||"COMMERCIAL_RENT"==l?removeSimilarPropertiesFromLocalStorageCommercial(a):removeSimilarPropertiesFromLocalStorage(a)}}),$("#propId").val()&&k.search("detail")>-1&&$.ajax({url:"/property/getPrioritisedSlots?propID="+$("#propId").val(),method:"POST",success:function(a){if("true"==a.slotAvailable){var b=JSON.parse(a.slots);$(".contactDetailsSuccessAppointment").addClass("contactDetailsPreferredTime");var c=convertTimeFormat(b[0].start_time)+" - "+convertTimeFormat(b[0].end_time);$(".contactDetailsSuccessTime h3").html(c)}else $(".contactDetailsSuccessAppointment").removeClass("contactDetailsPreferredTime")}})}function convertTimeFormat(a){console.log(a);var b=parseInt(a.substring(0,2)),c="";if(b<12)c=a+" AM";else if(12==b){var d=parseInt(a.substring(3,5));c=d>0?a+"PM":a+" AM"}else c=parseInt(a.substring(0,2))-12<10?"0"+(parseInt(a.substring(0,2))-12)+":"+a.substring(3,5)+" PM":parseInt(a.substring(0,2))-12+":"+a.substring(3,5)+" PM";return c}function reportContactFeedbacks(){feedbacks={},url="/api/v1/feedback/contacts",showLoading(),$.ajax({url:url,type:"GET",success:function(a){if(hideLoading(),$("#contactsFeedback").hide(),0!=a.data.length){var b='<div class="table-responsive"><h4>You can earn free owner contacts by providing feedback on your previous interactions with Owner. Thanks in advance for your help :-).</h4>Feedbacks Reported : <b><span id=\'reportedCount\'>0</b></span> <br><span> Free Contacts Available :<b><span id=\'earnedCount\'>0</b></span><table id="feedbackTable" class="table table-striped table-bordered table-condensed"><thead><tr style="background-color:#009587;color:white"><th></th><th>Owners you contacted</th><th style=\'width:120px\'>Feedback</th></tr></thead>';for(b+="</table></div>",$("#contactsFeedback").html(b),$("#contactsFeedback").show(),i=1;i<=a.data.length;i++){contact=a.data[i-1];var c="contact_"+contact.contactId;$("#feedbackTable tr:last").after(getOneFeedbackRow(contact)),i<=3?$("#feedbackTable tr#"+c).show():($("#feedbackTable tr#"+c).hide(),hiddenRows.push(c))}$("#ownerDetailPopup").modal("hide"),$("#reportfeedback").modal("show")}else{var b='<span style="font-style:italic;font-size:medium;color:#009587">"Hurray!! No feedbacks are pending on your end."</span>';$("#feedbackClick").html(b)}}})}function openFeedbackPopup(){ga("send","event","ContactOwnerFeedback","FeedbackPopupOpened","User opened the popup"),reportContactFeedbacks()}function updatePremiumFilterCount(){var a=$("#premiumFilterArea input[type=checkbox]:checked").length,b=$("#premiumFilterArea input[type=radio]:checked").length,c=a+b;c>0?$("#premiumFilterCount").text(c):$("#premiumFilterCount").text("NEW")}function updateDefaultFilterCount(a){var b=$("#filterPanelForm input[type=checkbox]:checked").length,c=$("#filterPanelForm input[type=radio]:checked").length,d=b+c;a?d--:d-=2,d>0?($("#defaultFilterCount").removeClass("hide"),$("#defaultFilterCount").text(d)):$("#defaultFilterCount").addClass("hide")}function getOneFeedbackRow(a){var b=$.timeago(a.sentTime),c="contact_"+a.contactId;return html="<tr id='"+c+"'>",html=html+"<td style='text-align:center'><img class='img-thumbnail' style='width:120px;height:100px' src='"+a.propertyImage+"'></img></td>",html=html+"<td><a href='"+a.propertyLink+"' target='_blank'><span><i class='fa icon-inr'></i> "+a.propertyRent+", "+a.propertyTitle+"</span></a><span style='font-size:smaller;font-style:italic;float:right' class='timeago'>"+b+"</span><br><span style='font-size:small'><i class='fa icon-user'></i> &nbsp;"+a.name+"</span><br><span style='font-size:smaller'><i class='fa icon-phone'>&nbsp;"+a.phone+"&nbsp;<i class='fa icon-envelope-alt'>&nbsp;"+a.email+"</span></td>",html=html+"<td><select onChange='changeFeedback(this)' style='width:100%' class='dropdown-menu-general form-control input-lg' data-row='"+c+"'><option value='NONE'>None</option><option value='NOT_INTERESTED'>Didn't like</option><option value='RENTED_OUT'>Rented Out</option><option value='NOT_REACHABLE'>Not Reachable</option><option value='IN_PROGRESS'>In Progress</option></select></td>",html+="</tr>",html}function changeFeedback(a){var b=$(a).data("row"),c=b.split("contact_")[1];if("NONE"!=a.value){if($("#feedbackTable tr#"+b).after("<tr id='undo_"+b+"'><td colspan='3'><i style='color:#009587' class='icon icon-ok'></i>&nbsp;&nbsp;Thanks for your feedback <a data-contact='"+b+"' href='#' onclick='editFeedback(this)'><u>Change Feedback</u></a></td></tr>"),$("#feedbackTable tr#"+b).hide(),null==feedbacks[c]){feedbacks[c]=a.value;var d=hiddenRows.shift();$("#feedbackTable tr#"+d).show()}}else delete feedbacks[c];$("#reportedCount").html(Object.keys(feedbacks).length),$("#earnedCount").html(Object.keys(feedbacks).length)}function submitFeedbacks(){if(showLoading(),url="/api/v1/feedback/contacts/submit",Object.keys(feedbacks).length<1)return hideLoading(),void $("#cancelFeedback").click();ga("send","event","ContactOwnerFeedback","FeedbackSubmitted","User submitted feedback"),$.ajax({url:url,type:"POST",data:{feedbacks:JSON.stringify(feedbacks)},success:function(a){hideLoading();try{if(a=JSON.parse(a),"true"==a.data.limitChanged){var b=parseInt(a.data.newLimit)-parseInt(a.data.oldLimit);0!=b&&displayAlerts("Thanks for your feedback.Your contact limit has been increased by "+b,"success",3e3)}else displayAlerts("Thanks for your feedback.Your credit limit request is under processing.","warning",3e3)}catch(a){}$("#cancelFeedback").click()},error:function(a){displayGenericError(),hideLoading(),$("#cancelFeedback").click()}})}function editFeedback(a){var b=$(a).data("contact");$("#feedbackTable tr#"+b).show(),$("#feedbackTable tr#undo_"+b).hide()}function markShortlistAndIncreaseCount(a,b){console.log(a),b&&b.indexOf("DetailPage")>0?toggleShortlistButton("listShortlist"+a,!0,!0):toggleShortlistButton("listShortlist"+a,!0,!1);var c=parseInt($($('[data-action="shortlistCount"]')[0]).text())+1;$('[data-action="shortlistCount"]').html(c)}function closeContactOwner(){$("#userVerificationModal").modal("hide")}function markDisplayPic(a,b,c){var d="propId="+a+"&imgId="+b,e="/image/displayPic/?"+d;$.post(e,null,function(a){$(c).parent(".card").siblings(".card").children(".icon.icon-star").removeClass("green"),$(c).removeClass("green"),$(c).addClass("green")})}function commercialMarkDisplayPic(a,b,c){var d="propId="+a+"&imgId="+b,e="/image/displayPic/?"+d;$.post(e,null,function(a){$(c).closest(".formUploadedImageContainer").find(".icon-star.icon").removeClass("green");var b=$(c).closest(".card").find("#favouriteMark");b.removeClass("green"),b.addClass("green")})}function addTitle(a,b,c){var d="propId="+a+"&imgId="+b+"&title="+c,e="/image/title/?"+d;$.post(e,null,function(a){})}function markPropertyRented(a,b,c){showLoading();var d="/profile/deactivate/"+a+"?reason="+b;c&&(""==b?nbGA.logEvent("Property","RequestReactivationDetailPage"):-1!==b.indexOf("LETOUT")?nbGA.logEvent("Property","MarkRentedOutDetailPage"):nbGA.logEvent("Property","MarkSoldOutDetailPage")),$.ajax({url:d,type:"POST",success:function(a){a&&("LETOUT"==b?displayAlerts("Your property has been marked as rented and users will not be able to connect with you now. If you have done this by mistake, please call +91-92417-00000 or email us on hello@nobroker.in","success",5e3):"LETOUT_NOBROKER"==b?displayAlerts("Your property has been marked as rented via NoBroker and users will not be able to connect with you now. If you have done this by mistake, please call +91-92417-00000 or email us on hello@nobroker.in","success",5e3):displayAlerts("Your request to activate your listing again is submitted, for more info please call +91-92417-00000 or email us on hello@nobroker.in","success",5e3)),hideLoading(),setTimeout(function(){location.reload()},5e3)},error:function(a){displayGenericError(),hideLoading()}})}function propertyUnderProcessing(a){displayAlerts("Your request to activate your property is under process, for more info please call +91-92417-00000 or email us on hello@nobroker.in","success",5e3).delay(1e3).fadeOut()}function refreshPageIfLoginStateChange(){$("#isULIN").val()!=$("#isULINPing").val()&&(gaLogging.logEventWithProductType("NewUser","auto-signup","{}"),showLoading(),location.reload())}function pingLogin(){$.ajax({url:"/ping/loggedIn",type:"GET",success:function(a){$("#isULINPing").val(a)},error:function(a){}})}function getUserInfo(a,b){userInfo={},$.ajax({url:"/api/v1/user/info",type:"GET",success:function(c){200==c.status?(userInfo=c.data,a&&a(b)):(hideLoading(),displayAlerts(c.message,"danger",5e3))},error:function(a){hideLoading(),displayAlerts(a.message,"danger",5e3)}})}function sendOTP(){if(email=$("#userName").val(),void 0!=email&&""!=email){var a="/api/v2/public/user/sendOTP/"+email;showLoading(),$.post(a,null,function(a){}).done(function(a){if(hideLoading(),a)if(200==a.status&&200==a.statusCode){ga("send","event","OTP","OTP Requested","OTP success for user "+email);var b="OTP sent to registered phone. Use OTP to login.";displayAlerts(b,"success",5e3),$("#signInMessage").text(b),$("#signInMessage").show(),$("#signInError").hide()}else if(404==a.status&&200==a.statusCode){ga("send","event","OTP","OTP Failed","OTP failed for user "+email);var b=email+" is not registered with us. Please register to continue.";displayAlerts(b,"danger",3e3),$("#signInError").text(b),$("#signInError").show(),$("#signInMessage").hide()}else 420==a.status&&200==a.statusCode&&(displayAlerts(a.message,"danger",3e3),$("#signInError").text(a.message),$("#signInError").show(),$("#signInMessage").hide());else{ga("send","event","OTP","OTP Failed","OTP failed for user "+email);var b=email+" is not registered with us.";displayAlerts(b,"danger",3e3),$("#signInError").text(b),$("#signInError").show(),$("#signInMessage").hide()}}).fail(function(a,b,c){displayGenericError(),hideLoading()})}else displayAlerts("Enter Your Email ID OR Phone Number To Receive An OTP","danger",3e3),$("#signInError").text("Enter Your Email ID or Phone Number To Receive An OTP"),$("#signInError").show()}function requestImageBasedOnProduct(a,b,c){a&&$.ajax({url:"/api/v1/property/requestImage/"+a,type:"POST",success:function(b){displayAlerts("Request for more photos is sent to owner","success",8e3),nbGA.logEvent("requestPhotos",c,{propertyId:a})},error:function(a){}})}function requestImage(a){requestImageBasedOnProduct(a,"","")}function outTraffic(a){var b=a.split(" "),c="";return c=b.length>1?b[0]+b[1]:b,ga("send","event","rewards",c+"-click","Redirected to "+a),!0}function claimReward(a,b,c,d){$.ajax({url:"/api/v1/rewards/claim?token="+a+"&couponId="+b,method:"POST",success:function(a){$("#coupon-code-content-"+b).addClass("hide"),$("#coupon-code-"+b).removeClass("hide");var c=d.split(" "),e="";return e=c.length>1?c[0]+c[1]:c,ga("send","event","rewards",e+"-claim","coupon claimed from "+d),null!=d&&""!=d?displayAlerts("Congratulations! You have successfully claimed the offer from "+d+".","success",3e3):displayAlerts("Congratulations! You have successfully claimed the offer from "+d+". An "+d+" representative would call you in the next 24 hours.","success",3e3),!0},error:function(a){return displayAlerts("Unauthorized access","danger",3e3),!1}})}function claimedCoupon(a){var b=a.split(" "),c="";return c=b.length>1?b[0]+b[1]:b,ga("send","event","rewards",c+"-click","Redirected to "+a),displayAlerts("You have already claimed your reward for "+a+" Coupon.","success",3e3),!0}function rupeeFormat(a){var b="";try{b+=parseInt(a,10),b=b.toString();var c=b.substring(b.length-3),d=b.substring(0,b.length-3);""!==d&&(c=","+c),b=d.replace(/\B(?=(\d{2})+(?!\d))/g,",")+c}catch(c){b=a}return b}function dateFormater(a,b){var c=new Date(a),d=c.getDate(),e=c.getMonth()+1,f=c.getUTCFullYear();return d<=9&&(d="0"+d),e<=9&&(e="0"+e),b?d+"/"+e+"/"+f+" "+formatAMPM(a):d+"/"+e+"/"+f}function nearbyFlow(a,b,c){"true"==$("#isULIN").val()&&populateCustomLocations(),c||(c=!1),$.ajax({url:"/api/v2/property/"+a+"/nearby",dataType:"json"}).done(function(c){function d(){var d=new Nearby;d.currentPosition=new google.maps.LatLng($("#map-canvas").data("latitude"),$("#map-canvas").data("longitude")),d.hashKey=c.otherParams.hashKey,d.init("#dummyMapCanvas",d.currentPosition,a,b),d.showTransitInfo(),d.showEssentialsInfo(),d.showUtilitiesInfo();var e=setInterval(function(){11===d.doneCallbackCount&&(d.sendSaveRequest(d.dataHash),clearInterval(e))},300)}200==c.status?(map.currentPosition=new google.maps.LatLng($("#map-canvas").data("latitude"),$("#map-canvas").data("longitude")),map.init("#map-canvas",map.currentPosition),map.defaultZoom=15,map.nearbyPlaces=c.data,map.fromDb=!0,$("#utilitiesInfo").data("loaded",!0),$("#transitInfo").data("loaded",!0),$("#essentialsInfo").data("loaded",!0),map.reset(),map.addPinForCurrentPosition(),$(".transit-info").click()):202==c.status?(map.currentPosition=new google.maps.LatLng($("#map-canvas").data("latitude"),$("#map-canvas").data("longitude")),map.init("#map-canvas",map.currentPosition),map.defaultZoom=15,map.reset(),map.addPinForCurrentPosition(),$(".transit-info").click(),setTimeout(d,2e3)):(map.currentPosition=new google.maps.LatLng($("#map-canvas").data("latitude"),$("#map-canvas").data("longitude")),map.init("#map-canvas",map.currentPosition),map.defaultZoom=15,map.reset(),map.addPinForCurrentPosition(),$(".transit-info").click())}).fail(function(){map.currentPosition=new google.maps.LatLng($("#map-canvas").data("latitude"),$("#map-canvas").data("longitude")),map.init("#map-canvas",map.currentPosition),map.defaultZoom=15,map.reset(),map.addPinForCurrentPosition(),$(".transit-info").click()})}function paymentHandler(a){showLoading("<h4>We are processing your payment... </h4><div>Please don't click <b>'Back'</b>, <b>'Refresh'</b> or <b>'Close'</b> your webpage until you receive payment confirmation.</div>");var b="/api/v1/plan_payment/payment/response?status=success&refId="+a.razorpay_payment_id;$.ajax({url:b,method:"POST",success:function(a){if(200==a.status){if(isOwnerPlan){if(isOwnerPaymentShowSuccess=!0,"undefined"!=typeof Storage)try{localStorage.setItem("isOwnerPaymentShowSuccess",isOwnerPaymentShowSuccess)}catch(a){}hideLoading(),window.location.replace(document.location.origin+"/list-your-property-for-rent-sale")}else getCurrentPlanDetail(!0);$("button.planButton").prop("disabled",!1),$("button.payBtn").prop("disabled",!1),$("button.payBtn").fadeTo("fast",1)}hideLoading()},error:function(a){displayAlerts("There was an error while processing your request. For further assistance, please contact +91 9241700000.","danger",15e3),$("button.planButton").prop("disabled",!1),$("button.payBtn").prop("disabled",!1),$("button.payBtn").fadeTo("fast",1),hideLoading()}})}function waitForRazorPayElement(a,b){"undefined"!=typeof Razorpay?rzpHandler(a,b):setTimeout(function(){waitForRazorPayElement(a,b)},20)}function rzpHandler(a,b){var c={key:a.data.secretKey,amount:a.data.amountInPaisa,name:a.data.name,email:a.data.email,contact:a.data.contact,orderId:a.data.orderId,"notes.redirectUrl":a.data.redirectUrl,"notes.orderId":a.data.orderId,prefill:{name:a.data.name,email:a.data.email,contact:a.data.contact},theme:{color:"#3240A0"}};b&&(c.handler=function(a){b(a)});var d=new Razorpay(c);hideLoading(),d.open()}function relaxPlanListCard(a){if(a||(a="listPlanCard"),$("#pickedProductType").text().indexOf("Commercial")>-1){if("resaleList"==a){gaLogging.logEventWithProductType(a,"ChoosePlan",{});var b=window.open("/commercial/buyer/plans?nb_param=from:"+a,"_blank");b.focus()}else if("listPlanCard"==a){gaLogging.logEventWithProductType(a,"ChoosePlan",{});var b=window.open("/commercial/tenant/plans?nb_param=from:"+a,"_blank");b.focus()}}else if("resaleList"==a){gaLogging.logEventWithProductType(a,"ChoosePlan",{});var b=window.open("/buyer/plans?nb_param=from:"+a,"_blank");b.focus()}else{gaLogging.logEventWithProductType(a,"ChoosePlan",{});var b=window.open("/tenant/plans?nb_param=from:"+a,"_blank");b.focus()}}function planStatus(a,b){loadPlansData(!1,function(){getCurrentPlanDetail(a,b)})}function getCurrentPlanDetail(a,b,c){if("true"===$("#isULIN").val())showLoading(),$.ajax({url:"/api/v1/plan_payment/tenant/current/detail",type:"GET",success:function(d){renderResp(d,a,b,c),hideLoading()},error:function(a){hideLoading(),displayGenericError()}});else{try{localStorage.setItem("showPaymentPlan","1")}catch(a){}location.reload()}}function getAssurePlanDetail(){showLoading(),$(".busy-holder").addClass("show"),$.ajax({url:"/api/v1/plan_payment/tenant/current/detail",type:"GET",success:function(a){var b=a.data;if("NO_PLAN"==b.current_rent_plan||"TENANT_ASSURE"!=b.current_rent_plan.plan.id||b.inactive)$(".busy-holder").removeClass("show"),hideLoading();else{var c=dateFormater(a.data.current_rent_plan.expiryDate),d=dateFormater(a.data.current_rent_plan.purchasedDate);$("#assure_plan_card").addClass("hide"),$(".currentPlan").removeClass("hide"),$(".currentPlan .numberCircle").text(b.remaining_count),$(".currentPlan #dop").text(d),$(".currentPlan #doe").text(c),$(".currentPlan #rm-phone").text(b.rm.rm_phone),$(".currentPlan #rm-gmail").text(b.rm.rm_email),$(".busy-holder").removeClass("show"),hideLoading()}},error:function(a){$(".busy-holder").removeClass("show"),hideLoading(),displayGenericError()}})}function renderResp(a,b,c,d){if($.timeago.settings.allowFuture=!0,"NO_PLAN"===a.data.current_rent_plan){if($("#isULIN").val()!=$("#isULINPing").val()){try{localStorage.setItem("showPaymentPlan","1")}catch(a){}location.reload()}else c||($("#newPaymentModal").modal("show"),$("#newPaymentModal .closePaymentButton").removeAttr("data-dismiss")),$("#newPaymentModal .payment-plan-header").addClass("alertMessageHeader"),triggerZopimForPlan(d,zopimUrls.noPlan),c&&alignPlans()}else{var e=a.data.current_rent_plan.plan.id;if(b){c||$("#newPaymentModal").modal("hide");var f=$("#tenantPaymentSuccessModalHbs").html(),g=Handlebars.compile(f),h=null;a.data.current_rent_plan.purchasedDate=dateFormater(a.data.current_rent_plan.purchasedDate),a.data.current_rent_plan.expiryDate=dateFormater(a.data.current_rent_plan.expiryDate);var i=a.data.current_rent_plan.plan.id,j=a.data.current_rent_plan.plan.frequency.toLowerCase();a.data.current_rent_plan.plan.frequency=j;var k=a.data.current_rent_plan.plan.contacts,l="Start getting "+j+" alerts and contact "+k+" owners free of cost and find a home for yourself with ease";"TENANT_RELAX"!=i&&"TENANT_ASSURE"!=i||(l+=" and contact the personal assistant to find your dream house"),a.data.current_rent_plan.planSummaryText=l,a.data.current_rent_plan.plan.extraPerk&&(a.data.current_rent_plan.plan.extraPerk=JSON.parse(a.data.current_rent_plan.plan.extraPerk)),h=g(a),$(".tenantSuccessModal").empty(),$(".tenantSuccessModal").append(h),$(".tenantSuccessModal").modal("show"),initialiseDatePicker(),"TENANT_BASIC"!=e&&"TENANT_POWER"!=e||$(".plan-summary").css("margin-left","27%"),gaLogging.logEventWithProductType("ChoosePlan","Success_"+e,{}),"TENANT_BASIC"!==e&&nbGA&&nbGA.logEvent("payment","success",{}),c&&planStatus(!1,!0),checkIsPlanPage()||onLoadSuccessPlanPopupAdobeEvent()}else{a.data.inactive||(isPlanActive=!0);var m=dateFormater(a.data.current_rent_plan.expiryDate),n=dateFormater(a.data.current_rent_plan.purchasedDate);if(c||($("#paymentSuccessModal").modal("hide"),$("#newPaymentModal").modal("show"),$("#newPaymentModal .closePaymentButton").removeAttr("data-keyboard"),$("#newPaymentModal .closePaymentButton").removeAttr("data-backdrop"),$("#newPaymentModal .closePaymentButton").attr("data-dismiss","modal")),$("#newPaymentModal .payment-plan-header").addClass("alertMessageHeader"),$("#newPaymentModal #paymentHeaderText").html("Enjoy our "+a.data.current_rent_plan.plan.displayName+" services. You can upgrade to any other NoBroker Home Plans to make house hunting easier at any time."),"TENANT_BASIC"===e)$("#newPaymentModal .basicPlan").addClass("hide"),$("#newPaymentModal .basicPlanUpgrade").removeClass("hide"),$("#newPaymentModal .basicPlanUpgrade .numberCircle").html(a.data.remaining_count),$("#newPaymentModal .basicPlanUpgrade #dop").html(n),$("#newPaymentModal .basicPlanUpgrade #doe").html(m),a.data.inactive?($("#newPaymentModal .basicPlanUpgrade .expiredPlan").removeClass("hide"),$("#newPaymentModal .basicPlanUpgrade .activePlan").addClass("hide"),$("#newPaymentModal .basicPlanUpgrade .postRequirementButton").addClass("hide"),$("#newPaymentModal .basicPlanUpgrade .noButton").removeClass("hide"),"EXPIRED"===a.data.inactive_reason?($("#newPaymentModal #paymentHeaderText").html("Your "+a.data.current_rent_plan.plan.displayName+" services have Expired. Buy a NoBroker home plan to contact more owners."),$("#newPaymentModal .basicPlanUpgrade #inactiveReason").html("Plan Expired")):($("#newPaymentModal #paymentHeaderText").html("Your contact limit has been exceeded for  "+a.data.current_rent_plan.plan.displayName+". Buy a NoBroker home plan to contact more owners."),$("#newPaymentModal .basicPlanUpgrade #inactiveReason").html("Limit Exceeded")),$("#newPaymentModal .basicPlanUpgrade #expiredPlanStatus").html("Expired"),triggerZopimForPlan(d,zopimUrls.basicExpired)):($("#newPaymentModal .basicPlanUpgrade .expiredPlan").addClass("hide"),$("#newPaymentModal .basicPlanUpgrade .activePlan").removeClass("hide"),$("#newPaymentModal .relaxPlan #payPlanType").html("Upgrade"),$("#newPaymentModal .freedomPlan #payPlanType").html("Upgrade"),$("#newPaymentModal .assurePlan #payPlanType").html("Upgrade"),triggerZopimForPlan(d,zopimUrls.basicActive));else if("TENANT_POWER"===e){if($("#newPaymentModal .freedomPlanUpgrade").removeClass("hide"),$("#newPaymentModal .basicPlan").removeClass("onHoverCss"),$("#newPaymentModal .basicPlan").addClass("expired"),$("#newPaymentModal .basicPlan .planButtonRow").addClass("hide"),$("#newPaymentModal .basicPlan .noButton").addClass("hide"),$("#newPaymentModal .basicPlan .planButton").addClass("disabled"),$("#newPaymentModal .freedomPlanUpgrade .numberCircle").html(a.data.remaining_count),$("#newPaymentModal .freedomPlanUpgrade #dop").html(n),$("#newPaymentModal .freedomPlanUpgrade #doe").html(m),a.data.inactive)$("#newPaymentModal .freedomPlanUpgrade .expiredPlan").removeClass("hide"),$("#newPaymentModal .freedomPlanUpgrade .activePlan").addClass("hide"),$("#newPaymentModal .freedomPlanUpgrade .postRequirement").addClass("hide"),$("#newPaymentModal .freedomPlanUpgrade .renewPlan").removeClass("hide"),"EXPIRED"===a.data.inactive_reason?($("#newPaymentModal #paymentHeaderText").html("Your "+a.data.current_rent_plan.plan.displayName+" services have Expired. Now you would have to renew your plan to keep contacting the owners."),$("#newPaymentModal .freedomPlanUpgrade #inactiveReason").html("Plan Expired")):($("#newPaymentModal #paymentHeaderText").html("Your contact limit has been exceeded for  "+a.data.current_rent_plan.plan.displayName+". Now you would have to renew your plan to keep contacting the owners."),$("#newPaymentModal .freedomPlanUpgrade #inactiveReason").html("Limit Exceeded")),$("#newPaymentModal .freedomPlanUpgrade #expiredPlanStatus").html("Expired");else{$("#newPaymentModal .freedomPlanUpgrade .expiredPlan").addClass("hide"),$("#newPaymentModal .freedomPlanUpgrade .activePlan").removeClass("hide"),$("#newPaymentModal #relaxPlanCost").html("1,000"),$("#newPaymentModal #relaxPlanButtonCost").html("1,000"),$("#newPaymentModal .relaxPlan #payPlanType").html("Upgrade"),$("#newPaymentModal .assurePlan #payPlanType").html("Upgrade"),$("#newPaymentModal .assurePlan #assurePlanButtonCost").html("5,000"),$("#newPaymentModal #rental-discount").empty(),$("#newPaymentModal #rental-discount").append('<p class="font-bold rentalDiscount">25% OFF</p><a class="btn rentalDiscountButton" href="/rental-agreement#whyragreement" id="planRAanchor" target="_blank">Create</a>');var o=$("#newPaymentModal .freedomPlanUpgrade").css("top");$("#newPaymentModal .freedomPlanUpgrade").css("top",o-31)}triggerZopimForPlan(d,zopimUrls.freedom)}else"TENANT_RELAX"===e?a.data.inactive?("EXPIRED"===a.data.inactive_reason?$("#newPaymentModal #paymentHeaderText").html("Your "+a.data.current_rent_plan.plan.displayName+" services have Expired. Now you would have to renew your plan to keep contacting the owners."):$("#newPaymentModal #paymentHeaderText").html("Your contact limit has been exceeded for  "+a.data.current_rent_plan.plan.displayName+". Now you would have to renew your plan to keep contacting the owners."),$("#newPaymentModal .freedomPlanUpgrade #expiredPlanStatus").html("Expired"),$("#newPaymentModal .basicPlan").addClass("expired"),$("#newPaymentModal .basicPlan .planButton").addClass("disabled")):($("#newPaymentModal .supTextRelaxPlan").addClass("hide"),$("#newPaymentModal .relaxPlan").addClass("hide"),$("#newPaymentModal .relaxPlanUpgrade").removeClass("hide"),$("#newPaymentModal .basicPlan").removeClass("onHoverCss"),$("#newPaymentModal .freedomPlan").removeClass("onHoverCss"),$("#newPaymentModal .basicPlan").addClass("expired"),$("#newPaymentModal .basicPlan .planButton").addClass("disabled"),$("#newPaymentModal .freedomPlan").addClass("expired"),$("#newPaymentModal .freedomPlan .planButton").addClass("disabled"),$("#newPaymentModal .basicPlan .planButtonRow").addClass("hide"),$("#newPaymentModal .basicPlan .noButton").addClass("hide"),$("#newPaymentModal .freedomPlan .planButtonRow").addClass("hide"),$("#newPaymentModal .freedomPlan .noButton").addClass("hide"),$("#newPaymentModal .relaxPlanUpgrade .numberCircle").html(a.data.remaining_count),$("#newPaymentModal .relaxPlanUpgrade #dop").html(n),$("#newPaymentModal .relaxPlanUpgrade #doe").html(m),$("#newPaymentModal .relaxPlanUpgrade .expiredPlan").addClass("hide"),$("#newPaymentModal .relaxPlanUpgrade .activePlan").removeClass("hide"),$("#newPaymentModal #paymentHeaderText").html("Enjoy the "+a.data.current_rent_plan.plan.displayName+" services, just contact the personal assistant and he will find you, Your dream house"),a.data.rm&&($("#newPaymentModal .relaxPlanUpgrade #rm-details").removeClass("hide"),$("#newPaymentModal .relaxPlanUpgrade #rm-phone").html(a.data.rm.rm_phone),$("#newPaymentModal .relaxPlanUpgrade #rm-gmail").html(a.data.rm.rm_email))):"TENANT_ASSURE"===e&&($("#newPaymentModal .assurePlan").addClass("hide"),$("#newPaymentModal .assurePlanUpgrade").removeClass("hide"),$("#newPaymentModal .basicPlan").removeClass("onHoverCss"),$("#newPaymentModal .freedomPlan").removeClass("onHoverCss"),$("#newPaymentModal .relaxPlan").removeClass("onHoverCss"),$("#newPaymentModal .basicPlan").addClass("expired"),$("#newPaymentModal .relaxPlan").addClass("expired"),$("#newPaymentModal .basicPlan .planButton").addClass("disabled"),$("#newPaymentModal .relaxPlan .planButton").addClass("disabled"),$("#newPaymentModal .freedomPlan").addClass("expired"),$("#newPaymentModal .freedomPlan .planButton").addClass("disabled"),$("#newPaymentModal .basicPlan .planButtonRow").addClass("hide"),$("#newPaymentModal .basicPlan .noButton").addClass("hide"),$("#newPaymentModal .freedomPlan .planButtonRow").addClass("hide"),$("#newPaymentModal .freedomPlan .noButton").addClass("hide"),$("#newPaymentModal .relaxPlan .planButtonRow").addClass("hide"),$("#newPaymentModal .relaxPlan .noButton").addClass("hide"),$("#newPaymentModal .assurePlanUpgrade .numberCircle").html(a.data.remaining_count),$("#newPaymentModal .assurePlanUpgrade #dop").html(n),$("#newPaymentModal .assurePlanUpgrade #doe").html(m),a.data.inactive?($("#newPaymentModal .assurePlanUpgrade .expiredPlan").removeClass("hide"),$("#newPaymentModal .assurePlanUpgrade .activePlan").addClass("hide"),$("#newPaymentModal .assurePlanUpgrade .postRequirement").addClass("hide"),$("#newPaymentModal .assurePlanUpgrade .renewPlan").removeClass("hide"),"EXPIRED"===a.data.inactive_reason?($("#newPaymentModal #paymentHeaderText").html("Your "+a.data.current_rent_plan.plan.displayName+" services have Expired. Now you would have to renew your plan to keep contacting the owners."),$("#newPaymentModal .assurePlanUpgrade #inactiveReason").html("Plan Expired")):($("#newPaymentModal .assurePlanUpgrade #inactiveReason").html("Limit Exceeded"),$("#newPaymentModal #paymentHeaderText").html("Your contact limit has been exceeded for  "+a.data.current_rent_plan.plan.displayName+". Now you would have to renew your plan to keep contacting the owners.")),$("#newPaymentModal .assurePlanUpgrade #expiredPlanStatus").html("Expired"),$("#newPaymentModal .freedomPlan").addClass("expired"),$("#newPaymentModal .freedomPlan .planButton").addClass("disabled"),$("#newPaymentModal .relaxPlan").addClass("expired"),$("#newPaymentModal .relaxPlan .planButton").addClass("disabled"),$("#newPaymentModal .basicPlan").addClass("expired"),$("#newPaymentModal .basicPlan .planButton").addClass("disabled")):($("#newPaymentModal .assurePlanUpgrade .expiredPlan").addClass("hide"),$("#newPaymentModal .assurePlanUpgrade .activePlan").removeClass("hide"),$("#newPaymentModal #paymentHeaderText").html("Enjoy the "+a.data.current_rent_plan.plan.displayName+" services, just contact the personal assistant and he will find you, Your dream house"),a.data.rm&&($("#newPaymentModal .assurePlanUpgrade #rm-details").removeClass("hide"),$("#newPaymentModal .assurePlanUpgrade #rm-phone").html(a.data.rm.rm_phone),$("#newPaymentModal .assurePlanUpgrade #rm-gmail").html(a.data.rm.rm_email))));c&&alignPlans()}}}function triggerZopimForPlan(a,b){a||(a="modal"),b||(b=zopimUrls.noPlan),$.ajax({url:"/api/v1/admin/zopim/setting/getZopimStatus",type:"GET",complete:function(c){if("200"==c.status){var d=JSON.parse(c.responseText);d.data&&d.data.zopimStatus&&"1"===d.data.zopimStatus&&setTimeout(function(){$zopim&&$zopim.livechat&&$zopim.livechat.sendVisitorPath&&($zopim.livechat.sendVisitorPath({url:b,title:"zopim-desktop-"+a}),nbGA&&nbGA.logEvent("triggerZopim","desktop-"+a,{}),"true"===$("#isULIN").val()?($zopim.livechat.setPhone($("#loggedInUserPhone").val()),$zopim.livechat.setEmail($("#loggedInUserEmail").val()),$zopim.livechat.setName($("#loggedInUserName").val())):userInfo&&userInfo.phone&&userInfo.email&&userInfo.name&&($zopim.livechat.setPhone(userInfo.phone),$zopim.livechat.setEmail(userInfo.email),$zopim.livechat.setName(userInfo.name)))},3e3)}}})}function triggerZopimForBuilderPage(a,b){a||(a="builderDetailPage"),url=b?zopimUrls[b]:zopimUrls.builderPage,$.ajax({url:"/api/v1/admin/zopim/setting/getZopimStatus",type:"GET",complete:function(b){if("200"==b.status){var c=JSON.parse(b.responseText);c.data&&c.data.zopimStatus&&"1"===c.data.zopimStatus&&setTimeout(function(){$zopim&&$zopim.livechat&&$zopim.livechat.sendVisitorPath&&($zopim.livechat.sendVisitorPath({url:url,title:"Builder Page"}),nbGA&&nbGA.logEvent("triggerZopim","desktop-"+a,{}),"true"===$("#isULIN").val()?($zopim.livechat.setPhone($("#loggedInUserPhone").val()),$zopim.livechat.setEmail($("#loggedInUserEmail").val()),$zopim.livechat.setName($("#loggedInUserName").val())):userInfo&&userInfo.phone&&userInfo.email&&userInfo.name&&($zopim.livechat.setPhone(userInfo.phone),$zopim.livechat.setEmail(userInfo.email),$zopim.livechat.setName(userInfo.name)))},3e3)}}})}function triggerZopimForGetOwnerDetails(a,b){a||(a="listPage"),url=b?zopimUrls[b]:zopimUrls.ownerDetails,$.ajax({url:"/api/v1/admin/zopim/setting/getZopimStatus",type:"GET",complete:function(b){if("200"==b.status){var c=JSON.parse(b.responseText);c.data&&c.data.zopimStatus&&"1"===c.data.zopimStatus&&setTimeout(function(){$zopim&&$zopim.livechat&&$zopim.livechat.sendVisitorPath&&($zopim.livechat.sendVisitorPath({url:url,title:"Get Owner Details"}),nbGA&&nbGA.logEvent("triggerZopim","desktop-"+a,{}),"true"===$("#isULIN").val()?($zopim.livechat.setPhone($("#loggedInUserPhone").val()),$zopim.livechat.setEmail($("#loggedInUserEmail").val()),$zopim.livechat.setName($("#loggedInUserName").val())):userInfo&&userInfo.phone&&userInfo.email&&userInfo.name&&($zopim.livechat.setPhone(userInfo.phone),$zopim.livechat.setEmail(userInfo.email),$zopim.livechat.setName(userInfo.name)))},3e3)}}})}function triggerZopimForListPage(){$.ajax({url:"/api/v1/user/listPage/showZopim",type:"GET",complete:function(a){"200"==a.status&&triggerZopimForPlan("listPage")}})}function triggerZopimForDetailPage(){var a=!0;localStorage&&(showChatOnDetailPage=localStorage.getItem("showChatOnDetailPage"),showChatOnDetailPage&&"true"==showChatOnDetailPage&&(a=!1,triggerZopimForPlan("rentDetailPage",zopimUrls.rentDetailPage)),showChatOnDetailPage&&"false"==showChatOnDetailPage&&(a=!1)),a&&$.ajax({url:"/api/v1/user/detailPage/showZopim",type:"GET",success:function(a){200==a.status_code?(localStorage.setItem("showChatOnDetailPage","true"),triggerZopimForPlan("rentDetailPage",zopimUrls.rentDetailPage)):localStorage.setItem("showChatOnDetailPage","false")}})}function triggerZopimForResalePage(){$.ajax({url:"/api/v1/user/resaleDetailsPage/showZopim",type:"GET",success:function(a){200==a.status_code&&triggerZopimForPlan("resaleDetailsPage",zopimUrls.resaleDetailsPage)}})}function triggerZopimForCommercialListingAndDetailPage(){var a=$("#nbpt").val();"COMMERCIAL_RENT"!==a&&"COMMERCIAL_BUY"!==a||triggerZopimForPlan("commercialListDetailPages",zopimUrls.commercialListDetailPages)}function showPaymentPlanWarning(){$("#paymentSuccessModal").modal("show"),$("#paymentPlanStatus").text("Reminder!"),$("#planSuccessMessage").text("Reminding you that u have used up half of your payment plan")}function openTenantPaymentPlans(){$("#paymentSuccessModal").modal("hide"),$.ajax({url:"/api/v1/plan_payment/tenant/current",method:"GET",success:function(a){a.data.free_rent_plan||($("#basicPlanButton").addClass("disabled"),$(".basicPlan").removeClass("hide"),$(".freedomPlan").removeClass("hide"),$(".relaxPlan").removeClass("hide")),$("#newPaymentModal").modal("show")},error:function(a){$("#newPaymentModal").modal("hide")}})}function loadPlansData(a,b){$.ajax({url:"/api/v2/plan_payment/tenant/plans?showAssure=true",method:"GET",success:function(c){var d={};_.each(c.data,function(a){a.amount=a.amount.toLocaleString(),"TENANT_POWER"==a.plan_id?d.freedomData=a:"TENANT_RELAX"==a.plan_id?d.relaxData=a:"TENANT_BASIC"==a.plan_id?d.basicData=a:"TENANT_ASSURE"==a.plan_id&&(d.assureData=a)}),d.isPlanPage=a,a?gaLogging.logEventWithProductType("planPage","chooseplan",{}):gaLogging.logEventWithProductType("ContactOwner","chooseplan",{});var e=$("#new_payment_plan_card").html(),f=Handlebars.compile(e),g=null;if(d.planPagePaytmOfferCard="false",$.ajax({url:"/api/v1/admin/nb_setting/all",method:"GET",async:!1,success:function(a){if(a){var b=a.data;b&&(d.planPagePaytmOfferCard=b.planPagePaytmOfferCard)}},error:function(a){}}),d.planPagePaytmOfferCard&&"true"==d.planPagePaytmOfferCard){var h=_.find(d,{isUgradable:!0});d.currentOwnerPlan&&"NO_PLAN"!=d.currentOwnerPlan&&!h&&(d.planPagePaytmOfferCard="false")}"false"==d.planPagePaytmOfferCard&&$(".paytmOfferContainer").css("display","none"),g=f(d),$("#newPaymentModal").empty(),$("#newPaymentModal").append(g),b&&b()},error:function(a){$("#newPaymentModal").modal("hide")}})}function loadOwnerPlanData(a,b){var c="/api/v1/plan_payment/owner/plan/"+a;showLoading(),$.ajax({url:c,method:"GET",success:function(c){var d=c.data;if(b)b(a,d);else{if(d.amount=d.amount.toLocaleString(),"OWNER_RELAX"==a){var e=$("#owner-relax-plan").html(),f=Handlebars.compile(e),g=null;g=f(d),$("#owner-relax-plan-ftl").empty(),$("#owner-relax-plan-ftl").append(g)}else if("OWNER_FREEDOM"==a){var e=$("#owner-freedom-plan").html(),f=Handlebars.compile(e),g=null;g=f(d),$("#owner-freedom-plan-ftl").empty(),$("#owner-freedom-plan-ftl").append(g)}else if("OWNER_SUPER_RELAX"==a){var e=$("#owner-super-relax-plan").html(),f=Handlebars.compile(e),g=null;g=f(d),$("#owner-super-relax-plan-ftl").empty(),$("#owner-super-relax-plan-ftl").append(g)}hideLoading()}},error:function(a){hideLoading(),displayGenericError()}})}function getSingleCurrentOwnerPlanDetails(a,b){showLoading(),$.ajax({url:"/api/v1/plan_payment/owner/current/detail",method:"GET",success:function(c){if(currentPlan=c.data,"NO_PLAN"!=currentPlan.current_rent_plan&&(b.amount=b.amount.toLocaleString(),a==currentPlan.current_rent_plan.plan.id&&(b.showCurrentOwnerPlan=!0,currentPlan.inactive&&(b.expired=!0,b.expiredReason=currentPlan.inactive_reason_display))),b.amount=b.amount.toLocaleString(),"OWNER_RELAX"==a){var d=$("#owner-relax-plan").html(),e=Handlebars.compile(d),f=null;f=e(b),$("#owner-relax-plan-ftl").empty(),$("#owner-relax-plan-ftl").append(f)}else if("OWNER_FREEDOM"==a){var d=$("#owner-freedom-plan").html(),e=Handlebars.compile(d),f=null;f=e(b),$("#owner-freedom-plan-ftl").empty(),$("#owner-freedom-plan-ftl").append(f)}else if("OWNER_SUPER_RELAX"==a){var d=$("#owner-super-relax-plan").html(),e=Handlebars.compile(d),f=null;f=e(b),$("#owner-super-relax-plan-ftl").empty(),$("#owner-super-relax-plan-ftl").append(f)}hideLoading()},error:function(a){displayGenericError(),hideLoading()}})}function sendClickEvent(a,b){var c={};c.type=a,c.nbFr=b,$.ajax({url:"/createEvent",method:"POST",data:c})}function openTenantScheduleModal(a){gaLogging.logEventWithProductType("Scheduler","open-"+a,{}),addSelectedDaysData("",function(){$("#tenantSchedulerModal").modal("show"),$("#pickedTimeScheduler").attr("disabled",!1)})}function closeTenantScheduleModal(){$("#tenantSchedulerModal").modal("hide")}function ownerAppointments(a){nbGA&&nbGA.logEvent("Menu","Appointments",{}),"true"==$("#isULIN").val()?(showLoading(),$.ajax({url:"/api/v1/slot/visits/all",type:"GET",success:function(a){$("#ownerAppointmentModal .ownerAppointmentContent").empty();for(var b=$("#property_visit_card").html(),c=Handlebars.compile(b),d=null,e=a.data.property_visits,f=0;f<e.length;f++)e[f].isTenant=!1,e[f].isOwner=!0,d=c(e[f]),$("#ownerAppointmentModal .ownerAppointmentContent").append(d);$("#ownerAppointmentModal #ownerAppointmentCount").html(e.length),e.length<1&&$("#ownerAppointmentModal .ownerAppointmentContent").append('<div class="noData">No Appointments booked</div>'),hideLoading(),$("#ownerAppointmentModal").modal("show")},error:function(a){displayGenericError(),hideLoading()}})):displayAlerts("Please login to see your appointments","warning",5e3)}function gotoDetail(a,b){setSeenPropertyMarker(b),window.open(a,"_blank")}function setSeenPropertyMarker(a){$("[data-propertyid="+a+"]").css("visibility","visible"),$("[data-propertyid="+a+"]").prop("title","Last seen: Today")}function storeSeenProperty(a){if(localStorage){var b=a+":|:"+(new Date).toLocaleDateString();try{localStorage.seen?localStorage.seen.indexOf(a)<0&&(localStorage.seen+=","+b):localStorage.seen=b}catch(a){}}}function highlightCard(){$(".card").on({mouseenter:function(){$("a.card-link-detail",this).css("cssText","text-transform: capitalize; margin: 0; color: #fd3753 !important")},mouseleave:function(){$("a.card-link-detail",this).css("cssText","text-transform: capitalize; margin: 0;")}})}function storePreviousNextLinks(a,b){try{localStorage&&a.length>0&&(localStorage.removeItem("previous_"+a[0]),localStorage.removeItem("next_"+a[0]),localStorage.removeItem("previous_"+a[a.length-1]),localStorage.removeItem("next_"+a[a.length-1]))}catch(a){}try{if(localStorage)for(var c=0;c<b.length;c++)0!=c&&localStorage.setItem("previous_"+a[c],b[c-1]),c!=b.length-1&&localStorage.setItem("next_"+a[c],b[c+1])}catch(a){}if(inIframe()){var d={function:"getUserIdAndExistingPropertyIdsForRMDashboard"};d=JSON.stringify(d),window.parent.postMessage(d,"*")}}function inIframe(){try{return window.self!==window.top}catch(a){return!0}}function changeButtonNamesInIframe(a){inIframe()&&(void 0!==a?changeButtonId("mapDOwner",a,"Lead Already Exists"):$("#container").find(".btn-ownercontact-detail").each(function(a,b){var c=b.id.split("contactOwnerBtn")[1];changeButtonId(b.id,c,"Lead Already Exists")}))}function checkForLead(a){return!!inIframe()&&("undefined"!=typeof userIdForSavingLeadForRMDashboard&&("undefined"!=typeof existingPropertyIdsForRMDashboard&&existingPropertyIdsForRMDashboard.indexOf(a)>-1))}function changeButtonId(a,b,c){if(inIframe()&&"undefined"!=typeof userIdForSavingLeadForRMDashboard&&"undefined"!=typeof existingPropertyIdsForRMDashboard){if(existingPropertyIdsForRMDashboard.indexOf(b)>-1?(c?$("#container").find("#"+a).html(c):$("#container").find("#"+a).html("Lead Already Exists"),$("#container").find("#"+a).attr("onclick",null),$("#container").find("#"+a).off("click"),$("#container").find(".btn.btn-sm.btn-default.tooltips").hide(),$("#container").find(".btn.btn-sm.btn-default").hide(),$("#mapDShortlist").parent().closest("div").hide()):($("#container").find("#"+a).html("Add Lead"),$("#container").find("#"+a).attr("onclick",null),$("#container").find("#"+a).off("click"),$("#container").find("#"+a).on("click",function(){saveLeadByRM(a,userIdForSavingLeadForRMDashboard,b)}),$("#container").find(".btn.btn-sm.btn-default.tooltips").hide(),$("#container").find(".btn.btn-sm.btn-default").hide(),$("#mapDShortlist").parent().closest("div").hide()),$("#mapDetailLink")){var d=$("#mapDetailLink").attr("href");d=d+"?rmCustomerUserId="+userIdForSavingLeadForRMDashboard,$("#mapDetailLink").attr("href",d)}if($(".card-link-detail")){var d=$("#prop-"+b).children().find(".card-link-detail").attr("href");d=d+"?rmCustomerUserId="+userIdForSavingLeadForRMDashboard,$("#prop-"+b).children().find(".card-link-detail").attr("href",d)}}}function startPostMessageListenerForRMDashboard(){if(inIframe()){var a=window.addEventListener?"addEventListener":"attachEvent";(0,window[a])("attachEvent"==a?"onmessage":"message",function(a){var b=a.message?"message":"data",c=a[b];try{c=JSON.parse(c)}catch(a){}c&&c.function&&"saveUserIdAndExistingPropertyIdsForRMDashboard"==c.function&&(delete c.function,saveUserIdAndExistingPropertyIdsForRMDashboard(c))},!1)}}function startPostMessageListenerForChatMessage(){if(!inIframe()){var a=window.addEventListener?"addEventListener":"attachEvent";(0,window[a])("attachEvent"==a?"onmessage":"message",function(a){var b=a.message?"message":"data",c=a[b];try{c=JSON.parse(c)}catch(a){}c&&c.function&&"askNotificationPermission"==c.function&&(delete c.function,nbGA.logEvent("BrowserNotification","Chat-show",{}),askNotificationPermission(c))},!1)}}function saveUserIdAndExistingPropertyIdsForRMDashboard(a){inIframe()&&(userIdForSavingLeadForRMDashboard=a.userIdForSavingLeadForRMDashboard,existingPropertyIdsForRMDashboard=a.existingPropertyIdsForRMDashboard,changeButtonNamesInIframe())}function displayPreviousNextLinks(a){var b="previous_"+a,c="next_"+a;if(localStorage){var d=document.getElementById(b),e=document.getElementById(c);try{var f=localStorage.getItem(b),g=localStorage.getItem(c)}catch(a){}if(f||g)if(f)if(g){d.href=f,e.href=g;var h=f.split("/");if(h.length>2){var i=h[h.length-2];$("#"+b).click(function(){storeSeenProperty(i)})}var j=g.split("/");if(j.length>2){var k=j[j.length-2];$("#"+c).click(function(){storeSeenProperty(k)})}}else{$("#"+c).addClass("not-active"),d.href=f,$("#"+c).css("color","lightGray");var h=f.split("/");if(h.length>2){var i=h[h.length-2];$("#"+b).click(function(){storeSeenProperty(i)})}}else{$("#"+b).addClass("not-active"),e.href=g,$("#"+b).css("color","lightGray");var j=g.split("/");if(j.length>2){var k=j[j.length-2];$("#"+c).click(function(){storeSeenProperty(k)})}}else $(".breadcrumb.right-breadcrumb").css("display","none")}else $(".breadcrumb.right-breadcrumb").css("display","none")}function otpVerification(a){var b=$("#otpInput").val();b?(showLoading(),$.ajax({url:"/api/v1/user/verify/otp",type:"POST",data:"otp="+b,success:function(b){200==b.status?($("#otpVerification").modal("hide"),displayAlerts("Thanks for phone no. verification.","success",5e3),hideLoading(),setTimeout(function(){showInfoPopup()},3e3),1==a&&nbGA&&nbGA.logEvent("DisguiseUserDialog","AccountVerified")):($("#otpError").html("otp didn't match"),$("#otpError").show(),setTimeout(function(){$("#otpError").hide()},2e3),hideLoading(),1==a&&nbGA&&nbGA.logEvent("DisguiseUserDialog","OTP_REQUEST_FAILED"))},error:function(a){$("#otpError").html("otp didn't match"),$("#otpError").show(),setTimeout(function(){$("#otpError").hide()},2e3),hideLoading(),nbGA&&nbGA.logEvent("DisguiseUserDialog","OTP_REQUEST_FAILED")}})):($("#otpError").html("Please Enter a Valid OTP"),$("#otpError").show(),setTimeout(function(){$("#otpError").hide()},2e3))}function replaceClass(a,b){$.each(a,function(a,c){var d=$("#"+c).attr("class").split(" ");$.each(d,function(a,e){$.each(b,function(e,f){0==d[a].indexOf(b[e])&&$("#"+c).removeClass(d[a])})})})}function saveSearch(){$.ajax({url:"/ajax/requirement/subscribe",type:"GET",success:function(a){if(a)if(a.length>0){$("#locationGoogle").css("paddingRight","80px"),$("#searchSaved").html(a.length+" Saved <i class='icon-chevron-down'></i>");for(var b="",c=0;c<a.length;c++)b=b+"<li><div class='row'><div class='col-md-9'><a class='first' style='padding-left: 10px;padding-top: 4px;' onClick='window.location.href=\""+a[c].listingURL+"\"'>","RENT"===a[c].productType?b+="RENT : ":"BUY"===a[c].productType?b+="BUY : ":"PG"===a[c].productType&&(b+="PG : "),"RENT"===a[c].productType?"APARTMENT"==a[c].propertyType?null!=a[c].type?b=a[c].type.indexOf(",")>0?b+a[c].type+", ":b+a[c].type.substring(a[c].type.length-1,a[c].type.length)+a[c].type.substring(0,a[c].type.length-1)+", ":b+="Any, ":"SHARED"==a[c].propertyType&&(b+="Shared, "):"BUY"===a[c].productType?null!=a[c].type?b=a[c].type.indexOf(",")>0?b+a[c].type+", ":b+a[c].type.substring(a[c].type.length-1,a[c].type.length)+a[c].type.substring(0,a[c].type.length-1)+", ":b+="Any, ":a[c].productType,a[c].locality&&(b=a[c].locality.indexOf(",")>0?b+a[c].locality.substring(0,a[c].locality.indexOf(","))+", ":b+a[c].locality+", "),0!=a[c].budget?b=b+"< Rs."+a[c].budget:b+="any budget",b=b+"</a></div><div class='col-md-3'><a class='pull-right second' href='#' onClick=unsubscribe('"+a[c].id+"')>Remove</a></div></div></li>";$("#SearchSavedDetail").html(b)}else $("#locationGoogle").css("paddingRight","0px"),$("#searchSaved").html(""),$("#SearchSavedDetail").toggle()},error:function(a){displayGenericError()}})}function saveLeadByRM(a,b,c){showLoading();var d="RM_LEAD",e="UNQUALIFIED_LEAD",f={entityId:c,customerId:b,leadType:d,state:e},g=$("#mapDOwner").attr("data-_nbfr");void 0!==g&&(f._nbfr=g),$.ajax({url:"/api/v1/admin/rm_tenant/addLeadFromSearchNoBroker",type:"PUT",data:f,success:function(b){if(hideLoading(),b&&b.data){existingPropertyIdsForRMDashboard.push(c),changeButtonId(a,c,"Lead Added"),displayAlerts("Lead added to User","success",3e3);var d={function:"addLeadFromSearchNoBroker",leadData:b.data};d=JSON.stringify(d),window.parent.postMessage(d,"*")}else b.message&&displayAlerts(b.message,"danger",5e3)},error:function(a){hideLoading(),a.message?displayAlerts(a.message,"danger",5e3):displayGenericError()}})}function loadCSSIfNotAlreadyLoadedForSomeReason(a){for(var b=document.styleSheets,c=0,d=b.length;c<d;c++)if(b[c].href==a)return;var e=document.createElement("link");e.rel="stylesheet",e.href=a,document.getElementsByTagName("head")[0].appendChild(e)}function applyTravelFilter(){var a=$("#travelTimeSlider")[0],b=Math.round(a.noUiSlider.get());$(".travelTimeFilter input[type=text]").val("Travel Time: "+b+"mins"),$("#travelTimeInput").dropdown("toggle");var c="Travel_Time_"+b;nbGA&&nbGA.logEvent("PropertyFilter",c,{}),doSearchAndUpdateResults()}function manageActivationDate(a){var b;if((b=$("#activationDateRM").val()?parseInt($("#activationDateRM").val()):0)>0&&b<100){var c=new Date;c.setDate(c.getDate()-b),a+="&activationDateRM="+c.getTime()+","+(new Date).getTime(),$("#activationDateRM").val(b)}else $("#activationDateRM").val(""),a=removeQueryParameter(a,"activationDateRM");return addDaysText(),a}function addDaysText(){$("#activationDateRM").val()?1==$("#activationDateRM").val()?$("#daysText").text(" day"):$("#daysText").text(" days"):""==$("#activationDateRM").val()&&$("#daysText").text("")}function activationDateIn(){return $("#activationDateRM").blur(),doSearchAndUpdateResults(),!1}function showPhoneVerificationPopup(a){nbGA&&nbGA.logEvent("DisguiseUserDialog","ChangePhoneNumber"),generateVerificationOtp(userInfo.phone),$("#phoneOwnerVerificationModal").data("phone",userInfo.phone),$("#phoneOwnerVerificationModal").data("fromPage",a),$("#phoneOwnerVerificationModal").modal()}function removeQueryParameter(a,b){var c=a.split("?");if(c.length>=2){for(var d=encodeURIComponent(b)+"=",e=c[1].split(/[&;]/g),f=e.length;f-- >0;)-1!==e[f].lastIndexOf(d,0)&&e.splice(f,1);return a=c[0]+"?"+e.join("&")}for(var d=encodeURIComponent(b)+"=",e=c[0].split(/[&;]/g),f=e.length;f-- >0;)-1!==e[f].lastIndexOf(d,0)&&e.splice(f,1);return a=e.join("&")}function invokeNRIInfoForm(){nbGA.logEvent("SignUp","NRI-open",{}),$("#nriInfoAskingModal").modal("show")}function sendDownloadApp(a,b){showLoading(),$.ajax({url:"/admin/sendAppSMS?userId="+a+"&pageName="+b,type:"POST",success:function(a){a?displayAlerts("Download App Link sent","success",3e3):displayAlerts("Somthing went wrong","danger",5e3),hideLoading()},error:function(a){displayGenericError(),hideLoading()}})}function displayUIImpressions(a,b,c){if(c){var d="#prop-"+b,e=$(d);if(e.length>0){var f=e.find(".noOfViews");f.length>0&&a&&(f.removeClass("hide"),f.text(a))}}}function askNotificationPermission(a){var b={PYP:"Want updates of activities on your property? Turn on notifications to get updates",PYR:"Don't miss out! Get alerts of properties matching your requirement",CHAT:"Turn on chat notifications",default:"Can't find what you are looking for? Turn on notifications to get updates",HOMEPAGE:"Thousands of properties are added daily. Turn on notifications to get updates."};"serviceWorker"in navigator&&"showNotification"in ServiceWorkerRegistration.prototype&&(console.log("Notifications are supported."),"denied"!==Notification.permission&&"PushManager"in window&&"granted"!==Notification.permission&&navigator.serviceWorker.ready.then(function(c){a&&a.flow&&""!=a.flow?($("#pushNotificationPermissionModalText").html(b[a.flow]),$("#subscribeNotification").attr("data-flow",a.flow)):$("#pushNotificationPermissionModalText").html(b.default),$("#pushNotificationPermissionModal").slideToggle()}))}function openTenantEnquiriesModal(a,b){$("#tenantEnquiryBtn").attr("disabled",!0),$("#tenantEnquiryBtn").text("Loading...!"),"resale"===b?$("#globalPopupId .modal-header").html("Buyer interested in your property"):$("#globalPopupId .modal-header").html("Tenants interested in your property"),$("#globalPopupId .modal-header").addClass("enqModalHeader"),$("#globalPopupSecondaryBtn").addClass("enqModalCloseBtn"),$("#globalPopupPrimaryBtn").hide(),$.ajax({url:"/api/v1/property/"+a+"/enquiries",type:"POST",success:function(a){drawEnquiriesTable(a,b)},error:function(a){$("#alertMessageBox .errMsg").text(a.responseText)}})}function drawEnquiriesTable(a,b){if(a.data.length>0){var c="";c+="<table id='tenantEnqTable' border='1'><thead><th>Name</th><th>Email</th><th>Phone Number</th><tbody>";var d="";for(i=0;i<a.data.length;i++)d+="<tr><td>"+a.data[i].tenant_name+"</td><td>"+a.data[i].tenant_email+"</td><td>"+a.data[i].tenant_phone+"</td></tr>";c+=d,c+="</tbody></table>"}else{var e="No tenant has shown interest in your property";"resale"===b&&(e="No buyer has shown interest in your property"),$("#globalPopupId .modal-header").html(e)}$("#globalPopupId .modal-body").html(c),$("#globalPopupId").modal("show"),$("#tenantEnquiryBtn").removeAttr("disabled"),"resale"===b?$("#tenantEnquiryBtn").text("Buyer Enquiries"):$("#tenantEnquiryBtn").text("Tenant Enquiries")}function showInfoPopup(){$("#welcomeInfo").modal("show")}function closeInfoPopup(){$("#closeInfoPopup").click()}function unsubscribe(a){showLoading(),$.ajax({url:"/ajax/requirement/unsubscribe",type:"POST",data:"reqId="+a,success:function(a){1==a&&(displayAlerts("Your requirement has been successfully unsubscribed","success",4e3),saveSearch()),hideLoading()},error:function(a){displayGenericError(),hideLoading()}})}function formatFullDate(a){var b="en-us",c=a.toLocaleString(b,{weekday:"short"}),d=a.toLocaleString(b,{month:"short"}),e=a.toLocaleString(b,{year:"numeric"});return c+", "+a.toLocaleString(b,{day:"numeric"})+" "+d+" "+e}function pnmPostHandler(){console.log("pcakers movers complete"),window.location.reload()}function raCreatePostHandler(){console.log("Rental agreement complete");var a=getAgreementJSON(!1),b={};createAgreementFromNewFlow(a,b)}function postSignUpHandler(){"true"!=$("#isULIN").val()&&window.location.reload()}function handleSignOut(){nbGA.createCookie("whatsappOptAlert","true",-1),!loggedInUserisAdmin&&Moengage&&Moengage.destroy_session(),navigator.credentials&&navigator.credentials.preventSilentAccess&&navigator.credentials.preventSilentAccess(),fetchCurrentCallStatus(),signoutTimer=setTimeout(function(){nbSignOut(),nbAdobeEvents&&nbAdobeEvents.registerEvent({pageName:$("#pageNameForAdobe").val()?$("#pageNameForAdobe").val():"notfound",platform:"NB-Web",flowName:"registration_journey"},"cta_Click",{isLoggedIn:"not-loggedin"},{eventName:"Call-to-action click",eventType:"Button Click",ctaName:"signout"})},3e3)}function nbSignOut(){window.location.href="/signout"}function fetchCurrentCallStatus(){var a={};a.requestType="currentUserState",postMessageToIframe(a)}function postMessageToIframe(a){if(null==a||void 0==a||""==a){console.log("NULL_MESSAGE_PASSED",a)}else{var b="slashCallingScreen";if(null!=document.getElementById(b))document.getElementById(b).contentWindow.postMessage(a,document.getElementById(b).src);else{console.log("IFRAME_NOT_DEFINE",a)}}}function showErrorBeforeSignout(){$("#slashRtcMsgModal #msgModalText").html("Please wait till your call is finished before you signout!"),$("#slashRtcMsgModal").modal("show")}function makeUserOffline(){var a={};a.requestType="externalOffline",postMessageToIframe(a)}function makeUserOnline(){var a={};a.requestType="externalOnline",postMessageToIframe(a)}function makeUserLogout(){var a={};a.requestType="externalLogout",postMessageToIframe(a)}function checkSimplEligibility(){$.ajax({url:"/api/v1/simpl/checkEligibilityAsync",method:"GET",success:function(a){200==a.status&&console.log(a)},error:function(a){hideLoading()}})}function validateIndianPhoneNumberOnly(a,b){var c=a.length;if(0===a.toString().indexOf("+"+b.dialCode)&&(c=a.length-b.dialCode.length-1),91==b.dialCode){if(!/^[0-9]{10}$/.test(a.replace("+91","")))return!1}else if(c<4&&c>0)return!1;return!0}function closeAbuseReportModal(){$("#report-abuse-mobile").modal("hide")}function clearMsg(){$(".errorMsgText, .successMsgText, #errorMobile, .suggestionText").text("")}function postRequirementRMDashboardWithPromise(a,b,c,d){return new Promise(function(e,f){setTimeout(hideRequirementPopup,100),a.includes("AP")&&(a=a.replace(new RegExp("\\bAP\\b"),"APARTMENT")),a.includes("SHARED")&&(a+="&propType=SHARED"),$.ajax({url:"/api/v1/requirement/subscribe",type:"POST",data:a,"ga-log":"event","ga-category":"Requirement","ga-action":"submit",success:function(a){var f=b||$("#loggedInUserEmail").val();if(c||pingLogin(),d?displayAlerts(d,"warning",8e3):displayAlerts("Your requirement has been successfully captured, properties matching your requirement will be sent to "+f,"success",8e3),window.location.href.includes("rmCustomer")){var g={function:"saveCommentRequirement"};g=JSON.stringify(g),window.parent.postMessage(g,"*")}e()},error:function(a){!1===c&&$("#alertReqPopup").modal("hide"),a.responseText?displayAlerts(a.responseText,"success",3e3):displayGenericError()}})})}function getUserWallet(){"true"===getCookie("enableWallet")&&($("#nav-wallet").removeClass("hide"),$.ajax({url:"/api/v1/wallet",type:"GET",success:function(a){if(a&&200===a.status&&200===a.statusCode){var b=a.data&&a.data.balance?Math.floor(a.data.balance):0,c=b?"&#8377;"+b.toString():"New";$("#wallet-bal-header").html(c)}},error:function(a){}}))}function getOwnerDetailAdobeEvent(a,b,c){var d=b.includes("detail")?"detailpage":"listpage";a.contactStatus=nbAdobeService.getContactStatusForAdobe(c);var e=digitalData.userInfo,f={userType:e.userType,isLoggedIn:e.loginStatus,phone:e.phoneNum,name:e.name,email:e.emailid,userID:e.userID};nbAdobeEvents.registerEvent({pageName:d,platform:"nb-web",siteSection:d+"_contactowner",flowName:"search_journey",service:nbAdobeService.getServiceName($("#nbpt").val())},"get_Owner_Details",f,{eventName:"contact owner",eventType:"button click",ctaName:"get owner detail",ctaURL:""},null,null,a)}function checkIsPlanPage(){var a=window.location.href.split("/");return!!(a.pop()||a.pop()).match(/^plans/g)}function setPlanDetailsForAdobeEvent(a){var b="planpage_direct",c="plan_popup";return checkIsPlanPage()?(b="planpage_direct",c="planpage"):(c="plan_popup",b="contactowner"),{service:nbAdobeService.getServiceName(a),planType:nbAdobeService.getPlanType(a),page:b,pageName:c}}function onSubscribePlanAdobeEvent(a,b,c){var d="subscribe_Plan",e="subscribe",f="plan_subscribe";"upgrade"===c&&(d="upgrade_plan",e="upgrade",f="plan_upgrade");var g=a&&a.toLowerCase(),h=setPlanDetailsForAdobeEvent(b);nbAdobeEvents.registerEvent({pageName:h.pageName,platform:"nb-web",siteSection:h.page,flowName:"plan_flow",service:h.service},d,getuserInfoForAdobeEvent(),{eventName:f,eventType:"button_click",ctaName:e},null,null,null,null,null,null,null,null,null,null,{planName:g,planType:h.planType})}function onLoadPlanPopupAdobeEvent(a){var b=setPlanDetailsForAdobeEvent(a);nbAdobeEvents.registerEvent({pageName:b.pageName,platform:"nb-web",siteSection:b.page,flowName:"plan_flow",service:b.service},"plan_Popup",getuserInfoForAdobeEvent(),null,null,null,null,null,null,null,null,null,null,null,{planType:b.planType})}function onLoadSuccessPlanPopupAdobeEvent(a){var b=setPlanDetailsForAdobeEvent(a),c=getUrlParameter("nbpay"),d="/api/v1/plan_payment/order/"+c;$.ajax({url:d,type:"GET",success:function(a){var d={planName:a.planId.toLowerCase(),amount:a.amount,status:a.status,transactionID:c,planType:b.planType};nbAdobeEvents.registerEvent({pageName:"plan_payment_confirmation",platform:"nb-web",siteSection:"planpage",flowName:"plan_flow",service:b.service},"payment_Confirmation",getuserInfoForAdobeEvent(),null,null,null,null,null,null,null,null,null,null,null,null,d)},error:function(a){console.log(a)}})}function onClosePlanPopupAdobeEvent(){var a=$("#pageNameForAdobe").val()?$("#pageNameForAdobe").val():"notfound";a.includes("detail");nbAdobeEvents.registerEvent({pageName:"plan_popup",platform:"nb-web",siteSection:"contactowner",flowName:"plan_flow",service:nbAdobeService.getServiceName($("#nbpt").val())},"close_plan_popup",getuserInfoForAdobeEvent(),{eventName:"plan_popup_close",eventType:"button_click",ctaName:"close"},null,null,null,null,null,null,null,null,null,null,{planType:nbAdobeService.getPlanType($("#nbpt").val())})}function getUrlParameter(a){var b,c,d=window.location.search.substring(1),e=d.split("&");for(c=e.length-1;c>-1;c--)if(b=e[c].split("="),b[0]===a)return void 0===b[1]||decodeURIComponent(b[1])}function shortlistPropertyAdobeEvent(a,b){var c=1==b?"detailpage":"listpage";nbAdobeEvents.registerEvent({pageName:1==b?"detailpage":"listpage",platform:"nb-web",siteSection:c+"_shortlist",flowName:"search_journey",service:nbAdobeService.getServiceName($("#nbpt").val())},"prop_Shortlist",getuserInfoForAdobeEvent(),{eventName:"shortlist",eventType:"button click",ctaName:"shortlist button"},null,null,a)}function setPropertyDataLocalStorage(a){null!=localStorage.getItem(a)&&localStorage.removeItem("propertyData"),localStorage.setItem("propertyData",JSON.stringify(a))}function addAdobePageLoadEvent(){var a=[];homepage_selected_localities.forEach(function(b){a.push(b.placeName)});var b={results:$("#resultsCount").text(),searchLocality:a.join("|"),searchType:$("#nbpt").val().toLowerCase(),searchCitySelected:getCookie("nbcr")},c=null;try{"undefined"!=typeof window&&""!=window.location.search&&(c=window.location.search.split("&").splice(1).join("|"))}catch(a){}c=null==c?null:makeFilterForAdobeEvents(c);var d=$("#panel-map").hasClass("active");nbAdobeEvents.registerEvent({pageName:d?"mapview":"listpage",platform:"nb-web",siteSection:"search_"+$("#nbpt").val().toLowerCase(),flowName:"search_journey",service:nbAdobeService.getServiceName($("#nbpt").val())},"property_list",getuserInfoForAdobeEvent(),null,b,c)}function formatDate(a){var b=new Date(a),c=b.getDate(),d=b.getMonth()+1,e=b.getFullYear();return c<10&&(c="0"+c),d<10&&(d="0"+d),c+"-"+d+"-"+e}function getSiteSection(){var a=localStorage.getItem("fromPageAdobeEvent");return a||(a="postproprty_direct"),a}function onLoadPYPAdobeEvent(){var a=nbAdobeService.getServiceName($("#nbpt").val());nbAdobeEvents.registerEvent({pageName:"post_property_page ",platform:"nb-web",siteSection:getSiteSection(),flowName:"owner_journey",service:a},null,getuserInfoForAdobeEvent())}function onSaveAndContinuePYPAdobeEvents(a){a.sharedAccomodation="SHARED_ROOM"===a.isSharedProperty||null;var b=getAdobeDataPYP(a);nbAdobeEvents.registerEvent({pageName:"post_property_page",platform:"nb-web",siteSection:getSiteSection(),flowName:"owner_journey",service:nbAdobeService.getServiceName(a.adType)},"save_continue",getuserInfoForAdobeEvent(),{eventName:"prop_creation_save",eventType:"button_click",ctaName:a.cta?a.cta:"Save & Continue"},null,null,null,null,null,null,null,null,null,null,null,null,{propertycity:a.propertycity,adType:b.adType})}function onPostPropertyConfirmPYPAdobeEvents(a){var b=getAdobeDataPYP(a);a.adType=b.adType,a.agent="self",a.creationDate=formatDate(a.creationDate),a.propType=b.propType,a.propertyBHK&&(a.propertyBHK=a.propertyBHK.replace(/ /g,"").toLowerCase()),nbAdobeEvents.registerEvent({pageName:"post_property_confirmation_page",platform:"nb-web",siteSection:getSiteSection(),flowName:"owner_journey",service:nbAdobeService.getServiceName(a.adType)},"ad_posted",getuserInfoForAdobeEvent(),null,null,null,null,null,null,null,null,null,null,null,null,null,a)}function onEditPYPAdobeEvent(a){var b=getAdobeDataPYP(a);nbAdobeEvents.registerEvent({pageName:"post_property_page",platform:"nb-web",siteSection:getSiteSection(),flowName:"owner_journey",service:nbAdobeService.getServiceName(a.adType)},"edit_ad",getuserInfoForAdobeEvent(),{eventName:"edit_ad",eventType:"button_click",ctaName:"edit"},null,null,null,null,null,null,null,null,null,null,null,null,{propertycity:a.propertycity,adType:b.adType,agent:"self",creationDate:formatDate(a.creationDate),propType:b.propType,propertyId:a.propertyId})}function onStartPostingPYPAdobeEvents(a){var b=getAdobeDataPYP(a);nbAdobeEvents.registerEvent({pageName:"post_property_page ",platform:"nb-web",siteSection:getSiteSection(),flowName:"owner_journey",service:nbAdobeService.getServiceName(a.adType)},"start_posting",getuserInfoForAdobeEvent(),{eventName:"new_property_creation",eventType:"button_click",ctaName:"Start Posting Your Ad For FREE"},null,null,null,null,null,null,null,null,null,null,null,null,{propType:b.propType,adType:b.adType,agent:"self",creationDate:formatDate(new Date)})}function onLoadPYPAdListingAdobeEvent(a,b){var c="post_property_details";"1"==b?c="post_property_locality_details":"2"==b?c="post_property_rental_details":"3"==b?c="post_property_images":"4"==b?c="post_property_amenities":"5"==b&&(c="post_property_schedule"),nbAdobeEvents.registerEvent({pageName:c,platform:"nb-web",siteSection:getSiteSection(),flowName:"owner_journey",service:nbAdobeService.getServiceName(a)},"post_details",getuserInfoForAdobeEvent())}function makeFilterForAdobeEvents(a){var b=convertStringToobjAdobeEvent(a);return getPipeSeperatedStringFromObject(nbAdobeService.makeFilterForAdobeEvents(b))}function convertStringToobjAdobeEvent(a){var b=a?a.split("|"):[],c={};return b.forEach(function(a){var b=a.split("=");c[b[0]]=b[1]}),c}function getPipeSeperatedStringFromObject(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c+"="+a[c]);return b.join("|")}var WhatsAppOpt="NA",loggedInUserisAdmin,propertyDataForAdobe=null,resultTags={tags:{budget:"Super Deal",commute:"Easy Commute",lifestyle:"Better Living",top_society:"Top Society",exclusive:"Exclusive Deal"},tooltips:{budget:"Super Deal",commute:"Easy Commute",lifestyle:"Better Living",top_society:"Top Society",exclusive:"Exclusive Deal"}};$("#nearByFilter").on("change",function(){$("#nearByFilter").is(":checked")&&nbGA.logEvent("PropertyFilter","IncludeNearby",{})}),$(".transit-info").on("click",function(){nbGA.logEvent("NearbyMap","clickTransit-"+$("#nbpt").val().toLowerCase(),{})}),$("#similarPropertyContent").on("click",function(){nbGA.logEvent("DetailPage","clickSimilarProperty-"+$("#nbpt").val().toLowerCase(),{})}),$(".moreProperties").click(function(){nbGA.logEvent("DetailPage","clickMorePropert-"+$("#nbpt").val().toLowerCase(),{})}),$(".listAlertsCard").click(function(){nbGA.logEvent("listPlanCard","getAlerts",{})}),$(".passwordGroup .togglePassword").on("click",function(a){a.stopPropagation(),$(a.target).hasClass("icon-eye-close")?$(a.target).siblings("input").attr("type","password"):$(a.target).siblings("input").attr("type","text"),$(a.target).toggleClass("icon-eye-close")}),$("#commercialPlanTab").on("click",function(){$("#commercial-menu-list").hasClass("hide")?($("#commercial-menu-list").removeClass("hide"),$("#commercialPlanTab i").addClass("icon-angle-up"),$("#commercialPlanTab i").removeClass("icon-angle-down")):($("#commercial-menu-list").addClass("hide"),$("#commercialPlanTab i").addClass("icon-angle-down"),$("#commercialPlanTab i").removeClass("icon-angle-up"))}),$(document).ready(function(){updatePremiumFilterCount(),updateDefaultFilterCount(),"undefined"!=typeof BuyerPlanModule&&BuyerPlanModule.onBuyerPageLoad(),$("#alertMessageBox").on("click","#updateEmail",function(a){a.stopPropagation(),showUpdateEmailPopup()}),$("#alertMessageBox").on("click","#updateLater",function(a){a.stopPropagation(),nbGA.logEvent("SignUp","InvalidEmail-later",{}),$("#alertMessageBox").removeClass("noHide"),hideAlert()}),getUserWallet(),window.localStorage&&localStorage.getItem("openAlerts")&&("undefined"!=typeof alertsPyr&&"true"==$("#isULIN").val()&&(vent.trigger("showAlerts"),alertsPyr.postAlerts(JSON.parse(localStorage.getItem("alertsObj"))),$(document).find("[data-action='getPropAlerts']").trigger("click")),localStorage.removeItem("openAlerts"),localStorage.removeItem("alertsObj")),$("#alertMessageBox").on("click","#saveEmailId",function(a){$("#alertMessageBox .errMsg").text(""),a.stopPropagation();var b=$("#alertMessageBox form")[0],c=$("#loggedInUserPhone").val(),d={};d.phone=c,isFormValid(b)?(d.email=$(b).find("[type=email]").val(),d.email==$("#loggedInUserEmail").val()?$("#alertMessageBox .errMsg").text("Please enter an email other than "+$("#loggedInUserEmail").val()):$.ajax({url:"/api/v1/account/update/email",type:"POST",data:d,success:function(a){a.updated&&(nbGA.logEvent("SignUp","InvalidEmail-update",{}),$("#alertMessageBox").removeClass("noHide"),hideAlert(),displayAlerts("<span>Email successfully updated</span>","success",6e3))},error:function(a){$("#alertMessageBox .errMsg").text(a.responseText)}})):$("#alertMessageBox .errMsg").text("Please enter a valid email.")}),$("#userProfileTab").on("mouseover",function(){$("#menuDropdown").is(":hidden")&&showUserProfile()}),$("#userProfileTab").on("mouseout",function(){$("#myProfileDropdown").hide(),$(".userProfileArrow").removeClass("icon-angle-up"),$(".userProfileArrow").addClass("icon-angle-down")}),/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)||(setUnselectRadioByName("bathroom"),setUnselectRadioByName("isSharedAccomodation"),setUnselectRadioByName("propertyAge")),$(".open_detail_page").click(function(a){var b=$(a.target).hasClass("open_detail_page")?$(a.target):$(a.target).parents(".open_detail_page");gotoDetail(b.data("url"),b.data("id"))}),$(document).on("click",".close-tc",function(){$("#terms_assure_plan").modal("hide")}),$("#terms_assure_plan").on("show.bs.modal",function(){$("#newPaymentModal .dim-modal").removeClass("hide")}),$("#terms_assure_plan").on("hide.bs.modal",function(){$("#newPaymentModal .dim-modal").addClass("hide")});var a=$("#travelTimeSlider")[0];if(a&&a.noUiSlider&&(a.noUiSlider.on("update",function(){var b=Math.round(a.noUiSlider.get());$("#travelMinutes").val(b),$(".travelTimeFilter input[type=text]").val("Travel Time: "+b+"mins")}),$(".travelTimeDropdownContainer").on("click",function(a){a.stopPropagation()})),$(".travelTimeBtn").popover(),$("#closeSideMenu").on("click",function(){hideMenuDropDown()}),"true"==getCookie("X-SOCIAL-USER-NO-EMAIL")){$("#socialSignInError").removeClass("hide"),$("#loginPopUpTitle").addClass("hide");var b=getCookie("X-SOCIAL-USER-PHONE");$("#contactNumber").val(b),$("#userVerificationModal").modal("show"),setCookie("X-SOCIAL-USER-NO-EMAIL","",-1)}startPostMessageListenerForRMDashboard(),startPostMessageListenerForChatMessage(),loggedInUserisAdmin||$.get("/api/v1/whatsapp/opt/status",function(a){WhatsAppOpt="TRUE"==a.data.status||"NA",1==WhatsAppOpt?($("#WhatsAppOptProfile,#WhatsAppOpt").prop("checked",!0),$(".pay-rent-whatsapp-opt").addClass("hide")):$(".pay-rent-whatsapp-opt").removeClass("hide");try{setCookie("userWhatsAppOptIn",WhatsAppOpt)}catch(a){}$(document).on("change","#WhatsAppOptSignup,#WhatsAppOptPyp",function(a){WhatsAppOpt=$(a.target).prop("checked")}),$(function(){setTimeout(function(){try{"true"==getCookie("userWhatsAppOptIn")?$(".pay-rent-whatsapp-opt").addClass("hide"):$(".pay-rent-whatsapp-opt").removeClass("hide")}catch(a){}},1e3)}),1==WhatsAppOpt&&$(".whatsapp-opt-wrapper,.whatsapp-opt-wrapper-pyp").addClass("hide"),"NA"==WhatsAppOpt&&(nbGA.readCookie("whatsappOptAlert")||setTimeout(function(){"NA"==WhatsAppOpt&&$("#whatsAppOptCard").addClass("no-hide")},2e3),$(".whatsapp-opt-wrapper,.whatsapp-opt-wrapper-pyp").removeClass("hide"))}),$("#pickedProductType").length>0&&("Commercial-Rent"==$("#pickedProductType").text()?$("#rplanName").text("Commercial Relax Plan"):"Commercial-Buy"==$("#pickedProductType").text()&&$("#rplanName").text("Commercial Power Plan"))}),$(document).on("change","#WhatsAppOpt,#WhatsAppOptFloat",function(a){var b;$('[id="WhatsAppOpt"]').each(function(a){$($('[id="WhatsAppOpt"]')[a]).prop("checked")&&(b=$($('[id="WhatsAppOpt"]')[a]).data("pagename"),WhatsAppOpt=!0)}),WhatsAppOpt?(whatsappOtpPost(WhatsAppOpt,$("#WhatsAppOpt").attr("data-source")),setTimeout(function(){$(".whatsapp-opt-wrapper").addClass("success")},500),setTimeout(function(){$(".whatsapp-opt-wrapper").addClass("hide")},1200),setTimeout(function(){$("#whatsAppOptCard").removeClass("no-hide")},1e3)):($(".whatsapp-opt-wrapper,.whatsapp-opt-wrapper-pyp").removeClass("hide"),$("#whatsAppOptCard").addClass("no-hide"),WhatsAppOpt=!1)}),$(document).on("change","#WhatsAppOptProfile",function(a){WhatsAppOpt=$("#WhatsAppOptProfile").prop("checked"),whatsappOtpPost(WhatsAppOpt,$("#WhatsAppOptProfile").attr("data-source"))}),$(document).on("click","#WhatsAppOptNeverShow",function(a){nbGA.createCookie("whatsappOptAlert","no-show",1),setTimeout(function(){$("#whatsAppOptCard").removeClass("no-hide")},200)}),$(document).on("change","#WhatsAppOptAdmin",function(a){var b={};b.toggle=$(a.target).prop("checked"),b.userId=a.target.dataset.userid,b.source=a.target.dataset.source,""!=a.target.dataset.phone&&(b.phone=a.target.dataset.phone),whatsappOtpPostAdmin(b)}),$("#contactUsTab").on("click",function(){$("#contactUsDropdown").is(":visible")?($("#contactUsDropdown").hide(),$("#contactUsTabList").addClass("animated"),$("#contactUsTabList").removeClass("padding-top-bottom-0"),$(".contactUsArrow").addClass("icon-angle-down"),$(".contactUsArrow").removeClass("icon-angle-up")):$("#contactUsDropdown").is(":hidden")&&($("#contactUsDropdown").show(),$("#contactUsTabList").removeClass("animated"),$("#contactUsTabList").addClass("padding-top-bottom-0"),$(".contactUsArrow").addClass("icon-angle-up"),$(".contactUsArrow").removeClass("icon-angle-down"))}),$("#myDashboardTab").on("click",function(){$("#myDashboardDropdown").is(":visible")?($("#myDashboardDropdown").hide(),$("#myDashboardArrow").addClass("icon-angle-down"),$("#myDashboardArrow").removeClass("icon-angle-up"),$("#myDashboardTabList").removeClass("border-bottom-none")):$("#myDashboardDropdown").is(":hidden")&&showMyDashBoardTab()}),$("#myPlansTab").on("click",function(){$("#myPlansDropdown").is(":visible")?($("#myPlansDropdown").hide(),$("#myPlansArrow").addClass("icon-angle-down"),$("#myPlansArrow").removeClass("icon-angle-up"),$("#myPlansTabList").removeClass("border-bottom-none")):$("#myPlansDropdown").is(":hidden")&&showMyPlansTab()}),$("#myListingsTab").on("click",function(){$("#myListingsDropdown").is(":visible")?($("#myListingsDropdown").hide(),$("#myListingsArrow").addClass("icon-angle-down"),$("#myListingsArrow").removeClass("icon-angle-up"),$("#myListingsTabList").removeClass("border-bottom-none")):$("#myListingsDropdown").is(":hidden")&&showMyListingsTab()}),$("#myCommercialPlansTab").on("click",function(){$("#myCommercialPlansDropdown").is(":visible")?($("#myCommercialPlansDropdown").hide(),$("#myCommercialPlansArrow").addClass("icon-angle-down"),$("#myCommercialPlansArrow").removeClass("icon-angle-up"),$("#myCommercialPlansTabList").removeClass("border-bottom-none")):$("#myCommercialPlansDropdown").is(":hidden")&&showMyCommercialPlansTab()}),$(document).on("click","body",function(a){0===$(a.target).closest("#menuDropdown").length&&0===$(a.target).closest("#menuTab").length&&$("#menuDropdown").is(":visible")&&hideMenuDropDown(),0===$(a.target).closest("#homeSearchFilter").length&&0===$(a.target).closest(".nb-productType-switch").length&&0===$(a.target).closest(".nb-search").length&&$("#homeSearchFilter").is(":visible")&&$("#homeSearchFilter").slideToggle(),1===$(a.target).closest("#userProfileTab").length&&showUserProfile()}),$(window).scroll(function(a){hideMenuDropDown()});var zopimUrls={noPlan:"http://nobroker.in/dummy/plan/chat/noPlan",basicActive:"http://nobroker.in/dummy/plan/chat/basicActive",basicExpired:"http://nobroker.in/dummy/plan/chat/basicExpired",buyerExpired:"http://nobroker.in/dummy/plan/chat/buyerExpired",sellerExpired:"http://nobroker.in/dummy/plan/chat/sellerExpired",freedom:"http://nobroker.in/dummy/plan/chat/freedom",rentDetailPage:"http://nobroker.in/dummy/plan/rentDetailPage/chat",premiumFilterZopim:"http://nobroker.in/dummy/chat/premiumFilter",tenantCommercialContactExpired:"http://nobroker.in/dummy/chat/tenantCommercialContactExpired",buyerCommercialContactExpired:"http://nobroker.in/dummy/chat/buyerCommercialContactExpired",commercialTenantPlans:"http://nobroker.in/dummy/chat/CommercialTenantPlans",commercialOwnerPlans:"http://nobroker.in/dummy/chat/CommercialOwnerPlans",commercialBuyerPlans:"http://nobroker.in/dummy/chat/CommercialBuyerPlans",commercialSellerPlans:"http://nobroker.in/dummy/chat/CommercialSellerPlans",builderPage:"http://nobroker.in/dummy/chat/builderPage",builderPopup:"http://nobroker.in/dummy/chat/builderPopup",ownerDetails:"http://nobroker.in/dummy/chat/ownerDetails",shortlist:"http://nobroker.in/dummy/chat/shortlist",resaleDetailsPage:"http://nobroker.in/dummy/plan/resaleDetailsPage/chat",commercialListDetailPages:"http://nobroker.in/dummy/chat/commercialListDetailPages"},shortlistPostHandler=function(){"true"!=$("#isULIN").val()&&$("#isULIN").val("true"),toggleShortlist(getCookie("propId"),getCookie("buttonId"),getCookie("detailPage"))};$(".nbCheckbox").change(function(a){($(this).parent().hasClass("premiumFilterPanel")||$(this).hasClass("premiumFilterPanel"))&&"no"==$("#premiumFilterEnabled").val()||(updateFilterCount(),doSearchAndUpdateResults())}),$(".nbRadio").change(function(a){updateFilterCount(),$(a.target).attr("checked","checked"),/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)||setUnselectRadioByName($(a.target).attr("name"));$(this).parent().hasClass("premiumFilterPanel")||$(this).hasClass("premiumFilterPanel");doSearchAndUpdateResults(),gaLogging&&$(a.target).parents('div [data-ga-log-child="radio"]').length>0&&gaLogging.logRadioEvents.call($(a.target))}),$(".dropdown-menu-price li a, .order_by_rank_dropdown li a ").click(function(){var a=$(this).data(),b=a.type;$("#"+b).data(a),$("#"+b).val(a.display),doSearchAndUpdateResults()}),$("#listResults").on("click",".order_by_rank_dropdown li a",function(a){var b=$(this).data(),c=b.type;$("#"+c).data(b),$("#"+c).val(b.display),doSearchAndUpdateResults()});var contactOwnerPostHandler=function(){var a=getCookie("fromPage"),b=getCookie("propId"),c=!1;"undefined"!=typeof listPropertyArray&&null!=listPropertyArray&&(propertyDataForAdobe=listPropertyArray.find(function(a){return a.propertyID===b})),"true"==$("#contactOwnerBtn"+b).attr("data-sponsored")&&(c=!0);var d=getCookie("propertyRent");$("#isULIN").val("true"),"sponsoredPropertyDetail"==a?invokeContactOwnerCall(b,d,scheduleVisitModal.scheduleSponsoredPropertyCallback,a,c):"tenantSchedule"!=a?invokeContactOwnerCall(b,d,"",a,c):invokeContactOwnerCall(b,d,function(){bookTenantAppointment()},a,c),userRegistrationModalHelper.clearPropIdCookie()},triggerChat=function(){if(getCookie("triggerChatOnLoad")&&"true"===getCookie("triggerChatOnLoad")){var a=$("#propId").val();setCookie("triggerChatOnLoad",!1,"-1"),$("#sendMessageBtn"+a).length>0&&$("#sendMessageBtn"+a).click()}},chatPostHandler=function(){setCookie("triggerChatOnLoad",!0),window.location.reload()},hiddenRows=[],feedbacks={};$(".map-list-switch a").click(function(a){var b=$(a.target);b.hasClass("selected")||($("#mapDOwner").removeAttr("data-_nbfr"),"listView"==b.attr("id")?(b.addClass("selected"),$("#seoFooter").removeClass("hide"),$(".map-list-switch #mapView").removeClass("selected")):"mapView"==b.attr("id")&&(b.addClass("selected"),$("#seoFooter").addClass("hide"),$(".map-list-switch #listView").removeClass("selected")))}),$("#showHideFilterPanelOnMapView").click(function(){$("#showHideFilterPanelOnMapView i").hasClass("icon-angle-left")?($("#searchBinHolder").hide(),$("#showHideFilterPanelOnMapView i").removeClass("icon-angle-left"),$("#showHideFilterPanelOnMapView i").addClass("icon-angle-right"),$("#showHideFilterPanelOnMapView").css("left","0px"),$("#map-canvas").css("width","100%"),$("#map-canvas").css("left","0%")):($("#searchBinHolder").show(),$("#showHideFilterPanelOnMapView i").removeClass("icon-angle-right"),$("#showHideFilterPanelOnMapView i").addClass("icon-angle-left"),$("#showHideFilterPanelOnMapView").css("left","20%"),$("#map-canvas").css("width","80%"),$("#map-canvas").css("left","20%")),map.init("#map-canvas",map.currentPosition),map.reset(),doSearchAndUpdateResults()});var isOwnerPlanActive=!1,isOwnerPlan=!1,isOwnerPaymentShowSuccess=!1,isPlanActive=!1;$(document).on("click",".closeModalIcon,.closePaymentButton",function(){""==$("#loggedInUserId").val()&&$(".sponsoredContactBtn").length>0&&location.reload()}),$(document).on("click",".showBasicPlan",function(a){a.preventDefault(),$("#basicPlanModal").modal("show")}),$(document).on("click","#planRAanchor",function(a){return gaLogging.logEventWithProductType("PlanRentalAgreement","Click",{}),!0}),$(document).on("click",".postRequirementButton",function(a){$("#paymentSuccessModal").modal("hide"),$("#newPaymentModal").modal("hide"),launchNewReqPopup("RENT")}),$(document).on("click","#closePaymentModal",function(a){$("#paymentSuccessModal").modal("hide")}),$("#paymentModal").on("hidden.bs.modal",function(a){return!0}),$("#paymentModal").on("shown.bs.modal",function(a){return $("#paymentModal").find(".basicPlan").find(".planImage").addClass("basicPlanImage"),$("#paymentModal").find(".freedomPlan").find(".planImage").addClass("freedomPlanImage"),$("#paymentModal").find(".relaxPlan").find(".planImage").addClass("relaxPlanImage"),!0}),$("#paymentSuccessModal").on("shown.bs.modal",function(a){return $("#paymentSuccessModal").find(".basicPlan").find(".planImage").addClass("basicPlanImage"),$("#paymentSuccessModal").find(".freedomPlan").find(".planImage").addClass("freedomPlanImage"),$("#paymentSuccessModal").find(".relaxPlan").find(".planImage").addClass("relaxPlanImage"),!0}),$("#paymentSuccessModal").on("hide.bs.modal",function(){"false"==$("#isULIN").val()&&window.location.reload()}),$("#basicPlanModal").on("shown.bs.modal",function(a){var b={};return gaLogging.logEventWithProductType("ChoosePlan","basicPlan_newModal",b),$("#basicPlanModal").find(".planImage").addClass("basicPlanImage"),!0}),$(document).on("click","#newPaymentModal .closePaymentButton",function(a){"false"!=$("#newPaymentModal").attr("data-showBasic")?($("#newPaymentModal .dim-modal").removeClass("hide"),$("#basicPlanModal").modal("show"),nbGA.logEvent("ChoosePlan","basicPlan_close",{}),$("#newPaymentModal").attr("data-showBasic","false"),sendClickEvent("BasicPlanShown","shownOnClose")):$("#newPaymentModal").modal("hide"),self.onClosePlanPopupAdobeEvent()}),$(document).on("click","#commercialPaymentModal .closePaymentButton",function(a){$("#commercialPaymentModal").modal("hide")}),$(document).on("click",".purchasePlanButton",function(a){$("#basicPlanModal").modal("hide"),$("#newPaymentModal .dim-modal").addClass("hide"),gaLogging.logEventWithProductType("ChoosePlan","closeSecondPopup",{})});var dateFormater=function(a,b){var c=new Date(a),d=c.getDate();d<=9&&(d="0"+d);var e=c.getMonth()+1;e<=9&&(e="0"+e);var f=c.getUTCFullYear();return b?f+"-"+e+"-"+d:d+"/"+e+"/"+f};$(document).on("click",".gotoLink",function(a){var b=a.target,c=$(b).closest(".gotoLink").attr("data-value");c&&window.open(c,"_blank")}),String.format=function(){for(var a=arguments[0],b=1;b<arguments.length;b++){var c=new RegExp("\\{"+(b-1)+"\\}","gm");a=a.replace(c,arguments[b])}return a},String.format=function(){for(var a=arguments[0],b=1;b<arguments.length;b++){var c=new RegExp("\\{"+(b-1)+"\\}","gm");a=a.replace(c,arguments[b])}return a},$("#commingSoonSignUp").on("click",function(){var a={};a.flow="default",userRegistrationModalHelper.registerFlow("default",a,null,postSignUpHandler)}),window.slashRtcLogin=!0;var signoutTimer=null;window.slashRtcOffline=!1;var forcedLogoutStates=["pause","ready","preview","callback","listview"],directLogoutStates=["stop","logout"],noLogoutStates=["call","dispose","transferStart","transferTalk","transferAgent","transferCancel","transferPatch","conferenceStart","conferenceTalk","conferenceAgent","conferenceCancel","conferencePatch","hold","mute","redial"];window.addEventListener("message",function(a){if(a&&a.data.eventInfo){var b=a.data.eventInfo.type||!1,c=a.data.eventInfo.logInfo||!1;if(0!=b){if("CURRENT_USER_STATE"==b){if(noLogoutStates.indexOf(c)>-1)return showErrorBeforeSignout(),void clearTimeout(signoutTimer);forcedLogoutStates.indexOf(c)>-1?(window.slashRtcOffline=!0,makeUserOffline()):directLogoutStates.indexOf(c)>-1?makeUserLogout():nbSignOut()}"userOffline"==b&&window.slashRtcOffline&&makeUserLogout(),"userLoggedOut"==b&&window.slashRtcOffline&&nbSignOut()}}},!1),$(document).on("click","#signOutMenu",handleSignOut),$(document).on("click",".planExp",function(){$(this).hasClass("icon-minus-sign-alt")?($(this).addClass("icon-plus-sign-alt"),$(this).removeClass("icon-minus-sign-alt"),$(this).children(".planElem").addClass("hide")):($(this).addClass("icon-minus-sign-alt"),$(this).removeClass("icon-plus-sign-alt"),$(this).children(".planElem").removeClass("hide"));var a="#FFFFFF";$(this).children(".planElem").each(function(){"#FFFFFF"==a?($(this).css("background-color","#FFFFFF"),a=""):a="#FFFFFF"})}),$(document).mouseleave(function(){var a=!1;try{a="true"===localStorage.isIncognito}catch(a){}if(!a&&"modal"!=$("#newPaymentModal  .closePaymentButton").attr("data-dismiss")&&$("#newPaymentModal").hasClass("in")&&$(".planCard.basicPlan").length>0){$("#newPaymentModal .dim-modal").removeClass("hide"),$("#basicPlanModal").modal("show");var b={type:"BasicPlanShown",nbFr:"shownOnTabClose"};$.ajax({url:"/createEvent",method:"POST",data:b}),nbGA.logEvent("ChoosePlan","basicPlan_push",{})}}),checkIfIncognito=function(){return new Promise(function(a){var b=function(){return a(!0)},c=function(){return a(!1)},d=function(){try{localStorage.length?c():(localStorage.x=1,localStorage.removeItem("x"),c())}catch(a){navigator.cookieEnabled?b():c()}};if("MozAppearance"in document.documentElement.style){if(null===indexedDB)return b();var e=indexedDB.open("test");return e.onerror=b,void(e.onsuccess=c)}var f=window.webkitRequestFileSystem||window.RequestFileSystem;if(f&&"storage"in navigator&&"estimate"in navigator.storage&&navigator.storage.estimate().then(function(a){a.quota<12e7&&b()}).catch(function(){c()}),f)return void f(window.TEMPORARY,100,c,b);var g=navigator.userAgent.match(/Version\/([0-9\._]+).*Safari/);if(g){var h=parseInt(g[1],10);if(h>=11)try{return window.openDatabase(null,null,null,null),c()}catch(a){return b()}else if(h<11)return d()}return window.indexedDB||!window.PointerEvent&&!window.MSPointerEvent?c():b()})},checkIfIncognito().then(function(a){a&&localStorage.setItem("isIncognito",!0)}).catch(function(a){});var getLoggedInUserInfo=function(){return{phone:"false"==$("#loggedInUserPhone").val()?null:$("#loggedInUserPhone").val(),email:"false"==$("#loggedInUserEmail").val()?null:$("#loggedInUserEmail").val(),name:"false"==$("#loggedInUserName").val()?null:$("#loggedInUserName").val(),isLoggedIn:"false"==$("#isULIN").val()?"not-loggedin":"loggedin"}},getuserInfoForAdobeEvent=function(){var a=getLoggedInUserInfo();return{userType:"loggedin"===a.isLoggedIn?userRegistrationModalHelper.getCookie("loggedInUserStatus"):void 0,isLoggedIn:a.isLoggedIn,phone:a.phone,name:a.name,email:a.email,userID:localStorage.getItem("userId")}},getAdobeDataPYP=function(a){var b="rent",c="residential";return"COMMERCIAL_BUY"===a.adType?(b="resale",c="commercial"):"COMMERCIAL_RENT"===a.adType?(b="rent",c="commercial"):"BUY"===a.adType?b="resale":"RENT"===a.adType&&a.sharedAccomodation?b="flatmates":"RENT"===a.adType?b="rent":"PG"===a.adType&&(b="pg-hostel"),{adType:b,propType:c}},dateToShortFormat=function(a){var b=a.getDate(),c=a.getMonth(),d=a.getFullYear();return(b<=9?"0"+b:b)+"-"+(c<=9?"0"+c:c)+"-"+d},openAbuseReport=function(a){if("true"!=$("#isULIN").val()){var b={flow:"abuseReport"};userRegistrationModalHelper.registerFlow("abuseReport",b,null,a||function(){$("#new-report-abuse-list").modal("show")})}else a?a():$("#new-report-abuse-list").modal("show")};