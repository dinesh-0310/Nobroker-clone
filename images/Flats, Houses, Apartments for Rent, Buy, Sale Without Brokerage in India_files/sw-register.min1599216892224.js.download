"use strict";function subscribeNotifications(){"PYP"==$("#subscribeNotification").data("flow")?nbGA.logEvent("BrowserNotification","PYP-clicked",{}):"PYR"==$("#subscribeNotification").data("flow")?nbGA.logEvent("BrowserNotification","Requirement-clicked",{}):"CHAT"==$("#subscribeNotification").data("flow")?nbGA.logEvent("BrowserNotification","Chat-clicked",{}):"HOMEPAGE"==$("#subscribeNotification").data("flow")&&nbGA.logEvent("BrowserNotification","Homepage-clicked",{}),$("#pushNotificationPermissionModal").slideToggle(),Moengage.call_web_push()}function sendSubscriptionToServer(a){var b=a.getKey?a.getKey("p256dh"):"",c=a.getKey?a.getKey("auth"):"";$.post("/api/v1/device_info/web/messaging",{endpoint:a.endpoint,user_id:loggedinUserId,key:b?btoa(String.fromCharCode.apply(null,new Uint8Array(b))):"",auth:c?btoa(String.fromCharCode.apply(null,new Uint8Array(c))):""}).done(function(a){}).fail(function(a){displayAlerts("An error occured while subscribing you to notifications","danger",3e3)})}var reg,sub,isSubscribed=!1;$(document).ready(function(){!function(){"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(function(){return console.log("Service worker registered!"),navigator.serviceWorker.ready}).then(function(a){reg=a}).catch(function(a){console.log("Service worker error",a)})}(),$("#pushNotificationPermissionModal #subscribeNotification").on("click",subscribeNotifications),$("#pushNotificationPermissionModal .icon-remove").on("click",function(){$("#pushNotificationPermissionModal").slideToggle(),setCookie("pushNotiFy",!0,.0208333)})}),window.addEventListener("MOE_OPT_IN",function(a){"opt_in_allowed"===a.detail&&reg.pushManager.getSubscription().then(function(a){sub=a,isSubscribed=!0,displayAlerts("You will now receive alerts for latest properties matching your requirement.","success",4e3),sendSubscriptionToServer(sub)}).catch(function(a){displayAlerts(null!=a.message&&void 0!=a.message?a.message:"Permission Denied!","danger",3e3)})});