!function(a,b){"function"==typeof define&&define.amd?(window.userRegistrationModalConstant=require("userRegistrationModalConstant"),window.nbAdobeEvents=require("nbAdobeEvents"),window.nbAdobeService=require("nbAdobeService"),define(["userRegistrationModalHelper"],b)):a.userRegistrationModalHelper=b(a.options)}(window,function(options){var userRegistrationModalHelper={otp_sent:!1,update_otp_sent:!1,email_otp_sent:!1,countDownTimer:null,data_model:{},page:null,service:null,isNotEmpty:function(a){return void 0!==a&&null!=a},dumpModalDataToCookie:function(a){var b=this;b.isNotEmpty(a)&&b.setCookie("modalDataDump",JSON.stringify(a),.0035)},saveModalDataToCookie:function(a){var b=this;if(b.isNotEmpty(a))for(var c in a)b.isNotEmpty(c)&&b.isNotEmpty(a[c])&&b.setCookie(c,a[c],.0035)},processModalData:function(a){if(userRegistrationModalConstant[a.flow]){var b=userRegistrationModalConstant[a.flow];if("builderSignup"===a.flow){var c=[];c.push("Located at "+a.buildingData.shortLocality),"Not Available"!==a.buildingData.price&&c.push("Starting from "+a.buildingData.price),c.push("Visit for exclusive offers."),b.info.primaryText=a.buildingData.name,b.content.description=c,b.class="builder-section",b.info.backgroundImage="url('//images.nobroker.in/static/img/builder/"+a.buildingData.logo+"')"}else"rentalAgreement"==a.flow?"mumbai"===a.city.toLowerCase()||"pune"==a.city.toLowerCase()?(b.info.secondaryText[1]=b.info.secondaryText[1].replace("delivery","biometrics"),b.content.description[1]=b.content.description[1].replace("delivery","biometrics"),b.content.description[2]=b.content.description[2].replace("Hassle free process.","Delivery in your inbox.")):(b.info.secondaryText[1]=b.info.secondaryText[1].replace("biometrics","delivery"),b.content.description[1]=b.content.description[1].replace("biometrics","delivery"),b.content.description[2]=b.content.description[2].replace("Delivery in your inbox.","Hassle free process.")):"requestPhotos"==a.flow?"COMMERCIAL_BUY"===a.prop_type||"BUY"===a.prop_type?(b.info.secondaryText[0]=b.info.secondaryText[0].replace("owner","seller"),b.content.description[0]=b.content.description[0].replace("owner","seller")):(b.info.secondaryText[0]=b.info.secondaryText[0].replace("seller","owner"),b.content.description[0]=b.content.description[0].replace("seller","owner")):"plans"!=a.flow&&"commercial_Plans"!=a.flow&&"ownerPlans"!=a.flow&&"commercial_ownerPlans"!=a.flow&&"sellerPlans"!=a.flow&&"commercial_sellerPlans"!=a.flow&&"buyerPlans"!=a.flow&&"commercial_buyerPlans"!=a.flow||(a.planName=a.planName.trim(),b.info.primaryText=a.planName,"Freedom Plan"===a.planName||"Commercial Freedom Plan"===a.planName||"Power Plan"===a.planName||"Commercial Power Plan"===a.planName?(b.info.secondaryText[0]=b.info.secondaryText[0].replace("50","25"),b.content.description[0]=b.content.description[0].replace("50","25")):(b.info.secondaryText[0]=b.info.secondaryText[0].replace("25","50"),b.content.description[0]=b.content.description[0].replace("25","50")));userRegistrationModalConstant[a.flow]=b}},setCookie:function(a,b,c){var d=new Date;d.setTime(d.getTime()+24*c*60*60*1e3);var e="expires="+d.toUTCString();document.cookie=a+"="+b+"; "+e},getCookie:function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return""},preProcessFlow:function(a,b){var c=this;c.isNotEmpty(a)||(a="default"),c.prepareFlowConstants(a,b)},prepareFlowConstants:function(a,b){var c=this,d=c.serializeData(a);b?b(d):c.renderUserRegModal(d)},serializeData:function(a){return userRegistrationModalConstant[a]?userRegistrationModalConstant[a]:userRegistrationModalConstant.default},renderUserRegModal:function(a){var b=this;b.data_model.userData?a.userData={name:b.data_model.userData.name,email:b.data_model.userData.email}:a.userData=null,"function"==typeof hj&&hj("trigger","new_login");var c=$("#userRegistrationContentDiv").html(),d=Handlebars.compile(c),e=d(a);$("#userVerificationModal").empty(),$("#userVerificationModal").append(e),"builderSignup"!==this.getCookie("flow")&&nbGA.logEvent("ContactOwner","UserDetailPopup-"+this.getCookie("flow"),{}),$("#userVerificationModal").modal("show"),setTimeout(function(){$("#phoneVerification #contactNumber").focus(),b.data_model.userData&&b.data_model.userData.number&&($("#phoneVerification #contactNumber").val(b.data_model.userData.number),$("#checkPhoneNumber").click())},500),"rentalAgreement"==this.getCookie("flow")?$("#checkMobileNumber #contactNumber").intlTelInput({nationalMode:!0,separateDialCode:!0,initialCountry:"in",onlyCountries:["in"],autoPlaceholder:"off",utilsScript:"https://assets.nobroker.in/static/lib/universal/intlTelInputUtil.js"}):$("#checkMobileNumber #contactNumber").intlTelInput({nationalMode:!0,separateDialCode:!0,autoPlaceholder:"off",utilsScript:"https://assets.nobroker.in/static/lib/universal/intlTelInputUtil.js"})},isvalidNumber:function(a,b){var c=new RegExp("^[0-9]+$"),d=new RegExp("^0d*");return!!this.isNotEmpty(a)&&(!!c.test(a)&&(!d.test(a)&&!!(this.validateIndianPhoneNumberOnly(a,b)&&a.length>=4)))},validateIndianPhoneNumberOnly:function(a,b){if(91==b.dialCode){if(!/^[0-9]{10}$/.test(a))return!1}return!0},clearPropIdCookie:function(){this.setCookie("propId","",-1),this.setCookie("fromPage","",-1),this.setCookie("propertyRent","",-1),this.setCookie("flow","",-1),this.setCookie("fromPage","",-1)},checkIfNumberExists:function(a,b,c,d,e){var f,g=this;if(g.data_model.phone_number="+"+b.dialCode+a,g.data_model.phone_number_without_country_code=a,void 0!==b&&null!=b&&null!=b.dialCode&&void 0!=b.dialCode&&null!=a&&void 0!=a)f="/api/v1/account/+"+b.dialCode+a+"/check";else{f="/api/v1/account/+91"+$("#checkMobileNumber").find("input[name=contactNo]").val().replace(/\s+/g,"")+"/check"}if(c&&"builderSignup"==c?f=f+"?flow="+c+"&buildingId="+g.getCookie("buildingId"):c&&(f=f+"?flow="+c),e){f=f+"&whatsAppOptIn="+!0,null!=$("#WhatsAppOptlogin").attr("data-source")&&void 0!=$("#WhatsAppOptlogin").attr("data-source")?f=f+"&whatsAppOptInSource="+$("#WhatsAppOptlogin").attr("data-source"):null!=$("#WhatsAppOpt").attr("data-source")&&void 0!=$("#WhatsAppOpt").attr("data-source")&&(f=f+"&whatsAppOptInSource="+$("#WhatsAppOpt").attr("data-source"))}$.ajax({url:f,method:"GET",success:function(a){d&&d(a)},error:function(a){d&&d(a)}})},validateOtp:function(a,b){var c="^[0-9]{"+b+"}$";return c=new RegExp(c),!!c.test(a)},sendVerificationOtp:function(a,b,c){var d=this,e={phone:a};!b&&this.otp_sent||$.ajax({url:"/api/v1/account/user/otp/send",data:e,method:"POST",success:function(a){c&&c(a),d.otp_sent=!0},error:function(a){c&&c(a)}})},startOtpSendTimer:function(a,b,c,d){var e=this;e.countDownTimer&&clearInterval(e.countDownTimer),e.countDownTimer=setInterval(function(){var f=a%60<10?"0"+a%60:a%60;$("#"+b).empty(),$("#"+b).html("<span> Resend in "+parseInt(a/60)+" : "+f+"</span>"),--a<0&&(clearInterval(e.countDownTimer),d?$("#"+b).html('<span class="clickable-action" data-action="'+c+'">Resend OTP</span>'):$("#"+b).html('<span class="clickable-action" onclick="'+c+'(true)">Resend OTP</span>'))},1e3)},sendEmailVerificationOtp:function(a,b,c){var d=this,e={email:a};!b&&d.email_otp_sent||$.ajax({url:"/api/v2/public/sendOTP/email",method:"POST",data:e,success:function(a){c&&c(a)},error:function(a){c&&c(a)}})},verifyEmailOtp:function(a,b,c){var d=this,e={phone:d.data_model.phone_number,email:b,otp:a};$.ajax({url:"/api/v1/account/otp/validateEmailOtp",method:"POST",data:e,success:function(a){c&&c(a)},error:function(a){c&&c(a)}})},verifyLoginPassword:function(a,b,c){var d={phone:a,password:b};$.ajax({url:"/api/v1/account/login/password",method:"POST",data:d,success:function(a){c&&c(a)},error:function(a){c&&c(a)}})},verifyLoginOTP:function(a,b,c){var d={phone:a,otp:b};$.ajax({url:"/api/v1/account/login/otp/",method:"POST",data:d,success:function(a){c&&c(a)},error:function(a){c&&c(a)}})},validateEmail:function(a){return!!/^[a-z0-9._%-]+@[a-z0-9.-]+\.[a-z]{2,4}$/.test(a)},checkIfEmpty:function(a){return!(a.length>0)},createNewAccount:function(a,b,c){var d=this,e={};if(d.checkIfEmpty(a.name)&&!d.validateEmail(a.email))e.status=904,b(e);else if(d.checkIfEmpty(a.name))e.status=901,b(e);else if(d.validateEmail(a.email)){var f=c();f||$.ajax({url:"/api/v1/account/create",method:"POST",data:a,success:function(c){b&&b(c,a)},error:function(a){b&&b(a)}})}else a.email.indexOf("+")>0?(e.status=903,b(e)):(e.status=902,b(e))},renderConflictScreen:function(a){var b=this,c=$("#userRegistrationContentDiv").html(),d=b.getCookie("X-SOCIAL-EXISTING-USER-PHONE"),e=b.getCookie("X-SOCIAL-USER-PHONE");userRegistrationModalHelper.data_model.new_phone_number=e.replace("-",""),userRegistrationModalHelper.data_model.phone_number=d.replace("-","");var f=$("#loggedInUserEmail").val();a.conflictData={existingNumber:d.replace(/"/g,""),newNumber:e.replace(/"/g,""),email:f},console.log(a.conflictData);var g=Handlebars.compile(c),h=g(a);$("#userVerificationModal").empty(),$("#userVerificationModal").append(h),b.fromPage&&$("#userVerificationModal").data("fromPage",b.fromPage),$("#userVerificationModal").addClass("conflict-screen").modal("show"),$("#conflictScreenContent").removeClass("hide"),$("#buttonWrapper").addClass("hide"),$(".title-wrpper #title-register").hide(),$(".title-wrpper #conflict-title-register").show(),"rentalAgreement"==b.getCookie("flow")?$("input[name=newPhone]").intlTelInput({nationalMode:!0,separateDialCode:!0,initialCountry:"in",onlyCountries:["in"],autoPlaceholder:"off",utilsScript:"https://assets.nobroker.in/static/lib/universal/intlTelInputUtil.js"}):$("input[name=newPhone]").intlTelInput({nationalMode:!0,separateDialCode:!0,autoPlaceholder:"off",utilsScript:"https://assets.nobroker.in/static/lib/universal/intlTelInputUtil.js"})},sendUpdatePhoneOtp:function(a,b,c){var d={phone:a};!b&&this.update_otp_sent||$.ajax({url:"/api/v1/account/otp/send",method:"POST",data:d,success:function(a){c&&c(a),this.update_otp_sent=!0},error:function(a){c&&c(a)}})},validateAndUpdatePhone:function(a,b,c,d){if(this.validateOtp(b,6)){var e={phone:a,otp:b,flow:c};$.ajax({url:"/api/v1/account/otp/validate",method:"POST",data:e,success:function(a){d&&d(a)},error:function(a){d&&d(a)}})}else{d({statusCode:11005})}},updateSecondaryPhoneNumber:function(){var a=this,b={newPhone:a.data_model.new_phone_number};$.ajax({url:"/api/v1/account/conflict/update/phone/secondary",method:"POST",data:b})},postProcessFlowFromConflict:function(flow){var self=this,savedFlow=userRegistrationModalConstant.postHandlers[flow];if($("#userVerificationModal").modal("hide"),self.isNotEmpty(savedFlow))eval(savedFlow)();else if("true"==$("#isULIN").val()){nbGA.logEvent("NewUser","ContactOwner-social",{});var propId=self.getCookie("propId"),fromPage=self.getCookie("fromPage");propId&&("shortlist"==fromPage?shortlistProperty(propId):"tenantSchedule"!=fromPage?invokeContactOwnerCall(propId,"","",fromPage):invokeContactOwnerCall(propId,"",function(){bookTenantAppointment()},fromPage),self.clearPropIdCookie()),self.setCookie("X-SOCIAL-USER-SIGNIN-SUCCESS","",-1)}else self.setCookie("X-SOCIAL-USER-SIGNIN-SUCCESS","",-1),self.clearPropIdCookie()},registerFlow:function(a,b,c,d){var e=this;if(e.preHandler=c,e.postHandler=d,"saveSearch"===a&&window.localStorage&&localStorage.setItem("openAlerts",!0),e.page=$("#pageNameForAdobe").val()?$("#pageNameForAdobe").val():"notfound",service=$("#pageNameForAdobe").data("type")?$("#pageNameForAdobe").data("type"):$("#nbpt").val()?$("#nbpt").val():"tenant",nbAdobeEvents&&nbAdobeEvents.registerEvent({pageName:"signup/login",platform:"nb-web",siteSection:e.page+"_"+("default"===a?"topheader":a),flowName:"registration_journey",service:nbAdobeService.getServiceName(service)},"login_Popup",{isLoggedIn:"not-loggedin"}),b&&b.userData&&(e.data_model.userData=Object.assign({},b.userData)),b&&"requestPhotos"!==a&&"saveSearch"!==a)("packersMovers"===b.flow||"rentalAgreement"==b.flow||"builderSignup"===b.flow||b.flow.indexOf("plans")>-1||b.flow.indexOf("Plans")>-1)&&(e.dumpModalDataToCookie(b),e.processModalData(b)),e.saveModalDataToCookie(b);else if(e.setCookie("flow",a),"requestPhotos"===a){var f={flow:"requestPhotos",prop_type:b};e.processModalData(f)}if(c&&"function"==typeof c){var g=c();e.renderUserRegModal(g)}else e.preProcessFlow(a)},postProcessFlow:function(a,b){var c=this,d=c.serializeData(a),e=d.defaultPostHandler;$("#userVerificationModal").modal("hide"),c.postHandler?c.postHandler(b):c.isNotEmpty(e)&&e()},prepareConflictScreen:function(a){var b=this;if(b.isNotEmpty(a))if(b.isNotEmpty(userRegistrationModalConstant[a])){if("packersMovers"===a||"builderSignup"===a){var c=b.getCookie("modalDataDump");c=JSON.parse(c),b.processModalData(c)}b.preProcessFlow(a,b.renderConflictScreen)}else b.preProcessFlow(a,b.renderConflictScreen);else b.preProcessFlow("default",b.renderConflictScreen)},getWhatsappStatus:function(a,b){$.ajax({url:"/api/v2/whatsapp/opt/status",type:"POST",data:{phone:a},success:function(a){b&&b(a)},error:function(a){b&&b(a)}})}};return userRegistrationModalHelper});