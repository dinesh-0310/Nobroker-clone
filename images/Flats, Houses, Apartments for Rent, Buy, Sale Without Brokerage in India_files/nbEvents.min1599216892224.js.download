!function(a,b){"function"==typeof define&&define.amd?define(["nbEvents"],b):a.nbEvents=b(a.options)}(window,function(a){var b,c,d=$("#isMobile").val(),e={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b,c,d,f,g,h,i,j="",k=0;for(a=e._utf8_encode(a);k<a.length;)b=a.charCodeAt(k++),c=a.charCodeAt(k++),d=a.charCodeAt(k++),f=b>>2,g=(3&b)<<4|c>>4,h=(15&c)<<2|d>>6,i=63&d,isNaN(c)?h=i=64:isNaN(d)&&(i=64),j=j+this._keyStr.charAt(f)+this._keyStr.charAt(g)+this._keyStr.charAt(h)+this._keyStr.charAt(i);return j},decode:function(a){var b,c,d,f,g,h,i,j="",k=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");k<a.length;)f=this._keyStr.indexOf(a.charAt(k++)),g=this._keyStr.indexOf(a.charAt(k++)),h=this._keyStr.indexOf(a.charAt(k++)),i=this._keyStr.indexOf(a.charAt(k++)),b=f<<2|g>>4,c=(15&g)<<4|h>>2,d=(3&h)<<6|i,j+=String.fromCharCode(b),64!=h&&(j+=String.fromCharCode(c)),64!=i&&(j+=String.fromCharCode(d));return j=e._utf8_decode(j)},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);d<128?b+=String.fromCharCode(d):d>127&&d<2048?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b},_utf8_decode:function(a){for(var b="",c=0,d=c1=c2=0;c<a.length;)d=a.charCodeAt(c),d<128?(b+=String.fromCharCode(d),c++):d>191&&d<224?(c2=a.charCodeAt(c+1),b+=String.fromCharCode((31&d)<<6|63&c2),c+=2):(c2=a.charCodeAt(c+1),c3=a.charCodeAt(c+2),b+=String.fromCharCode((15&d)<<12|(63&c2)<<6|63&c3),c+=3);return b}};"false"==d?(b=facebookEvent,c=nbUtils):(b=require("facebookEvent"),c=require("../../../mobile/app/scripts/utils/utilEvents"));var f,g;"false"==d?(f=adobeEvent,g=criteoEvent):(f=c.adobeEvent,g=c.criteoEvent);var h={handleFbEvent:function(a,c,d){b.fbEvent(a,c,d)},handleAdobeEvent:function(a){"false"==d?f.logAdobeEvent(a):f.logEvent(a)},handleCriteoEvent:function(a){g.pushEvent(a)},logPageView:function(a){try{"Home"==a.pageType?(this.handleAdobeEvent("ev_Homepage"),this.handleCriteoEvent({event:"viewHome"})):"RA"==a.pageType?(this.handleAdobeEvent("ev_RApage"),this.handleCriteoEvent({event:"viewHome",conType:"rentalHome"})):"PM"==a.pageType?(this.handleAdobeEvent("ev_PMpage"),this.handleCriteoEvent({event:"viewHome",conType:"packmovHome"})):"PYP"==a.pageType?this.handleFbEvent("AddToWishList","",a.params):"PYPShow"==a.pageType?this.handleFbEvent("ev_Postpropertypage"):"ALL"==a.pageType&&this.handleFbEvent("PageView")}catch(b){console.error("Analytics logging error [nbEvents] : "+b.message+"for data "+JSON.stringify(a))}},logViewListing:function(a){try{if(a.propType){var b=a.propType;b="ev_Listpage-"+b.toLowerCase(),this.handleAdobeEvent(b),h.logCriteoListPage()}"false"==d?this.handleFbEvent("Search"):a.params&&this.handleFbEvent("mobileSearch","",a.params)}catch(b){console.error("Analytics logging error [nbEvents] : "+b.message+"for data "+JSON.stringify(a))}},logViewProperty:function(a){try{if(a.actionType&&a.actionType.indexOf("shortList")>-1)return void this.logShortListView(a);var b=a.propType,c=a.propId;this.handleAdobeEvent("ev_Detailpage-"+b.toLowerCase()),this.handleCriteoEvent({event:"viewItem",item:c});var d={content_name:b};this.handleFbEvent("ViewContent",c,d)}catch(b){console.error("Analytics logging error [nbEvents] : "+b.message+"for data "+JSON.stringify(a))}},logContactOwner:function(a){try{if("fbAddToCart"==a.actionType){var b={content_ids:a.propId,content_category:a.propType,content_type:"product",content_name:"FromPage: "+a.fromPage};this.handleFbEvent("AddToCart",a.propId,b);var c="owndet"+Number(new Date),d={event:"trackTransaction",id:c,item:[{id:a.propId,price:1,quantity:1}],conType:"owndet"};this.handleCriteoEvent(d)}else{if(!a.loggedIn)return void h.logLeadEvent({content_name:"FromPage: "+a.fromPage});if(a.propType){var e=a.propType;e="ev_Contactowner-"+e.toLowerCase(),this.handleAdobeEvent(e)}}}catch(b){console.error("Analytics logging error [nbEvents] : "+b.message+"for data "+JSON.stringify(a))}},logPaymentSuccess:function(a){try{var b,c="pay";a.planId&&(a.planId.indexOf("OWNER")>-1?b="ev_Ownerpaymentsuccess-owner":a.planId.indexOf("TENANT")>-1?b="ev_Tenantpaymentsuccess-rent":a.planId.indexOf("SELLER")>-1?b="ev_Ownerpaymentsuccess-seller":a.planId.indexOf("BUYER")>-1&&(b="ev_Tenantpaymentsuccess-buy"),c="paymentsuccess"),a.params&&a.params.content_name.indexOf("RENTAL_AGREEMENT")>-1&&(b="ev_RentalAgreementpaymentsuccess",c="rentalsuccess"),!a.params||"pnm"!=a.params.content_name&&"HOME_STORE_PACKERS_MOVERS "!=a.params.content_name||(c="packmovsuccess"),b&&this.handleAdobeEvent(b),this.handleFbEvent("Purchase","",a.params);var d={event:"trackTransaction",id:a.paymentId,item:[{id:a.params.content_name,price:a.params.value,quantity:1}],conType:c};this.handleCriteoEvent(d)}catch(b){console.error("Analytics logging error [nbEvents] : "+b.message+"for data "+JSON.stringify(a))}},logPaymentInitiated:function(a){try{a.planId&&(a.planId.indexOf("OWNER")>-1?adobeEventName="ev_Ownerpaymentinitiated-owner":a.planId.indexOf("TENANT")>-1?adobeEventName="ev_Tenantpaymentinitiated-rent":a.planId.indexOf("SELLER")>-1?adobeEventName="ev_Ownerpaymentinitiated-seller":a.planId.indexOf("BUYER")>-1&&(adobeEventName="ev_Tenantpaymentinitiated-buy"),this.handleAdobeEvent(adobeEventName)),a.params&&this.handleFbEvent("InitiateCheckout","",a.params);var b="PayIni"+Number(new Date),c={event:"trackTransaction",id:b,item:[{id:b,price:1,quantity:1}],conType:"PayIni"};this.handleCriteoEvent(c)}catch(b){console.error("Analytics logging error [nbEvents] : "+b.message+"for data "+JSON.stringify(a))}},logUserRegistration:function(a){try{if(a.isLoggedIn&&!a.isLoggedIn)return void this.logLeadEvent(data);if("userDetPopup"==a.actionType)return void this.handleAdobeEvent("ev_Userdetailpopup-"+a.propType.toLowerCase());if("newPhoneReg"==a.actionType)return void this.handleAdobeEvent("ev_Newphone-"+a.propType.toLowerCase());var b;"Normal"==a.regType?b="Normal Registration":"Facebook"==a.regType?b="Facebook Registration":"Google"==a.regType?b="Google Registration":"PYP"==a.flowName&&(b="Owner Registration"),this.handleFbEvent("CompleteRegistration","",{content_name:b}),a.propertyType&&this.handleAdobeEvent("ev_Ownerregistration-"+a.propertyType.toLowerCase()),a.flowName&&("rentalAgreement"==a.flowName?this.handleAdobeEvent("ev_RAlead"):"packersMovers"==a.flowName?this.handleAdobeEvent("ev_PMlead-intercity"):this.handleAdobeEvent("ev_Newuser-"+a.propType))}catch(b){console.error("Analytics logging error [nbEvents] : "+b.message+"for data "+JSON.stringify(a))}},logCriteoListPage:function(){var a,b,c=[];"false"==d?(a=$($("#listResults").find(".card")),b=a.size()):(a=document.getElementsByClassName("singleCard"),b=a.length),b>3&&(b=3);for(var e=0;e<b;e++)c[e]=a[e].id.split("-")[1];g.pushEvent({event:"viewList",item:c})},logLeadEvent:function(a){try{var b;a.content_name&&(b=a.content_name),a.self&&(b=a.self.view.name?a.self.view.model.get("propertyType")+" list":a.self.view.model.get("propertyType")+" detail");var c={content_name:b};this.handleFbEvent("Lead","",c)}catch(b){console.error("Analytics logging error [nbEvents] : "+b.message+"for data "+JSON.stringify(a))}},logAddToWishList:function(a){this.handleFbEvent("AddToWishList","",a.params)},detectPrivateMode:function(a){function b(){try{localStorage.length?d():(localStorage.x=1,localStorage.removeItem("x"),d())}catch(a){navigator.cookieEnabled?c():d()}}var c=a.bind(null,!0),d=a.bind(null,!1);try{var e;window.webkitRequestFileSystem?webkitRequestFileSystem(0,0,d,c):"MozAppearance"in document.documentElement.style?(e=indexedDB.open("test"),e.onerror=c,e.onsuccess=d):/constructor/i.test(window.HTMLElement)||window.safari?b():window.indexedDB||!window.PointerEvent&&!window.MSPointerEvent?d():c()}catch(a){console.log("Error occure while detecting browser mode",a),d()}},setUserRegistarionParamsInCookie:function(a){var b={isPrivateMode:a};b=JSON.stringify(b);var c=e.encode(b),d=new Date;d.setTime(d.getTime()+864e5);var f="expires="+d.toUTCString();document.cookie="X-NEW-USER-VIGILANTE-PARAMS="+c+"; "+f},logShortListView:function(a){try{var b;if(a.params&&a.params.content_name)b=a.params;else{var c="";c=a.params.view.name?a.params.view.model.get("propertyType")+" list":a.params.view.model.get("propertyType")+" detail",b={content_ids:[a.params.view.model.get("id")],content_category:a.params.view.model.get("propertyType"),content_type:"product",content_name:"FromPage: "+c}}"shortList"!=a.actionType||a.isLoggedIn||this.handleFbEvent("Lead","",b),"shortListDone"==a.actionType&&this.handleFbEvent("AddToCart","",b)}catch(b){console.error("Analytics logging error [nbEvents] : "+b.message+"for data "+JSON.stringify(a))}}};return h}),$(document).ready(function(){"undefined"!=typeof nbEvents&&nbEvents.detectPrivateMode(function(a){nbEvents.setUserRegistarionParamsInCookie(a)})});