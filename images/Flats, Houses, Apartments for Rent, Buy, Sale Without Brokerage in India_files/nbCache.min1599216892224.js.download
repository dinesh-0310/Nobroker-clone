!function(a,b){"function"==typeof define&&define.amd?define(["nbCache"],b):a.nbCache=b(a.options)}(window,function(a){return{storage:window.localStorage,cacheObject:{},cacheAvailable:!1,cacheInitialized:!1,clearAll:!1,init:function(){if(this.storage&&!this.cacheAvailable&&!this.cacheInitialized)try{void 0!==this.storage.getItem("NoBrokerCache")&&this.storage.getItem("NoBrokerCache")||this.storage.setItem("NoBrokerCache",JSON.stringify({})),this.cacheAvailable=!0,this.cacheInitialized=!0,this.cacheObject=JSON.parse(this.storage.getItem("NoBrokerCache"))}catch(a){this.cacheAvailable=!1,this.cacheInitialized=!1}},put:function(a,b,c,d){if(this.cacheInitialized)try{var e={};if(e.value=b,c&&c.staleTime){e.lastAccessTime="";var f=new Date,g=new Date(f);g.setMinutes(f.getMinutes()+c.staleTime),e.staleTime=Date.parse(g)}return this.cacheObject[a]=e,this.storage.setItem("NoBrokerCache",JSON.stringify(this.cacheObject)),this.cacheObject=JSON.parse(this.storage.getItem("NoBrokerCache")),this.produce(a)}catch(a){}else{if(this.init(),!this.cacheAvailable||!this.cacheInitialized)return{error:"true"};this.put(a,b,c)}},get:function(a,b){var c=this;if(!this.cacheInitialized)return this.init(),this.cacheAvailable&&this.cacheInitialized?this.get(a,b):{error:"true"};try{var d=c.cacheObject[a];if(d&&!_.isEmpty(d)){if(d.staleTime&&(void 0!==d.lastAccessTime&&(d.lastAccessTime,d.lastAccessTime=Date.now()),d.lastAccessTime>d.staleTime)){var e={};if(e.clearItem=a,c.invalidate(e),b.loader)return b.loader(a)}return c.produce(a)}if(b.loader)return b.loader(a)}catch(a){}},invalidate:function(a){if(!this.cacheInitialized)return this.init(),this.cacheAvailable&&this.cacheInitialized?this.invalidate(a):{error:"true"};if(a&&(a.clearItem?this.clearAll=!1:"string"==typeof a&&""!=a&&(this.clearItem=a)),void 0===a&&(this.clearAll=!0),this.storage)try{if(this.clearAll)this.storage.removeItem("NoBrokerCache"),this.cacheAvailable=!0,this.cacheInitialized=!1,this.cacheObject=JSON.parse(this.storage.getItem("NoBrokerCache"));else{a.clearItem?objKey=a.clearItem:this.clearItem&&(objKey=this.clearItem);var b=JSON.parse(localStorage.getItem("NoBrokerCache"));delete b[objKey],this.storage.setItem("NoBrokerCache",JSON.stringify(b)),this.cacheObject=JSON.parse(this.storage.getItem("NoBrokerCache")),this.cacheAvailable=!0}}catch(a){this.cacheAvailable=!1,this.cacheInitialized=!1}},produce:function(a){if(!this.cacheObject[a].value)return this.cacheObject[a];if("object"==typeof this.cacheObject[a].value)return this.cacheObject[a].value;try{return JSON.parse(this.cacheObject[a].value)}catch(b){return this.cacheObject[a].value}}}});